
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Collimated data reduction for OFFSPEC &#8212; ess  documentation</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/nbsphinx-code-cells.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script src="../../../_static/design-tabs.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="POWGEN" href="../powgen/powgen.html" />
    <link rel="prev" title="External Instruments" href="../external.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../../_static/logo.svg" class="logo" alt="logo">
      
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Getting started
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../getting-started/installation.html">
   Installation
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Instruments
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../amor/amor.html">
   Amor
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../amor/amor_reduction.html">
     Divergent data reduction for Amor
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../amor/reference.html">
     Reference
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
    <label for="toctree-checkbox-2">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../../../generated/ess.amor.beamline.html">
       ess.amor.beamline
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
      <label for="toctree-checkbox-3">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../generated/ess.amor.beamline.instrument_view_components.html">
         ess.amor.beamline.instrument_view_components
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../generated/ess.amor.beamline.make_beamline.html">
         ess.amor.beamline.make_beamline
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../../../generated/ess.amor.calibrations.html">
       ess.amor.calibrations
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
      <label for="toctree-checkbox-4">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../generated/ess.amor.calibrations.calibration_factor.html">
         ess.amor.calibrations.calibration_factor
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../generated/ess.amor.calibrations.supermirror_calibration.html">
         ess.amor.calibrations.supermirror_calibration
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../../../generated/ess.amor.conversions.html">
       ess.amor.conversions
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
      <label for="toctree-checkbox-5">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../generated/ess.amor.conversions.incident_beam.html">
         ess.amor.conversions.incident_beam
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../generated/ess.amor.conversions.specular_reflection.html">
         ess.amor.conversions.specular_reflection
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../../../generated/ess.amor.normalize.html">
       ess.amor.normalize
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
      <label for="toctree-checkbox-6">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../generated/ess.amor.normalize.normalize_by_supermirror.html">
         ess.amor.normalize.normalize_by_supermirror
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../../../generated/ess.amor.orso.html">
       ess.amor.orso
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
      <label for="toctree-checkbox-7">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../generated/ess.amor.orso.make_orso.html">
         ess.amor.orso.make_orso
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../../../generated/ess.amor.resolution.html">
       ess.amor.resolution
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
      <label for="toctree-checkbox-8">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../generated/ess.amor.resolution.angular_resolution.html">
         ess.amor.resolution.angular_resolution
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../generated/ess.amor.resolution.sample_size_resolution.html">
         ess.amor.resolution.sample_size_resolution
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../generated/ess.amor.resolution.sigma_Q.html">
         ess.amor.resolution.sigma_Q
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../generated/ess.amor.resolution.wavelength_resolution.html">
         ess.amor.resolution.wavelength_resolution
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../../../generated/ess.amor.tools.html">
       ess.amor.tools
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
      <label for="toctree-checkbox-9">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../generated/ess.amor.tools.fwhm_to_std.html">
         ess.amor.tools.fwhm_to_std
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../generated/ess.amor.tools.linlogspace.html">
         ess.amor.tools.linlogspace
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../generated/ess.amor.tools.std_to_fwhm.html">
         ess.amor.tools.std_to_fwhm
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../generated/ess.amor.instrument_view.instrument_view.html">
       ess.amor.instrument_view.instrument_view
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../generated/ess.amor.load.load.html">
       ess.amor.load.load
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../dream/dream.html">
   DREAM
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../dream/dream-instrument-view.html">
     DREAM instrument view
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../loki/loki.html">
   Loki
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
  <label for="toctree-checkbox-11">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../loki/sans2d_to_I_of_Q.html">
     SANS2D: I(Q) workflow for a single run (sample)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../loki/sans2d_reduction.html">
     SANS2D: I(Q) for sample and background
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../external.html">
   External Instruments
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
  <label for="toctree-checkbox-12">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Collimated data reduction for OFFSPEC
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../powgen/powgen.html">
     POWGEN
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/>
    <label for="toctree-checkbox-13">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../powgen/powgen_reduction.html">
       Data reduction for POWGEN
      </a>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../powgen/reference.html">
       Reference
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/>
      <label for="toctree-checkbox-14">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../generated/ess.external.powgen.beamline.html">
         ess.external.powgen.beamline
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Techniques
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../techniques/diffraction/diffraction.html">
   Diffraction
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/>
  <label for="toctree-checkbox-15">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../../techniques/diffraction/reference.html">
     Reference
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/>
    <label for="toctree-checkbox-16">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../generated/ess.diffraction.normalize_by_monitor.html">
       ess.diffraction.normalize_by_monitor
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../generated/ess.diffraction.normalize_by_vanadium.html">
       ess.diffraction.normalize_by_vanadium
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../generated/ess.diffraction.lowpass.html">
       ess.diffraction.lowpass
      </a>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../../../techniques/diffraction/powder.html">
       Powder
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/>
      <label for="toctree-checkbox-17">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../generated/ess.diffraction.powder.conversions.dspacing_from_diff_calibration.html">
         ess.diffraction.powder.conversions.dspacing_from_diff_calibration
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../generated/ess.diffraction.powder.to_dspacing_with_calibration.html">
         ess.diffraction.powder.to_dspacing_with_calibration
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../generated/ess.diffraction.powder.merge_calibration.html">
         ess.diffraction.powder.merge_calibration
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../techniques/reflectometry/reflectometry.html">
   Reflectometry
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" type="checkbox"/>
  <label for="toctree-checkbox-18">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../../techniques/reflectometry/reference.html">
     Reference
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" type="checkbox"/>
    <label for="toctree-checkbox-19">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../generated/ess.reflectometry.conversions.specular_reflection.html">
       ess.reflectometry.conversions.specular_reflection
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../generated/ess.reflectometry.corrections.footprint_correction.html">
       ess.reflectometry.corrections.footprint_correction
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../generated/ess.reflectometry.corrections.normalize_by_counts.html">
       ess.reflectometry.corrections.normalize_by_counts
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../generated/ess.reflectometry.corrections.beam_on_sample.html">
       ess.reflectometry.corrections.beam_on_sample
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../generated/ess.reflectometry.io.save_ort.html">
       ess.reflectometry.io.save_ort
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../techniques/sans/sans.html">
   SANS
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" type="checkbox"/>
  <label for="toctree-checkbox-20">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../techniques/sans/sans-beam-center-finder.html">
     Beam center finder
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../../techniques/sans/reference.html">
     Reference
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" type="checkbox"/>
    <label for="toctree-checkbox-21">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../../../techniques/sans/i_of_q.html">
       I(Q) reduction workflow
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" type="checkbox"/>
      <label for="toctree-checkbox-22">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../generated/ess.sans.i_of_q.to_I_of_Q.html">
         ess.sans.i_of_q.to_I_of_Q
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../generated/ess.sans.i_of_q.convert_to_q_and_merge_spectra.html">
         ess.sans.i_of_q.convert_to_q_and_merge_spectra
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../generated/ess.sans.i_of_q.preprocess_monitor_data.html">
         ess.sans.i_of_q.preprocess_monitor_data
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../generated/ess.sans.i_of_q.resample_direct_beam.html">
         ess.sans.i_of_q.resample_direct_beam
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../generated/ess.sans.beam_center_finder.beam_center.html">
       ess.sans.beam_center_finder.beam_center
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../generated/ess.sans.beam_center_finder.center_of_mass.html">
       ess.sans.beam_center_finder.center_of_mass
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../generated/ess.sans.beam_center_finder.cost.html">
       ess.sans.beam_center_finder.cost
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../generated/ess.sans.beam_center_finder.iofq_in_quadrants.html">
       ess.sans.beam_center_finder.iofq_in_quadrants
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../generated/ess.sans.beam_center_finder.minimize.html">
       ess.sans.beam_center_finder.minimize
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../generated/ess.sans.conversions.sans_elastic.html">
       ess.sans.conversions.sans_elastic
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../generated/ess.sans.conversions.sans_monitor.html">
       ess.sans.conversions.sans_monitor
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../generated/ess.sans.normalization.solid_angle_of_rectangular_pixels.html">
       ess.sans.normalization.solid_angle_of_rectangular_pixels
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../generated/ess.sans.normalization.transmission_fraction.html">
       ess.sans.normalization.transmission_fraction
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../generated/ess.sans.normalization.iofq_denominator.html">
       ess.sans.normalization.iofq_denominator
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../generated/ess.sans.normalization.normalize.html">
       ess.sans.normalization.normalize
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../generated/ess.sans.common.gravity_vector.html">
       ess.sans.common.gravity_vector
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../generated/ess.sans.common.mask_range.html">
       ess.sans.common.mask_range
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../techniques/wfm/wfm.html">
   Wavelength frame multiplication
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" type="checkbox"/>
  <label for="toctree-checkbox-23">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../techniques/wfm/introduction-to-wfm.html">
     Introduction to Wavelength Frame Multiplication
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../techniques/wfm/reducing-wfm-data.html">
     Reducing WFM data
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Utilities
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../utilities/utilities.html">
   Modules
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-24" name="toctree-checkbox-24" type="checkbox"/>
  <label for="toctree-checkbox-24">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../../generated/modules/ess.logging.html">
     ess.logging
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-25" name="toctree-checkbox-25" type="checkbox"/>
    <label for="toctree-checkbox-25">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../generated/modules/ess.logging.configure.html">
       ess.logging.configure
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../generated/modules/ess.logging.configure_workflow.html">
       ess.logging.configure_workflow
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../generated/modules/ess.logging.default_loggers_to_configure.html">
       ess.logging.default_loggers_to_configure
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../generated/modules/ess.logging.get_logger.html">
       ess.logging.get_logger
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../generated/modules/ess.logging.greet.html">
       ess.logging.greet
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../generated/modules/ess.logging.log_call.html">
       ess.logging.log_call
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../generated/modules/ess.logging.Formatter.html">
       ess.logging.Formatter
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../../generated/modules/ess.masking.html">
     ess.masking
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-26" name="toctree-checkbox-26" type="checkbox"/>
    <label for="toctree-checkbox-26">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../generated/modules/ess.masking.save_detector_masks.html">
       ess.masking.save_detector_masks
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../../generated/modules/ess.uncertainty.html">
     ess.uncertainty
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-27" name="toctree-checkbox-27" type="checkbox"/>
    <label for="toctree-checkbox-27">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../generated/modules/ess.uncertainty.variance_normalized_signal_over_monitor.html">
       ess.uncertainty.variance_normalized_signal_over_monitor
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Developer documentation
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../developer/style-guide.html">
   Style guide
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../developer/getting-started.html">
   Getting Started
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  About
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../about/release-notes.html">
   Release Notes
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        

















<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="None">
<span class="headerbtn__text-container">Related projects</span>
<i class="fa fa-caret-down"></i>
  </button>
<div class="menu-dropdown__content" style="transform:translateX(0%)">
    <ul>
      <li>
        <a href="https://scipp.github.io"
   class="headerbtn"
   
>
  

<span class="headerbtn__text-container">scipp</span>
</a>

      </li>
      
      <li>
        <a href="https://scipp.github.io/plopp"
   class="headerbtn"
   
>
  

<span class="headerbtn__text-container">plopp</span>
</a>

      </li>
      
      <li>
        <a href="https://scipp.github.io/scippnexus"
   class="headerbtn"
   
>
  

<span class="headerbtn__text-container">scippnexus</span>
</a>

      </li>
      
      <li>
        <a href="https://scipp.github.io/scippneutron"
   class="headerbtn"
   
>
  

<span class="headerbtn__text-container">scippneutron</span>
</a>

      </li>
      
      <li>
        <a href="https://scipp.github.io/ess"
   class="headerbtn"
   
>
  

<span class="headerbtn__text-container">ess</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="None">
<span class="headerbtn__text-container">24.1.1.dev5+g8409fb3 (latest)</span>
<i class="fa fa-caret-down"></i>
  </button>
<div class="menu-dropdown__content" style="transform:translateX(0%)">
    <ul>
      <li>
        <a href="https://scipp.github.io/ess"
   class="headerbtn"
   
>
  

<span class="headerbtn__text-container">24.1 (latest)</span>
</a>

      </li>
      
      <li>
        <a href="https://scipp.github.io/ess/release/23.11"
   class="headerbtn"
   
>
  

<span class="headerbtn__text-container">23.11</span>
</a>

      </li>
      
      <li>
        <a href="https://scipp.github.io/ess/release/23.10"
   class="headerbtn"
   
>
  

<span class="headerbtn__text-container">23.10</span>
</a>

      </li>
      
      <li>
        <a href="https://scipp.github.io/ess/release/23.4"
   class="headerbtn"
   
>
  

<span class="headerbtn__text-container">23.4</span>
</a>

      </li>
      
      <li>
        <a href="https://scipp.github.io/ess/release/23.1"
   class="headerbtn"
   
>
  

<span class="headerbtn__text-container">23.1</span>
</a>

      </li>
      
      <li>
        <a href="https://scipp.github.io/ess/release/0.9"
   class="headerbtn"
   
>
  

<span class="headerbtn__text-container">0.9</span>
</a>

      </li>
      
      <li>
        <a href="https://scipp.github.io/ess/release/0.8"
   class="headerbtn"
   
>
  

<span class="headerbtn__text-container">0.8</span>
</a>

      </li>
      
      <li>
        <a href="https://scipp.github.io/ess/release/0.7"
   class="headerbtn"
   
>
  

<span class="headerbtn__text-container">0.7</span>
</a>

      </li>
      
      <li>
        <a href="https://scipp.github.io/ess/release/0.6"
   class="headerbtn"
   
>
  

<span class="headerbtn__text-container">0.6</span>
</a>

      </li>
      
      <li>
        <a href="https://scipp.github.io/ess/release/0.5"
   class="headerbtn"
   
>
  

<span class="headerbtn__text-container">0.5</span>
</a>

      </li>
      
      <li>
        <a href="https://scipp.github.io/ess/release/0.4"
   class="headerbtn"
   
>
  

<span class="headerbtn__text-container">0.4</span>
</a>

      </li>
      
      <li>
        <a href="https://scipp.github.io/ess/release/0.3"
   class="headerbtn"
   
>
  

<span class="headerbtn__text-container">0.3</span>
</a>

      </li>
      
      <li>
        <a href="https://scipp.github.io/ess/release/0.2"
   class="headerbtn"
   
>
  

<span class="headerbtn__text-container">0.2</span>
</a>

      </li>
      
      <li>
        <a href="https://scipp.github.io/ess/release/0.1"
   class="headerbtn"
   
>
  

<span class="headerbtn__text-container">0.1</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">

<i class="fab fa-github"></i>
  </button>
<div class="menu-dropdown__content" >
    <ul>
      <li>
        <a href="https://github.com/scipp/ess"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/scipp/ess/issues/new?title=Issue%20on%20page%20%2Finstruments/external/offspec/offspec_reduction.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/scipp/ess/edit/main/docs/instruments/external/offspec/offspec_reduction.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">

<i class="fas fa-download"></i>
  </button>
<div class="menu-dropdown__content" >
    <ul>
      <li>
        <a href="../../../_sources/instruments/external/offspec/offspec_reduction.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Loading-the-data">
   Loading the data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Populating-the-ORSO-header">
   Populating the ORSO header
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#The-data-source-information">
     The data source information
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#The-reduction-details">
     The reduction details
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Correcting-the-position-of-detector-pixels">
     Correcting the position of detector pixels
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Coordinate-transform-graph">
   Coordinate transform graph
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Computing-the-wavelength">
   Computing the wavelength
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Normalization-by-monitor">
   Normalization by monitor
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Normalisation-of-sample-by-direct-beam">
   Normalisation of sample by direct beam
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Conversion-to-Q">
   Conversion to
   <span class="math notranslate nohighlight">
    \(Q\)
   </span>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Saving-the-scipp-reduced-data-as-.ort">
   Saving the scipp-reduced data as .ort
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Collimated data reduction for OFFSPEC</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Loading-the-data">
   Loading the data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Populating-the-ORSO-header">
   Populating the ORSO header
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#The-data-source-information">
     The data source information
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#The-reduction-details">
     The reduction details
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Correcting-the-position-of-detector-pixels">
     Correcting the position of detector pixels
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Coordinate-transform-graph">
   Coordinate transform graph
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Computing-the-wavelength">
   Computing the wavelength
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Normalization-by-monitor">
   Normalization by monitor
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Normalisation-of-sample-by-direct-beam">
   Normalisation of sample by direct beam
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Conversion-to-Q">
   Conversion to
   <span class="math notranslate nohighlight">
    \(Q\)
   </span>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Saving-the-scipp-reduced-data-as-.ort">
   Saving the scipp-reduced data as .ort
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section id="Collimated-data-reduction-for-OFFSPEC">
<h1>Collimated data reduction for OFFSPEC<a class="headerlink" href="#Collimated-data-reduction-for-OFFSPEC" title="Permalink to this headline">#</a></h1>
<p>This notebook implements a reduction workflow for reflectometry data collected from the ISIS instrument <a class="reference external" href="https://www.isis.stfc.ac.uk/Pages/Offspec.aspx">OFFSPEC</a> using a collimated beam. This workflow implements the same procedure as the corresponding workflow in Mantid, see <a class="reference external" href="https://docs.mantidproject.org/nightly/techniques/ISIS_Reflectometry.html">https://docs.mantidproject.org/nightly/techniques/ISIS_Reflectometry.html</a>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">platform</span>

<span class="kn">import</span> <span class="nn">scipp</span> <span class="k">as</span> <span class="nn">sc</span>
<span class="kn">import</span> <span class="nn">scippneutron</span> <span class="k">as</span> <span class="nn">scn</span>
<span class="kn">from</span> <span class="nn">orsopy</span> <span class="kn">import</span> <span class="n">fileio</span>

<span class="kn">import</span> <span class="nn">ess</span>
<span class="kn">from</span> <span class="nn">ess</span> <span class="kn">import</span> <span class="n">reflectometry</span>
<span class="kn">from</span> <span class="nn">ess.external</span> <span class="kn">import</span> <span class="n">offspec</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">logger</span> <span class="o">=</span> <span class="n">ess</span><span class="o">.</span><span class="n">logging</span><span class="o">.</span><span class="n">configure_workflow</span><span class="p">(</span><span class="s1">&#39;offspec_reduction&#39;</span><span class="p">,</span>
                                        <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;offspec.log&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "df6c71eaa30e469aa24490fced587a8c"}</script></div>
</div>
<section id="Loading-the-data">
<h2>Loading the data<a class="headerlink" href="#Loading-the-data" title="Permalink to this headline">#</a></h2>
<p>In this example, we load some test data provided by the <code class="docutils literal notranslate"><span class="pre">offspec</span></code> package. We need a sample measurement (the sample is <code class="docutils literal notranslate"><span class="pre">Air</span> <span class="pre">|</span> <span class="pre">Si(790</span> <span class="pre">A)</span> <span class="pre">|</span> <span class="pre">Cu(300</span> <span class="pre">A)</span> <span class="pre">|</span> <span class="pre">SiO2</span></code>) and a direct beam measurement. The latter was obtained by positioning the detector directly in the beam of incident neutrons and moving the sample out of the way. It gives an estimate for the ISIS pulse structure as a function of time-of-flight.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sample_full</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">load_hdf5</span><span class="p">(</span><span class="n">offspec</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">sample</span><span class="p">())</span>
<span class="n">sample</span> <span class="o">=</span> <span class="n">sample_full</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
<span class="n">sample</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;theta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sample_full</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;Theta&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Downloading file &#39;sample.h5&#39; from &#39;https://public.esss.dk/groups/scipp/ess/offspec/1/sample.h5&#39; to &#39;/home/runner/.cache/ess/offspec/1&#39;.
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">direct_beam_full</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">load_hdf5</span><span class="p">(</span><span class="n">offspec</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">direct_beam</span><span class="p">())</span>
<span class="n">direct_beam</span> <span class="o">=</span> <span class="n">direct_beam_full</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
<span class="n">direct_beam</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;theta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">direct_beam_full</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;Theta&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Downloading file &#39;direct_beam.h5&#39; from &#39;https://public.esss.dk/groups/scipp/ess/offspec/1/direct_beam.h5&#39; to &#39;/home/runner/.cache/ess/offspec/1&#39;.
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sample</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div><!-- Original source from -->
<!-- https://github.com/jsignell/xarray/blob/1d960933ab252e0f79f7e050e6c9261d55568057/xarray/static/html/icons-svg-inline.html -->
<svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<title>Show/Hide data repr</title>
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<title>Show/Hide attributes</title>
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg><style id="scipp-style-sheet">.sc-root{--sc-background-color0:var(--jp-layout-color0,#fff);--sc-background-color1:var(--jp-layout-color1,#fcfcfc);--sc-background-color2:var(--jp-layout-color2,#efefef);--sc-inverse-background-color0:var(--jp-inverse-layout-color4,#111);--sc-font-color0:var(--jp-content-font-color0,#000);--sc-font-color1:var(--jp-content-font-color1,#555);--sc-font-color2:var(--jp-content-font-color2,#888);--sc-font-color3:var(--jp-content-font-color3,#ccc);--sc-table-data-color:#f6d028;--sc-table-coords-color:#c6e590;--sc-table-masks-color:#c8c8c8;--sc-table-attrs-color:#ff5555;--sc-table-header-font-color:#111111;}.sc-wrap{font-size:14px;min-width:300px;max-width:800px;}.sc-var-attrs .sc-wrap{padding-left:3em;}.sc-header{padding-top:6px;padding-bottom:6px;margin-bottom:4px;border-bottom:solid 1px #ddd;}.sc-header > div,.sc-header > ul{display:inline;margin-top:0;margin-bottom:0;}.sc-obj-type,.sc-array-name{margin-left:2px;margin-right:10px;}.sc-obj-type{color:var(--sc-font-color1);}.sc-underlying-size{color:var(--sc-font-color2);}.sc-sections,.reveal .sc-sections{padding-left:0 !important;display:grid;grid-template-columns:150px auto auto auto 1fr 20px 20px;}.sc-section-item{display:contents;}.sc-section-item input{display:none;}.sc-section-item input:enabled + label{cursor:pointer;color:var(--sc-font-color1);}.sc-section-item input:enabled + label:hover{color:var(--sc-font-color0);}.sc-section-summary{grid-column:1;font-weight:500;}.sc-section-summary > span{display:inline-block;padding-left:0.5em;}.sc-section-summary-in:disabled + label{color:var(--sc-font-color1);}.sc-section-summary-in + label:before{display:inline-block;content:'►';font-size:11px;width:15px;text-align:center;}.sc-section-summary-in:disabled + label:before{color:var(--sc-font-color3);}.sc-section-summary-in:checked + label:before{content:'▼';}.sc-section-summary-in:checked + label > span{display:none;}.sc-section-summary,.sc-section-inline-details{padding-top:4px;padding-bottom:4px;}.sc-section-inline-details{grid-column:2 / 6;}.sc-section-details{display:none;grid-column:1 / -1;margin-bottom:5px;}.sc-section-summary-in:checked ~ .sc-section-details{display:contents;}.sc-array-wrap{grid-column:1 / -1;display:grid;grid-template-columns:20px auto;}.sc-array-wrap > label{grid-column:1;vertical-align:top;}.sc-preview{color:var(--sc-font-color2);}.sc-array-preview,.sc-array-data{padding:0 5px !important;grid-column:2;}.sc-array-data,.sc-array-in:checked ~ .sc-array-preview{display:none;}.sc-array-in:checked ~ .sc-array-data,.sc-array-preview{display:inline-block;}.sc-dim-list{display:inline-block !important;list-style:none;padding:0 !important;margin:0;}.sc-dim-list li{display:inline-block;padding:0;margin:0!important;}.sc-dim-list:before{content:'(';}.sc-dim-list:after{content:')';}.sc-dim-list li:not(:last-child):after{content:',';padding-right:5px;}.sc-dim-list li span,.sc-standalone-var-name > span span,.sc-var-name > span span{padding:0 !important;}.sc-aligned{font-weight:bold;}.sc-var-list,.sc-var-item,.reveal .sc-var-list,.reveal .sc-var-item{display:contents;}.sc-var-item > div,.sc-var-item label,.sc-var-item > .sc-var-name span{background-color:var(--sc-background-color1);margin-bottom:0;}.sc-var-item > .sc-var-name:hover span{padding-right:5px;}.sc-var-list > li:nth-child(odd) > div,.sc-var-list > li:nth-child(odd) > label,.sc-var-list > li:nth-child(odd) > .sc-var-name span{background-color:var(--sc-background-color2);}.sc-var-name{grid-column:1;}.sc-var-dims{grid-column:2;}.sc-var-dtype{grid-column:3;text-align:right;color:var(--sc-font-color2);}.sc-var-unit{grid-column:4;text-align:left;color:var(--sc-font-color1);max-width:50pt;text-overflow:ellipsis;}.sc-value-preview{grid-column:5;}.sc-var-preview-variances{text-align:right;}.sc-sections .sc-section-item .sc-section-summary,.sc-sections .sc-section-item .sc-section-inline-details,.sc-section-item .sc-var-list .sc-var-item > div,.sc-section-item .sc-var-list .sc-var-item > label,.sc-section-details .sc-var-list .sc-var-item > div,.sc-section-details .sc-var-list .sc-var-item > label{margin-top:0;margin-bottom:0;}.sc-var-name,.sc-var-dims,.sc-var-dtype,.sc-var-unit,.sc-preview,.sc-attrs dt{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;padding-right:10px;}.sc-var-name:hover,.sc-var-dims:hover,.sc-var-dtype:hover,.sc-var-unit:hover,.sc-attrs dt:hover{overflow:visible;width:auto;z-index:1;}.sc-var-attrs{display:block;}.sc-var-data,.reveal .sc-var-data{display:none;}.sc-var-attrs,.sc-var-data{background-color:var(--sc-background-color0) !important;padding-bottom:5px !important;}.sc-var-attrs-in:checked ~ .sc-var-attrs{display:none;}.sc-var-data-in:checked ~ .sc-var-data{display:block;}.sc-var-data > table{float:right;}.sc-var-name span,.sc-var-data{padding-left:25px !important;}.sc-var-attrs,.sc-var-data{grid-column:1 / -1;}dl.sc-attrs{padding:0;margin:0;display:grid;grid-template-columns:125px auto;}.sc-attrs dt,dd{padding:0;margin:0;float:left;padding-right:10px;width:auto;}.sc-attrs dt{font-weight:normal;grid-column:1;}.sc-attrs dt:hover span{display:inline-block;padding-right:10px;}.sc-attrs dd{grid-column:2;white-space:pre-wrap;word-break:break-all;}.sc-icon-database,.sc-icon-file-text2{display:inline-block;vertical-align:middle;width:1em;height:1.5em !important;stroke-width:0;stroke:currentColor;fill:currentColor;}label.sc-hide-icon svg{opacity:0;}.sc-standalone-var-name{grid-column:1/3;}.sc-standalone-var-name span{padding-left:25px;padding-right:10px;}.sc-table{border-collapse:collapse;}.sc-title{font-weight:bold;font-size:1.5em;}.sc-subtitle{font-weight:normal;font-style:italic;text-align:left;font-size:1.2em;padding:1px;}.sc-table th,.sc-table td{border:1px solid var(--sc-inverse-background-color0);padding:0 5px 0 5px;}.sc-table th{text-align:center;}.sc-table tr{background-color:var(--sc-background-color1);text-align:right;}.sc-table tr:hover{background-color:var(--sc-background-color2);}.sc-table th.sc-data{background-color:var(--sc-table-data-color);color:var(--sc-table-header-font-color);}.sc-table th.sc-coords{background-color:var(--sc-table-coords-color);color:var(--sc-table-header-font-color);}.sc-table th.sc-masks{background-color:var(--sc-table-masks-color);color:var(--sc-table-header-font-color);}.sc-table th.sc-attrs{background-color:var(--sc-table-attrs-color);color:var(--sc-table-header-font-color);}.sc-table th.sc-subheader{background-color:var(--sc-background-color2);}.sc-table td.sc-padding{background-color:var(--sc-background-color1);border:0 solid var(--sc-background-color1);height:1.2em;}.sc-label{fill:var(--sc-font-color0,#444444);text-anchor:middle;}.sc-name{fill:var(--sc-font-color0,#111111);}.sc-inset-line{stroke:var(--sc-font-color1);stroke-width:0.05;stroke-dasharray:0.2,0.2;}.sc-log-wrap{height:25ex;resize:vertical;overflow-y:scroll;display:flex;flex-direction:column-reverse;border:1px solid;border-color:var(--jp-border-color2);background-color:var(--sc-background-color1);}div.sc-log{line-height:2.5ex;}table.sc-log{table-layout:auto;border-collapse:collapse;}tr.sc-log:nth-child(even){background-color:var(--sc-background-color0);}tr.sc-log > td{vertical-align:top;padding-bottom:0.5ex;}.sc-log-time-stamp{min-width:22ch;font-family:var(--jp-code-font-family);color:var(--sc-font-color2);}.sc-log-level{min-width:10ch;}tr.sc-log-debug td.sc-log-level{color:var(--jp-accent-color1);}tr.sc-log-info td.sc-log-level{color:var(--jp-info-color1);}tr.sc-log-warning td.sc-log-level{color:var(--jp-warn-color1);}tr.sc-log-error td.sc-log-level{font-weight:bold;color:var(--jp-error-color2);}tr.sc-log-critical td.sc-log-level{font-weight:bold;color:var(--sc-background-color0);background-color:var(--jp-error-color1);}.sc-log-message{white-space:pre-wrap;width:100%;}.sc-log-html-payload{white-space:normal;}.sc-log-name{padding-right:0.5em;text-align:right;white-space:pre-wrap;color:var(--sc-font-color3);}</style><div class='sc-wrap sc-root'><div class='sc-header'><div class='sc-obj-type'>scipp.DataArray (25.25 MB <span class='sc-underlying-size'>out of 25.25 MB</span>)</div></div><ul class='sc-sections'><li class='sc-section-item'><input id='section-ad15514e-e8ff-424b-b3c4-5452a25587ed' class='sc-section-summary-in' type='checkbox' disabled ><label for='section-ad15514e-e8ff-424b-b3c4-5452a25587ed' class='sc-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='sc-section-inline-details'><ul class='sc-dim-list'><li><span class='sc-has-index'>spectrum</span>: 769</li><li><span class='sc-has-index'>tof</span>: 1</li></ul></div><div class='sc-section-details'></div></li><li class='sc-section-item'><input id='section-099adf3e-e1fd-4656-94c0-8510b5a0256f' class='sc-section-summary-in' type='checkbox'  checked><label for='section-099adf3e-e1fd-4656-94c0-8510b5a0256f' class='sc-section-summary' >Coordinates: <span>(6)</span></label><div class='sc-section-inline-details'></div><div class='sc-section-details'><ul class='sc-var-list'><li class='sc-var-item'><div class='sc-var-name'><span class='sc-aligned'>position</span></div><div class='sc-var-dims'>(spectrum)</div><div class='sc-var-dtype'>vector3</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>[nan nan nan], [ 0.     -0.2074  3.62  ], ..., [0.         0.19028882 3.62      ], [0.       0.190808 3.62    ]</div></span></div><input id='attrs-4929214d-ec80-4bc1-8d76-cb0b6bfaf2f0' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-4929214d-ec80-4bc1-8d76-cb0b6bfaf2f0' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-0196469a-47ff-4cbd-924a-f99b57131921' class='sc-var-data-in' type='checkbox'><label for='data-0196469a-47ff-4cbd-924a-f99b57131921' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([[        nan,         nan,         nan],
       [ 0.        , -0.2074    ,  3.62      ],
       [ 0.        , -0.20688082,  3.62      ],
       ...,
       [ 0.        ,  0.18976965,  3.62      ],
       [ 0.        ,  0.19028882,  3.62      ],
       [ 0.        ,  0.190808  ,  3.62      ]])</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span class='sc-aligned'>sample_position</span></div><div class='sc-var-dims'>()</div><div class='sc-var-dtype'>vector3</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>[0. 0. 0.]</div></span></div><input id='attrs-dac41138-de95-4241-b7af-00c8e00084a5' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-dac41138-de95-4241-b7af-00c8e00084a5' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-21fc54d7-30c5-44e8-8a8f-765d0434d832' class='sc-var-data-in' type='checkbox'><label for='data-21fc54d7-30c5-44e8-8a8f-765d0434d832' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([0., 0., 0.])</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span class='sc-aligned'>source_position</span></div><div class='sc-var-dims'>()</div><div class='sc-var-dtype'>vector3</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>[  0.     0.   -23.83]</div></span></div><input id='attrs-b66e7ea0-e329-4ce8-97b8-90a8baf700f4' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-b66e7ea0-e329-4ce8-97b8-90a8baf700f4' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-f7561c57-10a1-4c73-b8fc-82a3f0a275cc' class='sc-var-data-in' type='checkbox'><label for='data-f7561c57-10a1-4c73-b8fc-82a3f0a275cc' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([  0.  ,   0.  , -23.83])</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span class='sc-aligned'>spectrum</span></div><div class='sc-var-dims'>(spectrum)</div><div class='sc-var-dtype'>int32</div><div class='sc-var-unit'></div><div class='sc-value-preview sc-preview'><span><div>4, 5, ..., 771, 772</div></span></div><input id='attrs-7dafc296-a668-4984-a3b5-16abf085d7a8' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-7dafc296-a668-4984-a3b5-16abf085d7a8' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-de5e2a52-6966-4c7f-bc7f-44918f960261' class='sc-var-data-in' type='checkbox'><label for='data-de5e2a52-6966-4c7f-bc7f-44918f960261' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([  4,   5,   6,   7,   8,   9,  10,  11,  12,  13,  14,  15,  16,
        17,  18,  19,  20,  21,  22,  23,  24,  25,  26,  27,  28,  29,
        30,  31,  32,  33,  34,  35,  36,  37,  38,  39,  40,  41,  42,
        43,  44,  45,  46,  47,  48,  49,  50,  51,  52,  53,  54,  55,
        56,  57,  58,  59,  60,  61,  62,  63,  64,  65,  66,  67,  68,
        69,  70,  71,  72,  73,  74,  75,  76,  77,  78,  79,  80,  81,
        82,  83,  84,  85,  86,  87,  88,  89,  90,  91,  92,  93,  94,
        95,  96,  97,  98,  99, 100, 101, 102, 103, 104, 105, 106, 107,
       108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120,
       121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133,
       134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146,
       147, 148, 149, 150, 151, 152, 153, 154, 155, 156, 157, 158, 159,
       160, 161, 162, 163, 164, 165, 166, 167, 168, 169, 170, 171, 172,
       173, 174, 175, 176, 177, 178, 179, 180, 181, 182, 183, 184, 185,
       186, 187, 188, 189, 190, 191, 192, 193, 194, 195, 196, 197, 198,
       199, 200, 201, 202, 203, 204, 205, 206, 207, 208, 209, 210, 211,
       212, 213, 214, 215, 216, 217, 218, 219, 220, 221, 222, 223, 224,
       225, 226, 227, 228, 229, 230, 231, 232, 233, 234, 235, 236, 237,
       238, 239, 240, 241, 242, 243, 244, 245, 246, 247, 248, 249, 250,
       251, 252, 253, 254, 255, 256, 257, 258, 259, 260, 261, 262, 263,
       264, 265, 266, 267, 268, 269, 270, 271, 272, 273, 274, 275, 276,
       277, 278, 279, 280, 281, 282, 283, 284, 285, 286, 287, 288, 289,
       290, 291, 292, 293, 294, 295, 296, 297, 298, 299, 300, 301, 302,
       303, 304, 305, 306, 307, 308, 309, 310, 311, 312, 313, 314, 315,
       316, 317, 318, 319, 320, 321, 322, 323, 324, 325, 326, 327, 328,
       329, 330, 331, 332, 333, 334, 335, 336, 337, 338, 339, 340, 341,
       342, 343, 344, 345, 346, 347, 348, 349, 350, 351, 352, 353, 354,
       355, 356, 357, 358, 359, 360, 361, 362, 363, 364, 365, 366, 367,
       368, 369, 370, 371, 372, 373, 374, 375, 376, 377, 378, 379, 380,
       381, 382, 383, 384, 385, 386, 387, 388, 389, 390, 391, 392, 393,
       394, 395, 396, 397, 398, 399, 400, 401, 402, 403, 404, 405, 406,
       407, 408, 409, 410, 411, 412, 413, 414, 415, 416, 417, 418, 419,
       420, 421, 422, 423, 424, 425, 426, 427, 428, 429, 430, 431, 432,
       433, 434, 435, 436, 437, 438, 439, 440, 441, 442, 443, 444, 445,
       446, 447, 448, 449, 450, 451, 452, 453, 454, 455, 456, 457, 458,
       459, 460, 461, 462, 463, 464, 465, 466, 467, 468, 469, 470, 471,
       472, 473, 474, 475, 476, 477, 478, 479, 480, 481, 482, 483, 484,
       485, 486, 487, 488, 489, 490, 491, 492, 493, 494, 495, 496, 497,
       498, 499, 500, 501, 502, 503, 504, 505, 506, 507, 508, 509, 510,
       511, 512, 513, 514, 515, 516, 517, 518, 519, 520, 521, 522, 523,
       524, 525, 526, 527, 528, 529, 530, 531, 532, 533, 534, 535, 536,
       537, 538, 539, 540, 541, 542, 543, 544, 545, 546, 547, 548, 549,
       550, 551, 552, 553, 554, 555, 556, 557, 558, 559, 560, 561, 562,
       563, 564, 565, 566, 567, 568, 569, 570, 571, 572, 573, 574, 575,
       576, 577, 578, 579, 580, 581, 582, 583, 584, 585, 586, 587, 588,
       589, 590, 591, 592, 593, 594, 595, 596, 597, 598, 599, 600, 601,
       602, 603, 604, 605, 606, 607, 608, 609, 610, 611, 612, 613, 614,
       615, 616, 617, 618, 619, 620, 621, 622, 623, 624, 625, 626, 627,
       628, 629, 630, 631, 632, 633, 634, 635, 636, 637, 638, 639, 640,
       641, 642, 643, 644, 645, 646, 647, 648, 649, 650, 651, 652, 653,
       654, 655, 656, 657, 658, 659, 660, 661, 662, 663, 664, 665, 666,
       667, 668, 669, 670, 671, 672, 673, 674, 675, 676, 677, 678, 679,
       680, 681, 682, 683, 684, 685, 686, 687, 688, 689, 690, 691, 692,
       693, 694, 695, 696, 697, 698, 699, 700, 701, 702, 703, 704, 705,
       706, 707, 708, 709, 710, 711, 712, 713, 714, 715, 716, 717, 718,
       719, 720, 721, 722, 723, 724, 725, 726, 727, 728, 729, 730, 731,
       732, 733, 734, 735, 736, 737, 738, 739, 740, 741, 742, 743, 744,
       745, 746, 747, 748, 749, 750, 751, 752, 753, 754, 755, 756, 757,
       758, 759, 760, 761, 762, 763, 764, 765, 766, 767, 768, 769, 770,
       771, 772], dtype=int32)</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span class='sc-aligned'>theta</span></div><div class='sc-var-dims'>()</div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>deg</div><div class='sc-value-preview sc-preview'><span><div>0.299933522939682</div></span></div><input id='attrs-8f46cb2c-94e1-4c7b-acb0-7002df37f1cd' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-8f46cb2c-94e1-4c7b-acb0-7002df37f1cd' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-44be575d-5a86-49a8-b17b-371e01ac4694' class='sc-var-data-in' type='checkbox'><label for='data-44be575d-5a86-49a8-b17b-371e01ac4694' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array(0.29993352)</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span class='sc-aligned'>tof</span></div><div class='sc-var-dims'>(tof [bin-edge])</div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>µs</div><div class='sc-value-preview sc-preview'><span><div>9.328, 1.000e+05</div></span></div><input id='attrs-3b33f24e-9839-45ab-89bd-59631941ff81' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-3b33f24e-9839-45ab-89bd-59631941ff81' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-0cfa647d-4814-480f-8b3f-31931b9c4277' class='sc-var-data-in' type='checkbox'><label for='data-0cfa647d-4814-480f-8b3f-31931b9c4277' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([9.32773781e+00, 1.00000383e+05])</pre></span></li></ul></div></li><li class='sc-section-item'><input id='section-7e57a9bf-431e-45be-b9c6-461ad6e40c02' class='sc-section-summary-in' type='checkbox'  checked><label for='section-7e57a9bf-431e-45be-b9c6-461ad6e40c02' class='sc-section-summary' >Data: <span>(1)</span></label><div class='sc-section-inline-details'></div><div class='sc-section-details'><ul class='sc-var-list'><li class='sc-var-item'><div class='sc-var-name'><span></span></div><div class='sc-var-dims'>(spectrum, tof)</div><div class='sc-var-dtype'>DataArrayView</div><div class='sc-var-unit'></div><div class='sc-value-preview sc-preview'><span><div>binned data [len=0, len=0, ..., len=1, len=1]</div></span></div><input id='attrs-e143bd91-60f3-4ea4-a86e-23fe3d7c52d3' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-e143bd91-60f3-4ea4-a86e-23fe3d7c52d3' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-7bfa8f8c-ff2c-4ff7-aa81-3fdcf06f6538' class='sc-var-data-in' type='checkbox'><label for='data-7bfa8f8c-ff2c-4ff7-aa81-3fdcf06f6538' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>dim=&#x27;event&#x27;,
content=DataArray(
          dims=(event: 1101422),
          data=float32[counts],
          coords={&#x27;tof&#x27;:float64[µs], &#x27;pulse_time&#x27;:datetime64[ns]})</pre></li></ul></div></li></ul></div></div></div>
</div>
</section>
<section id="Populating-the-ORSO-header">
<h2>Populating the ORSO header<a class="headerlink" href="#Populating-the-ORSO-header" title="Permalink to this headline">#</a></h2>
<p>We will write the reduced data file following the <cite>ORSO `</cite>.ort`` standard &lt;<a class="reference external" href="https://www.reflectometry.org/file_format/specification">https://www.reflectometry.org/file_format/specification</a>&gt;`__, to enable a metadata rich header. We will create an empty header and then populate this.</p>
<section id="The-data-source-information">
<h3>The data source information<a class="headerlink" href="#The-data-source-information" title="Permalink to this headline">#</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">header</span> <span class="o">=</span> <span class="n">fileio</span><span class="o">.</span><span class="n">orso</span><span class="o">.</span><span class="n">Orso</span><span class="o">.</span><span class="n">empty</span><span class="p">()</span>

<span class="n">header</span><span class="o">.</span><span class="n">data_source</span><span class="o">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">fileio</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">Person</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Joshanial F. K. Cooper&quot;</span><span class="p">,</span>
    <span class="n">affiliation</span><span class="o">=</span><span class="s2">&quot;ISIS Neutron and Muon Source&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">header</span><span class="o">.</span><span class="n">data_source</span><span class="o">.</span><span class="n">experiment</span> <span class="o">=</span> <span class="n">fileio</span><span class="o">.</span><span class="n">data_source</span><span class="o">.</span><span class="n">Experiment</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;OFFSPEC Sample Data&quot;</span><span class="p">,</span>
    <span class="n">instrument</span><span class="o">=</span><span class="s2">&quot;OFFSPEC&quot;</span><span class="p">,</span>
    <span class="n">start_date</span><span class="o">=</span><span class="s2">&quot;2020-12-14T10:34:02&quot;</span><span class="p">,</span>
    <span class="n">probe</span><span class="o">=</span><span class="s2">&quot;neutron&quot;</span><span class="p">,</span>
    <span class="n">facility</span><span class="o">=</span><span class="s2">&quot;RAL/ISIS/OFFSPEC&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">header</span><span class="o">.</span><span class="n">data_source</span><span class="o">.</span><span class="n">sample</span> <span class="o">=</span> <span class="n">fileio</span><span class="o">.</span><span class="n">data_source</span><span class="o">.</span><span class="n">Sample</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;QCS sample&quot;</span><span class="p">,</span>
    <span class="n">category</span><span class="o">=</span><span class="s2">&quot;gas/solid&quot;</span><span class="p">,</span>
    <span class="n">composition</span><span class="o">=</span><span class="s2">&quot;Air | Si(790 A) | Cu(300 A) | SiO2&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">header</span><span class="o">.</span><span class="n">data_source</span><span class="o">.</span><span class="n">measurement</span> <span class="o">=</span> <span class="n">fileio</span><span class="o">.</span><span class="n">data_source</span><span class="o">.</span><span class="n">Measurement</span><span class="p">(</span>
    <span class="n">instrument_settings</span><span class="o">=</span><span class="n">fileio</span><span class="o">.</span><span class="n">data_source</span><span class="o">.</span><span class="n">InstrumentSettings</span><span class="p">(</span>
        <span class="n">incident_angle</span><span class="o">=</span><span class="n">fileio</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">Value</span><span class="p">(</span>
            <span class="n">sample</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s2">&quot;theta&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">sample</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s2">&quot;theta&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span>
        <span class="p">),</span>
        <span class="n">wavelength</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">polarization</span><span class="o">=</span><span class="s2">&quot;unpolarized&quot;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">data_files</span><span class="o">=</span><span class="p">[</span>
        <span class="n">offspec</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">offspec</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">direct_beam</span><span class="p">()</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
    <span class="p">],</span>
    <span class="n">scheme</span><span class="o">=</span><span class="s2">&quot;energy-dispersive&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="The-reduction-details">
<h3>The reduction details<a class="headerlink" href="#The-reduction-details" title="Permalink to this headline">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">reduction</span></code> section can start to be populated also. Entries such as <code class="docutils literal notranslate"><span class="pre">corrections</span></code> will be filled up through the reduction process.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">header</span><span class="o">.</span><span class="n">reduction</span><span class="o">.</span><span class="n">software</span> <span class="o">=</span> <span class="n">fileio</span><span class="o">.</span><span class="n">reduction</span><span class="o">.</span><span class="n">Software</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;ess&quot;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="n">ess</span><span class="o">.</span><span class="n">__version__</span><span class="p">,</span> <span class="n">platform</span><span class="o">=</span><span class="n">platform</span><span class="o">.</span><span class="n">platform</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">header</span><span class="o">.</span><span class="n">reduction</span><span class="o">.</span><span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<span class="n">header</span><span class="o">.</span><span class="n">reduction</span><span class="o">.</span><span class="n">creator</span> <span class="o">=</span> <span class="n">fileio</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">Person</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;I. D. Scientist&quot;</span><span class="p">,</span>
    <span class="n">affiliation</span><span class="o">=</span><span class="s2">&quot;European Spallation Source&quot;</span><span class="p">,</span>
    <span class="n">contact</span><span class="o">=</span><span class="s2">&quot;i.d.scientist@ess.eu&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">header</span><span class="o">.</span><span class="n">reduction</span><span class="o">.</span><span class="n">corrections</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">header</span><span class="o">.</span><span class="n">reduction</span><span class="o">.</span><span class="n">computer</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">node</span><span class="p">()</span>
<span class="n">header</span><span class="o">.</span><span class="n">reduction</span><span class="o">.</span><span class="n">script</span> <span class="o">=</span> <span class="s2">&quot;offspec_mantid.ipynb&quot;</span>
</pre></div>
</div>
</div>
<p>To ensure that the header object is carried through the process, we assign it to the sample <code class="docutils literal notranslate"><span class="pre">scipp.DataArray</span></code>. The direct beam header object will be overwritten at the normalisation step so we will keep this empty.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sample</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;orso&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
<span class="n">direct_beam</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;orso&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span><span class="n">fileio</span><span class="o">.</span><span class="n">orso</span><span class="o">.</span><span class="n">Orso</span><span class="o">.</span><span class="n">empty</span><span class="p">())</span>
</pre></div>
</div>
</div>
</section>
<section id="Correcting-the-position-of-detector-pixels">
<h3>Correcting the position of detector pixels<a class="headerlink" href="#Correcting-the-position-of-detector-pixels" title="Permalink to this headline">#</a></h3>
<p>The pixel positions in the sample data must be modified to account for the transformation on the detector by rotating it around the sample. We can achieve this by understanding that the sample has been rotated by some amount and that sample measurement has the specular peak at the same pixel as the direct beam measurement has the direct beam. Therefore, we move the sample detector along the arc of the sample rotation by <span class="math notranslate nohighlight">\(2\omega\)</span> (in the OFFSPEC files, <span class="math notranslate nohighlight">\(\omega\)</span> is called <code class="docutils literal notranslate"><span class="pre">'Theta'</span></code>,
which we stored as <code class="docutils literal notranslate"><span class="pre">'theta'</span></code> earlier).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipp.spatial</span> <span class="kn">import</span> <span class="n">rotations_from_rotvecs</span>

<span class="k">def</span> <span class="nf">pixel_position_correction</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">sc</span><span class="o">.</span><span class="n">DataArray</span><span class="p">):</span>
    <span class="n">rotation</span> <span class="o">=</span> <span class="n">rotations_from_rotvecs</span><span class="p">(</span><span class="n">rotation_vectors</span><span class="o">=</span><span class="n">sc</span><span class="o">.</span><span class="n">vector</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">data</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;theta&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="n">sc</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">deg</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">rotation</span> <span class="o">*</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;position&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">data</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;sample_position&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Correcting pixel positions in &#39;sample.nxs&#39;&quot;</span><span class="p">)</span>
<span class="n">sample</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;position&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pixel_position_correction</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span>
<span class="n">sample</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;orso&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">data_source</span><span class="o">.</span><span class="n">measurement</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="s1">&#39;Pixel positions corrected&#39;</span>
</pre></div>
</div>
</div>
<p>We can visualize the data with a plot. In this plot of <code class="docutils literal notranslate"><span class="pre">sample</span></code>, we can see the specular intensity at around spectrum numbers 400-410. There is a more intense region, closer to spectrum number 300, which comes from the direct beam of neutrons traveling straight through our sample.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sample</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">tof</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../../_images/instruments_external_offspec_offspec_reduction_17_0.svg" src="../../../_images/instruments_external_offspec_offspec_reduction_17_0.svg" /></div>
</div>
<p>A region of interest is then defined for the detector. This is defined as twenty-five pixels around the specular peak or the direct beam. The <code class="docutils literal notranslate"><span class="pre">scipp.DataArray</span></code> is concatenated along the <code class="docutils literal notranslate"><span class="pre">'spectrum'</span></code> coordinate at this stage, essentially collapsing all of the events onto a single pixel.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sample_roi</span> <span class="o">=</span> <span class="n">sample</span><span class="p">[</span><span class="s1">&#39;spectrum&#39;</span><span class="p">,</span> <span class="mi">389</span><span class="p">:</span><span class="mi">415</span><span class="p">]</span><span class="o">.</span><span class="n">bins</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="s1">&#39;spectrum&#39;</span><span class="p">)</span>
<span class="n">direct_beam_roi</span> <span class="o">=</span> <span class="n">direct_beam</span><span class="p">[</span><span class="s1">&#39;spectrum&#39;</span><span class="p">,</span> <span class="mi">389</span><span class="p">:</span><span class="mi">415</span><span class="p">]</span><span class="o">.</span><span class="n">bins</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="s1">&#39;spectrum&#39;</span><span class="p">)</span>

<span class="n">sample_roi</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;orso&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">reduction</span><span class="o">.</span><span class="n">corrections</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;region of interest defined as spectrum 389:415&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<p>The position of these events is then defined as the centre of the region of interest.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sample_roi</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;position&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sample</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;position&#39;</span><span class="p">][</span><span class="mi">401</span><span class="p">]</span>
<span class="n">direct_beam_roi</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;position&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">direct_beam</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;position&#39;</span><span class="p">][</span><span class="mi">401</span><span class="p">]</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="Coordinate-transform-graph">
<h2>Coordinate transform graph<a class="headerlink" href="#Coordinate-transform-graph" title="Permalink to this headline">#</a></h2>
<p>To compute the wavelength <span class="math notranslate nohighlight">\(\lambda\)</span>, the scattering angle <span class="math notranslate nohighlight">\(\theta\)</span>, and the <span class="math notranslate nohighlight">\(Q\)</span> vector for our data we can use a coordinate transform graph. The reflectometry graph is discussed in detail in the <a class="reference external" href="https://scipp.github.io/ess/instruments/amor/amor_reduction.html">Amor reduction notebook</a> and the one used here is nearly identical. The only difference is the Amor instrument uses choppers to define the pulse of neutrons, which is not the case here. The OFFSPEC graph is the
standard reflectometry graph, shown below.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">reflectometry</span><span class="o">.</span><span class="n">conversions</span><span class="o">.</span><span class="n">specular_reflection</span><span class="p">()}</span>
<span class="n">sc</span><span class="o">.</span><span class="n">show_graph</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">simplified</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../../_images/instruments_external_offspec_offspec_reduction_23_0.svg" src="../../../_images/instruments_external_offspec_offspec_reduction_23_0.svg" /></div>
</div>
</section>
<section id="Computing-the-wavelength">
<h2>Computing the wavelength<a class="headerlink" href="#Computing-the-wavelength" title="Permalink to this headline">#</a></h2>
<p>The neutron wavelengths can be computed with <code class="docutils literal notranslate"><span class="pre">transform_coords</span></code> and the graph shown above. We will only use neutrons in the wavelength range of 2 Å to 15.0 Å.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wavelength_edges</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;wavelength&#39;</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;angstrom&#39;</span><span class="p">)</span>
<span class="n">sample_wav</span> <span class="o">=</span> <span class="n">reflectometry</span><span class="o">.</span><span class="n">conversions</span><span class="o">.</span><span class="n">tof_to_wavelength</span><span class="p">(</span><span class="n">sample_roi</span><span class="p">,</span> <span class="n">wavelength_edges</span><span class="p">,</span><span class="n">graph</span><span class="o">=</span><span class="n">graph</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Since the direct beam measurement is <strong>not</strong> a reflectometry measurement, we use the <code class="docutils literal notranslate"><span class="pre">no_scatter_graph</span></code> to convert this to wavelength.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">no_scatter_graph</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">scn</span><span class="o">.</span><span class="n">conversion</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">beamline</span><span class="o">.</span><span class="n">beamline</span><span class="p">(</span><span class="n">scatter</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
                    <span class="o">**</span><span class="n">scn</span><span class="o">.</span><span class="n">conversion</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">tof</span><span class="o">.</span><span class="n">elastic_wavelength</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="s1">&#39;tof&#39;</span><span class="p">)}</span>
<span class="n">sc</span><span class="o">.</span><span class="n">show_graph</span><span class="p">(</span><span class="n">no_scatter_graph</span><span class="p">,</span> <span class="n">simplified</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">direct_beam_wav</span> <span class="o">=</span> <span class="n">direct_beam_roi</span><span class="o">.</span><span class="n">transform_coords</span><span class="p">(</span><span class="s1">&#39;wavelength&#39;</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="n">no_scatter_graph</span><span class="p">)</span>
<span class="n">direct_beam_wav</span> <span class="o">=</span> <span class="n">direct_beam_wav</span><span class="o">.</span><span class="n">bin</span><span class="p">(</span><span class="n">wavelength</span><span class="o">=</span><span class="n">wavelength_edges</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Normalization-by-monitor">
<h2>Normalization by monitor<a class="headerlink" href="#Normalization-by-monitor" title="Permalink to this headline">#</a></h2>
<p>It is necessary to normalize the sample and direct beam measurements by the summed monitor counts, which accounts for different lengths of measurement and long-timescale natural variation in the pulse. This will ensure that the final data has the correct scaling when the reflectivity data is normalized. First, we convert the data to wavelength, using the <code class="docutils literal notranslate"><span class="pre">no_scatter_graph</span></code> used previously for the direct beam.</p>
<p>The most reliable monitor for the OFFSPEC instrument is <code class="docutils literal notranslate"><span class="pre">'monitor2'</span></code> in the file, therefore this is used.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sample_mon_wav</span> <span class="o">=</span> <span class="n">sample_full</span><span class="p">[</span><span class="s2">&quot;monitors&quot;</span><span class="p">][</span><span class="s2">&quot;monitor2&quot;</span><span class="p">][</span><span class="s2">&quot;data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">transform_coords</span><span class="p">(</span>
    <span class="s2">&quot;wavelength&quot;</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="n">no_scatter_graph</span>
<span class="p">)</span>
<span class="n">direct_beam_mon_wav</span> <span class="o">=</span> <span class="n">direct_beam_full</span><span class="p">[</span><span class="s2">&quot;monitors&quot;</span><span class="p">][</span><span class="s2">&quot;monitor2&quot;</span><span class="p">][</span><span class="s2">&quot;data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">transform_coords</span><span class="p">(</span>
    <span class="s2">&quot;wavelength&quot;</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="n">no_scatter_graph</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>A background subtraction is then performed on the monitor data, where the background is taken as any counts at wavelengths greater than 15 Å.</p>
<div class="admonition note">
<p class="admonition-title"><strong>Note</strong></p>
<p>We need to drop the variances of the monitor (using <code class="docutils literal notranslate"><span class="pre">sc.values</span></code>) because the monitor gets broadcast across all detector pixels. This would introduce correlations in the results and is thus not allowed by Scipp. See <a class="reference external" href="http://dx.doi.org/10.3233/JNR-220049">Heybrock et al. (2023)</a>.</p>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wav_min</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="s1">&#39;angstrom&#39;</span><span class="p">)</span>
<span class="n">wav_max</span> <span class="o">=</span> <span class="mi">15</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="s1">&#39;angstrom&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sample_mon_wav</span> <span class="o">-=</span> <span class="n">sc</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="n">sample_mon_wav</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">,</span> <span class="n">wav_max</span><span class="p">:]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
<span class="n">direct_beam_mon_wav</span> <span class="o">-=</span> <span class="n">sc</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="n">direct_beam_mon_wav</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">,</span> <span class="n">wav_max</span><span class="p">:]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
<span class="n">sample_wav</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;orso&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">reduction</span><span class="o">.</span><span class="n">corrections</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;monitor background subtraction, background above 15 Å&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<p>The monitors are then summed along the <code class="docutils literal notranslate"><span class="pre">'wavelength'</span></code> and this value is used to normalise the data.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sample_mon_wav_sum</span> <span class="o">=</span> <span class="n">sample_mon_wav</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">,</span> <span class="n">wav_min</span><span class="p">:</span><span class="n">wav_max</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">direct_beam_mon_wav_sum</span> <span class="o">=</span> <span class="n">direct_beam_mon_wav</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">,</span> <span class="n">wav_min</span><span class="p">:</span><span class="n">wav_max</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">sample_norm</span> <span class="o">=</span> <span class="n">sample_wav</span> <span class="o">/</span> <span class="n">sc</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="n">sample_mon_wav_sum</span><span class="p">)</span>
<span class="n">direct_beam_norm</span> <span class="o">=</span> <span class="n">direct_beam_wav</span> <span class="o">/</span> <span class="n">sc</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="n">direct_beam_mon_wav_sum</span><span class="p">)</span>
<span class="n">sample_wav</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;orso&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">reduction</span><span class="o">.</span><span class="n">corrections</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;normalisation by summed monitor&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</section>
<section id="Normalisation-of-sample-by-direct-beam">
<h2>Normalisation of sample by direct beam<a class="headerlink" href="#Normalisation-of-sample-by-direct-beam" title="Permalink to this headline">#</a></h2>
<p>The sample and direct beam measurements (which have been normalised by monitor counts) are then histogrammed in wavelength to 100 geometrically spaced points. The histogrammed direct beam is then used to normalised the sample.</p>
<p>Importantly, some relevant metadata (including the ORSO header object) is carried over.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">edges</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">geomspace</span><span class="p">(</span>
    <span class="n">dim</span><span class="o">=</span><span class="s2">&quot;wavelength&quot;</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">sc</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">angstrom</span>
<span class="p">)</span>
<span class="n">sample_norm_hist</span> <span class="o">=</span> <span class="n">sample_norm</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">wavelength</span><span class="o">=</span><span class="n">edges</span><span class="p">)</span>
<span class="n">sample_norm_hist</span><span class="o">.</span><span class="n">coords</span><span class="o">.</span><span class="n">set_aligned</span><span class="p">(</span><span class="s1">&#39;theta&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">direct_beam_norm_hist</span> <span class="o">=</span> <span class="n">direct_beam_norm</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">wavelength</span><span class="o">=</span><span class="n">edges</span><span class="p">)</span>
<span class="n">direct_beam_norm_hist</span><span class="o">.</span><span class="n">coords</span><span class="o">.</span><span class="n">set_aligned</span><span class="p">(</span><span class="s1">&#39;theta&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

<span class="n">norm_wav</span> <span class="o">=</span> <span class="n">sample_norm_hist</span> <span class="o">/</span> <span class="n">direct_beam_norm_hist</span>
<span class="n">norm_wav</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;orso&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sample_wav</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;orso&quot;</span><span class="p">]</span>
<span class="n">norm_wav</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s2">&quot;theta&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sample_wav</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s2">&quot;theta&quot;</span><span class="p">]</span>

<span class="n">norm_wav</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;orso&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">reduction</span><span class="o">.</span><span class="n">corrections</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;normalisation by direct beam&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</section>
<section id="Conversion-to-Q">
<h2>Conversion to <span class="math notranslate nohighlight">\(Q\)</span><a class="headerlink" href="#Conversion-to-Q" title="Permalink to this headline">#</a></h2>
<p>This normalised data can then be used to compute the reflectivity as a function of the scattering vector <span class="math notranslate nohighlight">\(Q\)</span>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">norm_q</span> <span class="o">=</span> <span class="n">reflectometry</span><span class="o">.</span><span class="n">conversions</span><span class="o">.</span><span class="n">theta_to_q</span><span class="p">(</span><span class="n">norm_wav</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="n">graph</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Which we can visualise.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">norm_q</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../../_images/instruments_external_offspec_offspec_reduction_40_0.svg" src="../../../_images/instruments_external_offspec_offspec_reduction_40_0.svg" /></div>
</div>
</section>
<section id="Saving-the-scipp-reduced-data-as-.ort">
<h2>Saving the scipp-reduced data as .ort<a class="headerlink" href="#Saving-the-scipp-reduced-data-as-.ort" title="Permalink to this headline">#</a></h2>
<p>We constructed the ORSO header through the reduction process. We can now make use of this when we save our .ort file.</p>
<p>First, we will assume a 3 % of <span class="math notranslate nohighlight">\(Q\)</span> resolution function to be included in our file.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">norm_q</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;sigma_Q&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">midpoints</span><span class="p">(</span><span class="n">norm_q</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mf">0.03</span>
</pre></div>
</div>
</div>
<p>Then, due a <a class="reference external" href="https://github.com/reflectivity/orsopy/pull/101">bug in orsopy</a>, we need to overwrite the incident angle and wavelength that have been out-populated by the reduction.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">incident_angle</span> <span class="o">=</span> <span class="n">norm_q</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;orso&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">data_source</span><span class="o">.</span><span class="n">measurement</span><span class="o">.</span><span class="n">instrument_settings</span><span class="o">.</span><span class="n">incident_angle</span>
<span class="n">wavelength</span> <span class="o">=</span> <span class="n">norm_q</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;orso&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">data_source</span><span class="o">.</span><span class="n">measurement</span><span class="o">.</span><span class="n">instrument_settings</span><span class="o">.</span><span class="n">wavelength</span>

<span class="n">norm_q</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;orso&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">data_source</span><span class="o">.</span><span class="n">measurement</span><span class="o">.</span><span class="n">instrument_settings</span><span class="o">.</span><span class="n">wavelength</span> <span class="o">=</span> <span class="n">fileio</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">ValueRange</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">wavelength</span><span class="o">.</span><span class="n">min</span><span class="p">),</span> <span class="nb">max</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">wavelength</span><span class="o">.</span><span class="n">max</span><span class="p">),</span> <span class="n">unit</span><span class="o">=</span><span class="n">wavelength</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
<span class="n">norm_q</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;orso&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">data_source</span><span class="o">.</span><span class="n">measurement</span><span class="o">.</span><span class="n">instrument_settings</span><span class="o">.</span><span class="n">incident_angle</span> <span class="o">=</span> <span class="n">fileio</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">Value</span><span class="p">(</span><span class="n">magnitude</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">incident_angle</span><span class="o">.</span><span class="n">magnitude</span><span class="p">),</span> <span class="n">unit</span><span class="o">=</span><span class="n">incident_angle</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>And it is necessary to add the column for our uncertainties, which details the <strong>meaning</strong> of the uncertainty values we have given.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">norm_q</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;orso&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fileio</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">ErrorColumn</span><span class="p">(</span><span class="n">error_of</span><span class="o">=</span><span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="n">error_type</span><span class="o">=</span><span class="s1">&#39;uncertainty&#39;</span><span class="p">,</span> <span class="n">value_is</span><span class="o">=</span><span class="s1">&#39;sigma&#39;</span><span class="p">))</span>
<span class="n">norm_q</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;orso&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fileio</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">ErrorColumn</span><span class="p">(</span><span class="n">error_of</span><span class="o">=</span><span class="s1">&#39;Q&#39;</span><span class="p">,</span> <span class="n">error_type</span><span class="o">=</span><span class="s1">&#39;resolution&#39;</span><span class="p">,</span> <span class="n">value_is</span><span class="o">=</span><span class="s1">&#39;sigma&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>Finally, we can save the file.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reflectometry</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">save_ort</span><span class="p">(</span><span class="n">norm_q</span><span class="p">,</span> <span class="s1">&#39;offspec.ort&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>head<span class="w"> </span>offspec.ort
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
# # ORSO reflectivity data file | 1.0 standard | YAML encoding | https://www.reflectometry.org/
# data_source:
#   owner:
#     name: Joshanial F. K. Cooper
#     affiliation: ISIS Neutron and Muon Source
#   experiment:
#     title: OFFSPEC Sample Data
#     instrument: OFFSPEC
#     start_date: 2020-12-14T10:34:02
#     probe: neutron
</pre></div></div>
</div>
<script type="application/vnd.jupyter.widget-state+json">
{"state": {"3856a9331e86412a889e8ba3d067d7e7": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "4fd47b7b2d3e4b24bad5365ceb8db3ea": {"model_name": "HTMLStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HTMLStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "StyleView", "background": null, "description_width": "", "font_size": null, "text_color": null}}, "f82b922760c74711b56b3571db13b51c": {"model_name": "HTMLModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HTMLModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "2.0.0", "_view_name": "HTMLView", "description": "", "description_allow_html": false, "layout": "IPY_MODEL_3856a9331e86412a889e8ba3d067d7e7", "placeholder": "\u200b", "style": "IPY_MODEL_4fd47b7b2d3e4b24bad5365ceb8db3ea", "tabbable": null, "tooltip": null, "value": "<div class=\"sc-log\"><table class=\"sc-log\"><tr class=\"sc-log sc-log-info\"><td class=\"sc-log-time-stamp\">[2024-04-03T11:17:07]</td><td class=\"sc-log-level\">INFO</td><td class=\"sc-log-message\">Software Versions:\n  ess: 24.1.1.dev5+g8409fb3 (https://scipp.github.io/ess)\n  scippneutron: 23.9.0 (https://scipp.github.io/scippneutron)\n  scipp: 23.08.0 (https://scipp.github.io)</td><td class=\"sc-log-name\">&lt;scipp.ess&gt;</td></tr><tr class=\"sc-log sc-log-info\"><td class=\"sc-log-time-stamp\">[2024-04-03T11:17:07]</td><td class=\"sc-log-level\">INFO</td><td class=\"sc-log-message\">Downloading file &#x27;sample.h5&#x27; from &#x27;https://public.esss.dk/groups/scipp/ess/offspec/1/sample.h5&#x27; to &#x27;/home/runner/.cache/ess/offspec/1&#x27;.</td><td class=\"sc-log-name\">&lt;pooch&gt;</td></tr><tr class=\"sc-log sc-log-info\"><td class=\"sc-log-time-stamp\">[2024-04-03T11:17:11]</td><td class=\"sc-log-level\">INFO</td><td class=\"sc-log-message\">Downloading file &#x27;direct_beam.h5&#x27; from &#x27;https://public.esss.dk/groups/scipp/ess/offspec/1/direct_beam.h5&#x27; to &#x27;/home/runner/.cache/ess/offspec/1&#x27;.</td><td class=\"sc-log-name\">&lt;pooch&gt;</td></tr><tr class=\"sc-log sc-log-info\"><td class=\"sc-log-time-stamp\">[2024-04-03T11:17:21]</td><td class=\"sc-log-level\">INFO</td><td class=\"sc-log-message\">Correcting pixel positions in &#x27;sample.nxs&#x27;</td><td class=\"sc-log-name\">&lt;scipp.ess.offspec_reduction&gt;</td></tr><tr class=\"sc-log sc-log-info\"><td class=\"sc-log-time-stamp\">[2024-04-03T11:17:22]</td><td class=\"sc-log-level\">INFO</td><td class=\"sc-log-message\">Transformed coords (position, sample_position, source_position, tof) -&gt; (wavelength)\n  Byproducts:\n    L1, L2, Ltotal, incident_beam, scattered_beam\n  Renamed dimensions:\n    wavelength &lt;- tof\n  Steps:\n    Compute (scattered_beam) = straight_scattered_beam(position, sample_position)\n    Compute (incident_beam) = straight_incident_beam(source_position, sample_position)\n    Compute (L2) = L2(scattered_beam)\n    Compute (L1) = L1(incident_beam)\n    Compute (Ltotal) = total_beam_length(L1, L2)\n    Compute (wavelength) = wavelength_from_tof(tof, Ltotal)</td><td class=\"sc-log-name\">&lt;scipp&gt;</td></tr><tr class=\"sc-log sc-log-info\"><td class=\"sc-log-time-stamp\">[2024-04-03T11:17:22]</td><td class=\"sc-log-level\">INFO</td><td class=\"sc-log-message\">Transformed coords (position, source_position, tof) -&gt; (wavelength)\n  Byproducts:\n    Ltotal\n  Renamed dimensions:\n    wavelength &lt;- tof\n  Steps:\n    Compute (Ltotal) = total_straight_beam_length_no_scatter(source_position, position)\n    Compute (wavelength) = wavelength_from_tof(tof, Ltotal)</td><td class=\"sc-log-name\">&lt;scipp&gt;</td></tr><tr class=\"sc-log sc-log-info\"><td class=\"sc-log-time-stamp\">[2024-04-03T11:17:22]</td><td class=\"sc-log-level\">INFO</td><td class=\"sc-log-message\">Transformed coords (position, source_position, tof) -&gt; (wavelength)\n  Byproducts:\n    Ltotal\n  Renamed dimensions:\n    wavelength &lt;- tof\n  Steps:\n    Compute (Ltotal) = total_straight_beam_length_no_scatter(source_position, position)\n    Compute (wavelength) = wavelength_from_tof(tof, Ltotal)</td><td class=\"sc-log-name\">&lt;scipp&gt;</td></tr><tr class=\"sc-log sc-log-info\"><td class=\"sc-log-time-stamp\">[2024-04-03T11:17:22]</td><td class=\"sc-log-level\">INFO</td><td class=\"sc-log-message\">Transformed coords (position, source_position, tof) -&gt; (wavelength)\n  Byproducts:\n    Ltotal\n  Renamed dimensions:\n    wavelength &lt;- tof\n  Steps:\n    Compute (Ltotal) = total_straight_beam_length_no_scatter(source_position, position)\n    Compute (wavelength) = wavelength_from_tof(tof, Ltotal)</td><td class=\"sc-log-name\">&lt;scipp&gt;</td></tr><tr class=\"sc-log sc-log-info\"><td class=\"sc-log-time-stamp\">[2024-04-03T11:17:22]</td><td class=\"sc-log-level\">INFO</td><td class=\"sc-log-message\">Transformed coords (theta, wavelength) -&gt; (Q)\n  Renamed dimensions:\n    Q &lt;- wavelength\n  Steps:\n    Compute (Q) = reflectometry_q(wavelength, theta)</td><td class=\"sc-log-name\">&lt;scipp&gt;</td></tr></table></div>"}}, "b7085a192c4f49a1987b5ef90ad72332": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "a31b1be48ffd4e20a758129fee542b78": {"model_name": "HTMLStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HTMLStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "StyleView", "background": null, "description_width": "", "font_size": null, "text_color": null}}, "08e517066abb48d387e1900e48aa135a": {"model_name": "HTMLModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HTMLModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "2.0.0", "_view_name": "HTMLView", "description": "", "description_allow_html": false, "layout": "IPY_MODEL_b7085a192c4f49a1987b5ef90ad72332", "placeholder": "\u200b", "style": "IPY_MODEL_a31b1be48ffd4e20a758129fee542b78", "tabbable": null, "tooltip": null, "value": "<style id=\"scipp-style-sheet\">.sc-root{--sc-background-color0:var(--jp-layout-color0,#fff);--sc-background-color1:var(--jp-layout-color1,#fcfcfc);--sc-background-color2:var(--jp-layout-color2,#efefef);--sc-inverse-background-color0:var(--jp-inverse-layout-color4,#111);--sc-font-color0:var(--jp-content-font-color0,#000);--sc-font-color1:var(--jp-content-font-color1,#555);--sc-font-color2:var(--jp-content-font-color2,#888);--sc-font-color3:var(--jp-content-font-color3,#ccc);--sc-table-data-color:#f6d028;--sc-table-coords-color:#c6e590;--sc-table-masks-color:#c8c8c8;--sc-table-attrs-color:#ff5555;--sc-table-header-font-color:#111111;}.sc-wrap{font-size:14px;min-width:300px;max-width:800px;}.sc-var-attrs .sc-wrap{padding-left:3em;}.sc-header{padding-top:6px;padding-bottom:6px;margin-bottom:4px;border-bottom:solid 1px #ddd;}.sc-header > div,.sc-header > ul{display:inline;margin-top:0;margin-bottom:0;}.sc-obj-type,.sc-array-name{margin-left:2px;margin-right:10px;}.sc-obj-type{color:var(--sc-font-color1);}.sc-underlying-size{color:var(--sc-font-color2);}.sc-sections,.reveal .sc-sections{padding-left:0 !important;display:grid;grid-template-columns:150px auto auto auto 1fr 20px 20px;}.sc-section-item{display:contents;}.sc-section-item input{display:none;}.sc-section-item input:enabled + label{cursor:pointer;color:var(--sc-font-color1);}.sc-section-item input:enabled + label:hover{color:var(--sc-font-color0);}.sc-section-summary{grid-column:1;font-weight:500;}.sc-section-summary > span{display:inline-block;padding-left:0.5em;}.sc-section-summary-in:disabled + label{color:var(--sc-font-color1);}.sc-section-summary-in + label:before{display:inline-block;content:'\u25ba';font-size:11px;width:15px;text-align:center;}.sc-section-summary-in:disabled + label:before{color:var(--sc-font-color3);}.sc-section-summary-in:checked + label:before{content:'\u25bc';}.sc-section-summary-in:checked + label > span{display:none;}.sc-section-summary,.sc-section-inline-details{padding-top:4px;padding-bottom:4px;}.sc-section-inline-details{grid-column:2 / 6;}.sc-section-details{display:none;grid-column:1 / -1;margin-bottom:5px;}.sc-section-summary-in:checked ~ .sc-section-details{display:contents;}.sc-array-wrap{grid-column:1 / -1;display:grid;grid-template-columns:20px auto;}.sc-array-wrap > label{grid-column:1;vertical-align:top;}.sc-preview{color:var(--sc-font-color2);}.sc-array-preview,.sc-array-data{padding:0 5px !important;grid-column:2;}.sc-array-data,.sc-array-in:checked ~ .sc-array-preview{display:none;}.sc-array-in:checked ~ .sc-array-data,.sc-array-preview{display:inline-block;}.sc-dim-list{display:inline-block !important;list-style:none;padding:0 !important;margin:0;}.sc-dim-list li{display:inline-block;padding:0;margin:0!important;}.sc-dim-list:before{content:'(';}.sc-dim-list:after{content:')';}.sc-dim-list li:not(:last-child):after{content:',';padding-right:5px;}.sc-dim-list li span,.sc-standalone-var-name > span span,.sc-var-name > span span{padding:0 !important;}.sc-aligned{font-weight:bold;}.sc-var-list,.sc-var-item,.reveal .sc-var-list,.reveal .sc-var-item{display:contents;}.sc-var-item > div,.sc-var-item label,.sc-var-item > .sc-var-name span{background-color:var(--sc-background-color1);margin-bottom:0;}.sc-var-item > .sc-var-name:hover span{padding-right:5px;}.sc-var-list > li:nth-child(odd) > div,.sc-var-list > li:nth-child(odd) > label,.sc-var-list > li:nth-child(odd) > .sc-var-name span{background-color:var(--sc-background-color2);}.sc-var-name{grid-column:1;}.sc-var-dims{grid-column:2;}.sc-var-dtype{grid-column:3;text-align:right;color:var(--sc-font-color2);}.sc-var-unit{grid-column:4;text-align:left;color:var(--sc-font-color1);max-width:50pt;text-overflow:ellipsis;}.sc-value-preview{grid-column:5;}.sc-var-preview-variances{text-align:right;}.sc-sections .sc-section-item .sc-section-summary,.sc-sections .sc-section-item .sc-section-inline-details,.sc-section-item .sc-var-list .sc-var-item > div,.sc-section-item .sc-var-list .sc-var-item > label,.sc-section-details .sc-var-list .sc-var-item > div,.sc-section-details .sc-var-list .sc-var-item > label{margin-top:0;margin-bottom:0;}.sc-var-name,.sc-var-dims,.sc-var-dtype,.sc-var-unit,.sc-preview,.sc-attrs dt{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;padding-right:10px;}.sc-var-name:hover,.sc-var-dims:hover,.sc-var-dtype:hover,.sc-var-unit:hover,.sc-attrs dt:hover{overflow:visible;width:auto;z-index:1;}.sc-var-attrs{display:block;}.sc-var-data,.reveal .sc-var-data{display:none;}.sc-var-attrs,.sc-var-data{background-color:var(--sc-background-color0) !important;padding-bottom:5px !important;}.sc-var-attrs-in:checked ~ .sc-var-attrs{display:none;}.sc-var-data-in:checked ~ .sc-var-data{display:block;}.sc-var-data > table{float:right;}.sc-var-name span,.sc-var-data{padding-left:25px !important;}.sc-var-attrs,.sc-var-data{grid-column:1 / -1;}dl.sc-attrs{padding:0;margin:0;display:grid;grid-template-columns:125px auto;}.sc-attrs dt,dd{padding:0;margin:0;float:left;padding-right:10px;width:auto;}.sc-attrs dt{font-weight:normal;grid-column:1;}.sc-attrs dt:hover span{display:inline-block;padding-right:10px;}.sc-attrs dd{grid-column:2;white-space:pre-wrap;word-break:break-all;}.sc-icon-database,.sc-icon-file-text2{display:inline-block;vertical-align:middle;width:1em;height:1.5em !important;stroke-width:0;stroke:currentColor;fill:currentColor;}label.sc-hide-icon svg{opacity:0;}.sc-standalone-var-name{grid-column:1/3;}.sc-standalone-var-name span{padding-left:25px;padding-right:10px;}.sc-table{border-collapse:collapse;}.sc-title{font-weight:bold;font-size:1.5em;}.sc-subtitle{font-weight:normal;font-style:italic;text-align:left;font-size:1.2em;padding:1px;}.sc-table th,.sc-table td{border:1px solid var(--sc-inverse-background-color0);padding:0 5px 0 5px;}.sc-table th{text-align:center;}.sc-table tr{background-color:var(--sc-background-color1);text-align:right;}.sc-table tr:hover{background-color:var(--sc-background-color2);}.sc-table th.sc-data{background-color:var(--sc-table-data-color);color:var(--sc-table-header-font-color);}.sc-table th.sc-coords{background-color:var(--sc-table-coords-color);color:var(--sc-table-header-font-color);}.sc-table th.sc-masks{background-color:var(--sc-table-masks-color);color:var(--sc-table-header-font-color);}.sc-table th.sc-attrs{background-color:var(--sc-table-attrs-color);color:var(--sc-table-header-font-color);}.sc-table th.sc-subheader{background-color:var(--sc-background-color2);}.sc-table td.sc-padding{background-color:var(--sc-background-color1);border:0 solid var(--sc-background-color1);height:1.2em;}.sc-label{fill:var(--sc-font-color0,#444444);text-anchor:middle;}.sc-name{fill:var(--sc-font-color0,#111111);}.sc-inset-line{stroke:var(--sc-font-color1);stroke-width:0.05;stroke-dasharray:0.2,0.2;}.sc-log-wrap{height:25ex;resize:vertical;overflow-y:scroll;display:flex;flex-direction:column-reverse;border:1px solid;border-color:var(--jp-border-color2);background-color:var(--sc-background-color1);}div.sc-log{line-height:2.5ex;}table.sc-log{table-layout:auto;border-collapse:collapse;}tr.sc-log:nth-child(even){background-color:var(--sc-background-color0);}tr.sc-log > td{vertical-align:top;padding-bottom:0.5ex;}.sc-log-time-stamp{min-width:22ch;font-family:var(--jp-code-font-family);color:var(--sc-font-color2);}.sc-log-level{min-width:10ch;}tr.sc-log-debug td.sc-log-level{color:var(--jp-accent-color1);}tr.sc-log-info td.sc-log-level{color:var(--jp-info-color1);}tr.sc-log-warning td.sc-log-level{color:var(--jp-warn-color1);}tr.sc-log-error td.sc-log-level{font-weight:bold;color:var(--jp-error-color2);}tr.sc-log-critical td.sc-log-level{font-weight:bold;color:var(--sc-background-color0);background-color:var(--jp-error-color1);}.sc-log-message{white-space:pre-wrap;width:100%;}.sc-log-html-payload{white-space:normal;}.sc-log-name{padding-right:0.5em;text-align:right;white-space:pre-wrap;color:var(--sc-font-color3);}</style>"}}, "5eec963dfaff4d81bc4d2527d60d9a28": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "df6c71eaa30e469aa24490fced587a8c": {"model_name": "VBoxModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_dom_classes": ["sc-log-wrap"], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "VBoxModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "2.0.0", "_view_name": "VBoxView", "box_style": "", "children": ["IPY_MODEL_08e517066abb48d387e1900e48aa135a", "IPY_MODEL_f82b922760c74711b56b3571db13b51c"], "layout": "IPY_MODEL_5eec963dfaff4d81bc4d2527d60d9a28", "tabbable": null, "tooltip": null}}}, "version_major": 2, "version_minor": 0}
</script></section>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="../external.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">External Instruments</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../powgen/powgen.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">POWGEN</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Scipp contributors<br/>
  
      &copy; Copyright 2023 Scipp contributors.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>