
<!DOCTYPE html>


<html lang="en" data-content_root="../../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ess.imaging.tools.resolution &#8212; ESSimaging</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/autodoc_pydantic.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../../../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../../../_static/documentation_options.js?v=d3717ebb"></script>
    <script src="../../../../_static/doctools.js?v=fd6eb6e6"></script>
    <script src="../../../../_static/sphinx_highlight.js?v=6ffebe34"></script>
    <script src="../../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../../_static/design-tabs.js?v=f930bc37"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/ess/imaging/tools/resolution';</script>
    <script src="../../../../_static/anaconda-icon.js?v=461bdc62"></script>
    <link rel="icon" href="../../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="0.1.dev1610+gc2e452b13" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../../_static/logo.svg" class="logo__image only-light" alt="ESSimaging - Home"/>
    <img src="../../../../_static/logo-dark.svg" class="logo__image only-dark pst-js-only" alt="ESSimaging - Home"/>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../odin/index.html">
    Odin
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../tbl/index.html">
    Test beamline
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../ymir/index.html">
    Ymir
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../tools/index.html">
    Tools
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../api-reference/index.html">
    API Reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../developer/index.html">
    Development
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../about/index.html">
    About
  </a>
</li>

            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button"
                data-bs-toggle="dropdown" aria-expanded="false"
                aria-controls="pst-nav-more-links">
                    More
                </button>
                <ul id="pst-nav-more-links" class="dropdown-menu">
                    
<li class=" ">
  <a class="nav-link dropdown-item nav-external" href="https://scipp.github.io/essreduce">
    Essreduce
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-external" href="https://scipp.github.io/plopp">
    Plopp
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-external" href="https://scipp.github.io/sciline">
    Sciline
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-external" href="https://scipp.github.io">
    Scipp
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-external" href="https://scipp.github.io/scippneutron">
    ScippNeutron
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-external" href="https://scipp.github.io/scippnexus">
    ScippNexus
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-external" href="https://scipp.github.io/scitiff">
    Scitiff
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-external" href="https://scipp.github.io/tof">
    Tof
  </a>
</li>

                </ul>
            </li>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/scipp/essimaging" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/essimaging/" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-python fa-lg" aria-hidden="true"></i>
            <span class="sr-only">PyPI</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://anaconda.org/conda-forge/essimaging" title="Conda" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-custom fa-anaconda fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Conda</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/scipp" title="Scipp" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><img src="../../../../_static/favicon.ico" class="icon-link-image" alt="Scipp"/></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
    </div>
  

  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../odin/index.html">
    Odin
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../tbl/index.html">
    Test beamline
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../ymir/index.html">
    Ymir
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../tools/index.html">
    Tools
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../api-reference/index.html">
    API Reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../developer/index.html">
    Development
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../about/index.html">
    About
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://scipp.github.io/essreduce">
    Essreduce
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://scipp.github.io/plopp">
    Plopp
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://scipp.github.io/sciline">
    Sciline
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://scipp.github.io">
    Scipp
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://scipp.github.io/scippneutron">
    ScippNeutron
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://scipp.github.io/scippnexus">
    ScippNexus
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://scipp.github.io/scitiff">
    Scitiff
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://scipp.github.io/tof">
    Tof
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/scipp/essimaging" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/essimaging/" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-python fa-lg" aria-hidden="true"></i>
            <span class="sr-only">PyPI</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://anaconda.org/conda-forge/essimaging" title="Conda" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-custom fa-anaconda fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Conda</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/scipp" title="Scipp" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><img src="../../../../_static/favicon.ico" class="icon-link-image" alt="Scipp"/></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../../../index.html" class="nav-link">Module code</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">ess.imaging.tools.resolution</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <h1>Source code for ess.imaging.tools.resolution</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">scipp</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sc</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">numpy.typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">NDArray</span>


<div class="viewcode-block" id="maximum_resolution_achievable">
<a class="viewcode-back" href="../../../../generated/modules/ess.imaging.tools.resolution.maximum_resolution_achievable.html#ess.imaging.tools.resolution.maximum_resolution_achievable">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">maximum_resolution_achievable</span><span class="p">(</span>
    <span class="n">events</span><span class="p">:</span> <span class="n">sc</span><span class="o">.</span><span class="n">DataArray</span><span class="p">,</span>
    <span class="n">coarse_x_bin_edges</span><span class="p">:</span> <span class="n">sc</span><span class="o">.</span><span class="n">Variable</span><span class="p">,</span>
    <span class="n">coarse_y_bin_edges</span><span class="p">:</span> <span class="n">sc</span><span class="o">.</span><span class="n">Variable</span><span class="p">,</span>
    <span class="n">time_bin_edges</span><span class="p">:</span> <span class="n">sc</span><span class="o">.</span><span class="n">Variable</span><span class="p">,</span>
    <span class="n">max_tries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">max_pixels_x</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2048</span><span class="p">,</span>
    <span class="n">max_pixels_y</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2048</span><span class="p">,</span>
    <span class="n">raise_if_not_maximum</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Estimates the maximum resolution achievable</span>
<span class="sd">    given a desired binning in time.</span>
<span class="sd">    The maximum achievable resolution is defined</span>
<span class="sd">    as the resolution in ``xy`` such that</span>
<span class="sd">    there is at least one event in every ``xyt`` pixel.</span>

<span class="sd">    Parameters</span>
<span class="sd">    -------------</span>
<span class="sd">    events:</span>
<span class="sd">        1D DataArray containing events with associated x, y, and t coordinates.</span>
<span class="sd">        The names of the coordinates must not be `x`, `y` and `t`,</span>
<span class="sd">        the names of the coordinates are taken from the provided ``bin_edges``</span>
<span class="sd">        for each respective dimension.</span>
<span class="sd">    coarse_x_bin_edges:</span>
<span class="sd">        Minimum acceptable resolution in ``x``.</span>
<span class="sd">    coarse_y_bin_edges:</span>
<span class="sd">        Minimum acceptable resolution in ``y``.</span>
<span class="sd">    time_bin_edges:</span>
<span class="sd">        Desired resolution in ``t``.</span>
<span class="sd">    max_tries:</span>
<span class="sd">        The maximum number of iterations before giving up.</span>
<span class="sd">    max_pixels_x:</span>
<span class="sd">        The maximum number of pixels in ``x``.</span>
<span class="sd">    max_pixels_y:</span>
<span class="sd">        The maximum number of pixels in ``y``.</span>
<span class="sd">    raise_if_not_maximum:</span>
<span class="sd">        Often it is not important to find the exact maximum resolution.</span>
<span class="sd">        Therefore this parameter is ``False`` by default, and the function</span>
<span class="sd">        returns an estimate of the maximum resolution.</span>
<span class="sd">        If you want the returned resolution to be exactly the maximum resolution,</span>
<span class="sd">        set the value of this parameter to ``True``.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------------</span>
<span class="sd">        The bin edges in x respectively y that define the</span>
<span class="sd">        maximum achievable resolution.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">lower_nx</span> <span class="o">=</span> <span class="n">coarse_x_bin_edges</span><span class="o">.</span><span class="n">size</span>
    <span class="n">lower_ny</span> <span class="o">=</span> <span class="n">coarse_y_bin_edges</span><span class="o">.</span><span class="n">size</span>
    <span class="n">upper_nx</span> <span class="o">=</span> <span class="n">max_pixels_x</span>
    <span class="n">upper_ny</span> <span class="o">=</span> <span class="n">max_pixels_y</span>

    <span class="n">nx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">lower_nx</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">ny</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">lower_ny</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">events</span> <span class="o">=</span> <span class="n">events</span><span class="o">.</span><span class="n">bin</span><span class="p">({</span><span class="n">time_bin_edges</span><span class="o">.</span><span class="n">dim</span><span class="p">:</span> <span class="n">time_bin_edges</span><span class="p">})</span>

    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_tries</span><span class="p">):</span>
        <span class="n">xbins</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
            <span class="n">coarse_x_bin_edges</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span> <span class="n">coarse_x_bin_edges</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coarse_x_bin_edges</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">nx</span>
        <span class="p">)</span>
        <span class="n">ybins</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
            <span class="n">coarse_y_bin_edges</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span> <span class="n">coarse_y_bin_edges</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coarse_y_bin_edges</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">ny</span>
        <span class="p">)</span>
        <span class="n">min_counts_per_pixel</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">events</span><span class="o">.</span><span class="n">bin</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="n">coarse_x_bin_edges</span><span class="o">.</span><span class="n">dim</span><span class="p">:</span> <span class="n">xbins</span><span class="p">,</span>
                    <span class="n">coarse_y_bin_edges</span><span class="o">.</span><span class="n">dim</span><span class="p">:</span> <span class="n">ybins</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">bins</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
            <span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">min_counts_per_pixel</span><span class="o">.</span><span class="n">value</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">lower_nx</span> <span class="o">=</span> <span class="n">nx</span>
            <span class="n">lower_ny</span> <span class="o">=</span> <span class="n">ny</span>
            <span class="n">nx</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="nb">round</span><span class="p">((</span><span class="n">upper_nx</span> <span class="o">*</span> <span class="n">nx</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">nx</span> <span class="o">*</span> <span class="mi">2</span><span class="p">),</span> <span class="n">lower_nx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">ny</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="nb">round</span><span class="p">((</span><span class="n">upper_ny</span> <span class="o">*</span> <span class="n">ny</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">ny</span> <span class="o">*</span> <span class="mi">2</span><span class="p">),</span> <span class="n">lower_ny</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">upper_nx</span> <span class="o">=</span> <span class="n">nx</span>
            <span class="n">upper_ny</span> <span class="o">=</span> <span class="n">ny</span>
            <span class="n">nx</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">round</span><span class="p">((</span><span class="n">lower_nx</span> <span class="o">*</span> <span class="n">nx</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">upper_nx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">ny</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">round</span><span class="p">((</span><span class="n">lower_ny</span> <span class="o">*</span> <span class="n">ny</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">upper_nx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">upper_nx</span> <span class="o">-</span> <span class="n">lower_nx</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">upper_ny</span> <span class="o">-</span> <span class="n">lower_ny</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">break</span>

    <span class="k">if</span> <span class="n">raise_if_not_maximum</span> <span class="ow">and</span> <span class="n">upper_nx</span> <span class="o">-</span> <span class="n">lower_nx</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">upper_ny</span> <span class="o">-</span> <span class="n">lower_ny</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="s1">&#39;Maximal resolution was not found. Increase `max_tries` to search longer. &#39;</span>
            <span class="s1">&#39;Or set `raise_if_not_maximum=False` if it is not necessary to locate the &#39;</span>
            <span class="s1">&#39;maximum exactly.&#39;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span>
        <span class="n">sc</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
            <span class="n">coarse_x_bin_edges</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span>
            <span class="n">coarse_x_bin_edges</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">coarse_x_bin_edges</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">lower_nx</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">sc</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
            <span class="n">coarse_y_bin_edges</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span>
            <span class="n">coarse_y_bin_edges</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">coarse_y_bin_edges</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">lower_ny</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span></div>



<span class="k">def</span><span class="w"> </span><span class="nf">_radial_profile</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Integrate ellipses around center of image.&#39;&#39;&#39;</span>
    <span class="n">y</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">indices</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">cy</span><span class="p">,</span> <span class="n">cx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hypot</span><span class="p">((</span><span class="n">cx</span> <span class="o">*</span> <span class="n">cy</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">cx</span><span class="p">)</span> <span class="o">/</span> <span class="n">cx</span><span class="p">,</span> <span class="p">(</span><span class="n">cx</span> <span class="o">*</span> <span class="n">cy</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">cy</span><span class="p">)</span> <span class="o">/</span> <span class="n">cy</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
    <span class="n">tbin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">data</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
    <span class="n">nr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">tbin</span> <span class="o">/</span> <span class="p">(</span><span class="n">nr</span> <span class="o">+</span> <span class="mf">1e-15</span><span class="p">)</span>


<div class="viewcode-block" id="modulation_transfer_function">
<a class="viewcode-back" href="../../../../generated/modules/ess.imaging.tools.resolution.modulation_transfer_function.html#ess.imaging.tools.resolution.modulation_transfer_function">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">modulation_transfer_function</span><span class="p">(</span>
    <span class="n">measured_image</span><span class="p">:</span> <span class="n">sc</span><span class="o">.</span><span class="n">DataArray</span><span class="p">,</span>
    <span class="n">open_beam_image</span><span class="p">:</span> <span class="n">sc</span><span class="o">.</span><span class="n">DataArray</span><span class="p">,</span>
    <span class="n">target</span><span class="p">:</span> <span class="n">sc</span><span class="o">.</span><span class="n">DataArray</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">sc</span><span class="o">.</span><span class="n">DataArray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Computes the modulation transfer function (MTF) of</span>
<span class="sd">    the camera given a measured image and the</span>
<span class="sd">    ideal image that would have been captured if</span>
<span class="sd">    the instrument had infinite resolution.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ------------</span>
<span class="sd">    measured_image:</span>
<span class="sd">        The image of the sample captured by the camera.</span>
<span class="sd">    open_beam_image:</span>
<span class="sd">        The image without the sample captured by the camera.</span>
<span class="sd">    target:</span>
<span class="sd">        A perfect image of the sample</span>
<span class="sd">        on the same grid as `measured_image`.</span>

<span class="sd">    Returns</span>
<span class="sd">    ------------</span>
<span class="sd">    :</span>
<span class="sd">        The modulation transfer function as a function</span>
<span class="sd">        of &quot;frequency&quot; representing &quot;line pairs&quot; per pixel.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----------</span>

<span class="sd">    Computing modulation transfer function (MTF)</span>
<span class="sd">    ============================================</span>

<span class="sd">    The definition of the MTF is</span>

<span class="sd">    .. math::</span>

<span class="sd">        \\mathrm{MTF}(f) = |\\mathcal{F}(P)|</span>

<span class="sd">    where :math:`\\mathcal{F}(P)` is the Fourier transform of the point spread function :math:`P`.</span>

<span class="sd">    The Fourier transform of the point spread function is really a function of two variables, but it is assumed that the MTF does not vary depending on the direction of change, so here it&#39;s denoted as a function of the frequency independent of direction:</span>

<span class="sd">    .. math::</span>

<span class="sd">        \\mathrm{MTF}(\\|(f_x, f_y)\\|) = |\\mathcal{F}(P)|(f_x, f_y)</span>

<span class="sd">    Model for images in detector</span>
<span class="sd">    ----------------------------</span>

<span class="sd">    The intensity distribution in the detector (the &quot;image&quot;) :math:`I` is modeled as</span>

<span class="sd">    .. math::</span>

<span class="sd">        I = I_0 S \\star P</span>

<span class="sd">    where :math:`I_0` is the intensity distribution at the sample, :math:`S` is the transmission function of the sample, and :math:`P` is the point-spread function.</span>

<span class="sd">    For the open beam we don&#39;t have any sample and the intensity distribution in the detector is modeled as</span>

<span class="sd">    .. math::</span>

<span class="sd">        I_{ob} = I_0 \\star P</span>

<span class="sd">    Approximation</span>
<span class="sd">    -------------</span>

<span class="sd">    Assuming :math:`I_0` is more or less uniform, and :math:`P` is relatively localized, we can approximate</span>

<span class="sd">    .. math::</span>

<span class="sd">        I_0 \\star P \\approx I_0</span>

<span class="sd">    Making this assumption we can substitute :math:`I_0` for :math:`I_{ob}` in the model for the image:</span>

<span class="sd">    .. math::</span>

<span class="sd">        I = I_{ob} S \\star P</span>

<span class="sd">    Applying the Fourier transform on both sides we have</span>

<span class="sd">    .. math::</span>

<span class="sd">        \\mathcal{F}(I) = \\mathcal{F}(I_{ob} S)\\, \\mathcal{F}(P)</span>

<span class="sd">    which implies</span>

<span class="sd">    .. math::</span>

<span class="sd">        |\\mathcal{F}(P)| = \\left| \\frac{\\mathcal{F}(I)}{\\mathcal{F}(I_{ob} S)} \\right|</span>

<span class="sd">    and therefore</span>

<span class="sd">    .. math::</span>

<span class="sd">        \\mathrm{MTF}(\\|(f_x, f_y)\\|) =</span>
<span class="sd">        \\frac{|\\mathcal{F}(I)|(f_x, f_y)}{|\\mathcal{F}(I_{ob} S)|(f_x, f_y)}</span>

<span class="sd">    Finally, integrating over constant frequency magnitude:</span>

<span class="sd">    .. math::</span>

<span class="sd">        \\mathrm{MTF}(f) =</span>
<span class="sd">        \\frac{\\int_{\\|(f_x, f_y)\\| = f} |\\mathcal{F}(I)|(f_x, f_y)\\, df_x\\, df_y}</span>
<span class="sd">             {\\int_{\\|(f_x, f_y)\\| = f} |\\mathcal{F}(I_{ob} S)|(f_x, f_y)\\, df_x\\, df_y}</span>

<span class="sd">    Conclusion</span>
<span class="sd">    ----------</span>

<span class="sd">    The modulation transfer function at frequency :math:`f` can be estimated as the ratio of the Fourier transform of the image (integrated over constant frequency magnitude) to the Fourier transform of the open beam image multiplied by the sample mask (also integrated over constant frequency magnitude).</span>
<span class="sd">    &#39;&#39;&#39;</span>  <span class="c1"># noqa: E501</span>
    <span class="n">_measured</span> <span class="o">=</span> <span class="n">measured_image</span><span class="o">.</span><span class="n">values</span>
    <span class="c1"># Can&#39;t do inplace because dtype of sum might be different from dtype of input</span>
    <span class="n">_measured</span> <span class="o">=</span> <span class="n">_measured</span> <span class="o">/</span> <span class="n">_measured</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">_reference</span> <span class="o">=</span> <span class="p">(</span><span class="n">open_beam_image</span> <span class="o">*</span> <span class="n">target</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">measured_image</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
    <span class="n">_reference</span> <span class="o">=</span> <span class="n">_reference</span> <span class="o">/</span> <span class="n">_reference</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">f_ideal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft2</span><span class="p">(</span><span class="n">_reference</span><span class="p">)))</span>
    <span class="n">f_measured</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft2</span><span class="p">(</span><span class="n">_measured</span><span class="p">)))</span>
    <span class="n">_mtf</span> <span class="o">=</span> <span class="n">_radial_profile</span><span class="p">(</span><span class="n">f_measured</span><span class="p">)</span> <span class="o">/</span> <span class="n">_radial_profile</span><span class="p">(</span><span class="n">f_ideal</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span>
        <span class="n">sc</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;frequency&#39;</span><span class="p">],</span> <span class="n">values</span><span class="o">=</span><span class="n">_mtf</span><span class="p">),</span>
        <span class="c1"># Unit of frequency is line_pairs / pixel but since both of those are</span>
        <span class="c1"># a kind of counts I think in our unit system that is best</span>
        <span class="c1"># represented as &#39;dimensionless&#39;.</span>
        <span class="c1"># The largest frequency magnitude in 2d fft is sqrt(1/2).</span>
        <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;frequency&#39;</span><span class="p">:</span> <span class="n">sc</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="s1">&#39;frequency&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">_mtf</span><span class="p">))},</span>
        <span class="c1"># We&#39;re only interested in frequencies below 0.5 oscillations per pixel</span>
        <span class="c1"># because those above are unphysical.</span>
    <span class="p">)[</span><span class="s1">&#39;frequency&#39;</span><span class="p">,</span> <span class="p">:</span> <span class="n">sc</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)]</span></div>



<div class="viewcode-block" id="estimate_cut_off_frequency">
<a class="viewcode-back" href="../../../../generated/modules/ess.imaging.tools.resolution.estimate_cut_off_frequency.html#ess.imaging.tools.resolution.estimate_cut_off_frequency">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">estimate_cut_off_frequency</span><span class="p">(</span><span class="n">mtf</span><span class="p">:</span> <span class="n">sc</span><span class="o">.</span><span class="n">DataArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">sc</span><span class="o">.</span><span class="n">Variable</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Estimates the cut off frequency of</span>
<span class="sd">    the modulation transfer function (mtf).</span>

<span class="sd">    Parameters</span>
<span class="sd">    -------------</span>
<span class="sd">    mtf:</span>
<span class="sd">        A (potentially noisy) modulation transfer function curve</span>
<span class="sd">        having a coordinate named &quot;frequency&quot;.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------------</span>
<span class="sd">    :</span>
<span class="sd">        An estimate of the frequency where the modulation</span>
<span class="sd">        transfer function goes to zero, the &quot;cut off frequency&quot;.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">_freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concat</span><span class="p">([[</span><span class="mf">0.0</span><span class="p">],</span> <span class="n">mtf</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;frequency&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">])</span>
    <span class="n">_mtf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concat</span><span class="p">([[</span><span class="mf">1.0</span><span class="p">],</span> <span class="n">mtf</span><span class="o">.</span><span class="n">values</span><span class="p">])</span>
    <span class="c1"># The line should go through (0, 1), so give it a big weight.</span>
    <span class="c1"># 10 x total_weight was determined good enough by trial and error.</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concat</span><span class="p">([[</span><span class="mi">10</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">mtf</span><span class="p">)],</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mtf</span><span class="p">))])</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">_freq</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;bool&#39;</span><span class="p">)</span>
    <span class="n">fc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">maxiters</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">maxiters</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">_freq</span><span class="p">[</span><span class="n">m</span><span class="p">],</span> <span class="n">_mtf</span><span class="p">[</span><span class="n">m</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="n">w</span><span class="p">[</span><span class="n">m</span><span class="p">])</span>
        <span class="c1"># 1e-4 is used as a threshold because the method is not</span>
        <span class="c1"># accurate to less than 1e-4 anyway so we can just as well stop there.</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="o">-</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">fc</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-4</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="n">fc</span> <span class="o">=</span> <span class="o">-</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">_freq</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span>
    <span class="c1"># Correction factor 9/8 is the ratio between where a linear approximation</span>
    <span class="c1"># of the MTF of a circular apparture crosses 0 and where the actual cutoff frequency</span>
    <span class="c1"># of the same circular apparture is.</span>
    <span class="c1"># For reference:</span>
    <span class="c1"># import sympy as sp</span>
    <span class="c1"># x, f, a = sp.symbols(&#39;x, f, a&#39;, positive=True)</span>
    <span class="c1"># sp.solve(sp.integrate(sp.diff((1 - a * x - 2 / sp.pi * (sp.acos(x/f) - x/f * sp.sqrt(1 - x**2/f**2)))**2, a), (x, 0, f)), f)  # noqa: E501</span>
    <span class="k">return</span> <span class="mi">9</span> <span class="o">/</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span><span class="o">-</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="n">mtf</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;frequency&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span></div>



<div class="viewcode-block" id="mtf_less_than">
<a class="viewcode-back" href="../../../../generated/modules/ess.imaging.tools.resolution.mtf_less_than.html#ess.imaging.tools.resolution.mtf_less_than">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">mtf_less_than</span><span class="p">(</span><span class="n">mtf</span><span class="p">:</span> <span class="n">sc</span><span class="o">.</span><span class="n">DataArray</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="n">sc</span><span class="o">.</span><span class="n">Variable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">sc</span><span class="o">.</span><span class="n">Variable</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Computes the frequency where the</span>
<span class="sd">    modulation transfer function goes below ``limit``.</span>

<span class="sd">    Parameters</span>
<span class="sd">    --------------</span>
<span class="sd">    mtf:</span>
<span class="sd">        A (potentially noisy) modulation transfer function curve</span>
<span class="sd">        having a coordinate named &quot;frequency&quot;.</span>

<span class="sd">    limit:</span>
<span class="sd">        The modulation transfer function value at the returned frequency.</span>

<span class="sd">    Returns</span>
<span class="sd">    -----------</span>
<span class="sd">    :</span>
<span class="sd">        The frequency where the modulation transfer function goes below &quot;limit&quot;.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">mtf</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;frequency&#39;</span><span class="p">][</span><span class="n">mtf</span><span class="o">.</span><span class="n">data</span> <span class="o">&lt;=</span> <span class="n">limit</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span></div>

</pre></div>

                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
       Copyright 2025 Scipp contributors.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 9.0.4.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><!-- This will display the version of the docs -->
Current ESSimaging version: 0.1.dev1610+gc2e452b13 (<a href="https://github.com/scipp/essimaging/releases">older versions</a>).</div>
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>