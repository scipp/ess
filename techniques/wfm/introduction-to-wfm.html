
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Introduction to Wavelength Frame Multiplication &#8212; ess  documentation</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/nbsphinx-code-cells.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script src="../../_static/design-tabs.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Reducing WFM data" href="reducing-wfm-data.html" />
    <link rel="prev" title="Wavelength frame multiplication" href="wfm.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/logo.svg" class="logo" alt="logo">
      
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Getting started
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../getting-started/installation.html">
   Installation
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Instruments
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../instruments/amor/amor.html">
   Amor
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../instruments/amor/amor_reduction.html">
     Divergent data reduction for Amor
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../instruments/amor/reference.html">
     Reference
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
    <label for="toctree-checkbox-2">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../../generated/ess.amor.beamline.html">
       ess.amor.beamline
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
      <label for="toctree-checkbox-3">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../../generated/ess.amor.beamline.instrument_view_components.html">
         ess.amor.beamline.instrument_view_components
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../generated/ess.amor.beamline.make_beamline.html">
         ess.amor.beamline.make_beamline
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../../generated/ess.amor.calibrations.html">
       ess.amor.calibrations
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
      <label for="toctree-checkbox-4">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../../generated/ess.amor.calibrations.calibration_factor.html">
         ess.amor.calibrations.calibration_factor
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../generated/ess.amor.calibrations.supermirror_calibration.html">
         ess.amor.calibrations.supermirror_calibration
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../../generated/ess.amor.conversions.html">
       ess.amor.conversions
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
      <label for="toctree-checkbox-5">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../../generated/ess.amor.conversions.incident_beam.html">
         ess.amor.conversions.incident_beam
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../generated/ess.amor.conversions.specular_reflection.html">
         ess.amor.conversions.specular_reflection
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../../generated/ess.amor.normalize.html">
       ess.amor.normalize
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
      <label for="toctree-checkbox-6">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../../generated/ess.amor.normalize.normalize_by_supermirror.html">
         ess.amor.normalize.normalize_by_supermirror
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../../generated/ess.amor.orso.html">
       ess.amor.orso
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
      <label for="toctree-checkbox-7">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../../generated/ess.amor.orso.make_orso.html">
         ess.amor.orso.make_orso
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../../generated/ess.amor.resolution.html">
       ess.amor.resolution
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
      <label for="toctree-checkbox-8">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../../generated/ess.amor.resolution.angular_resolution.html">
         ess.amor.resolution.angular_resolution
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../generated/ess.amor.resolution.sample_size_resolution.html">
         ess.amor.resolution.sample_size_resolution
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../generated/ess.amor.resolution.sigma_Q.html">
         ess.amor.resolution.sigma_Q
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../generated/ess.amor.resolution.wavelength_resolution.html">
         ess.amor.resolution.wavelength_resolution
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../../generated/ess.amor.tools.html">
       ess.amor.tools
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
      <label for="toctree-checkbox-9">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../../generated/ess.amor.tools.fwhm_to_std.html">
         ess.amor.tools.fwhm_to_std
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../generated/ess.amor.tools.linlogspace.html">
         ess.amor.tools.linlogspace
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../generated/ess.amor.tools.std_to_fwhm.html">
         ess.amor.tools.std_to_fwhm
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../generated/ess.amor.instrument_view.instrument_view.html">
       ess.amor.instrument_view.instrument_view
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../generated/ess.amor.load.load.html">
       ess.amor.load.load
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../instruments/dream/dream.html">
   DREAM
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../instruments/dream/dream-instrument-view.html">
     DREAM instrument view
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../instruments/loki/loki.html">
   Loki
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
  <label for="toctree-checkbox-11">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../instruments/loki/sans2d_to_I_of_Q.html">
     SANS2D: I(Q) workflow for a single run (sample)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../instruments/loki/sans2d_reduction.html">
     SANS2D: I(Q) for sample and background
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../instruments/external/external.html">
   External Instruments
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
  <label for="toctree-checkbox-12">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../instruments/external/offspec/offspec_reduction.html">
     Collimated data reduction for OFFSPEC
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../instruments/external/powgen/powgen.html">
     POWGEN
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/>
    <label for="toctree-checkbox-13">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../instruments/external/powgen/powgen_reduction.html">
       Data reduction for POWGEN
      </a>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../../instruments/external/powgen/reference.html">
       Reference
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/>
      <label for="toctree-checkbox-14">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../../generated/ess.external.powgen.beamline.html">
         ess.external.powgen.beamline
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Techniques
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../diffraction/diffraction.html">
   Diffraction
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/>
  <label for="toctree-checkbox-15">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../diffraction/reference.html">
     Reference
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/>
    <label for="toctree-checkbox-16">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../generated/ess.diffraction.normalize_by_monitor.html">
       ess.diffraction.normalize_by_monitor
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../generated/ess.diffraction.normalize_by_vanadium.html">
       ess.diffraction.normalize_by_vanadium
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../generated/ess.diffraction.lowpass.html">
       ess.diffraction.lowpass
      </a>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../diffraction/powder.html">
       Powder
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/>
      <label for="toctree-checkbox-17">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../../generated/ess.diffraction.powder.conversions.dspacing_from_diff_calibration.html">
         ess.diffraction.powder.conversions.dspacing_from_diff_calibration
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../generated/ess.diffraction.powder.to_dspacing_with_calibration.html">
         ess.diffraction.powder.to_dspacing_with_calibration
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../generated/ess.diffraction.powder.merge_calibration.html">
         ess.diffraction.powder.merge_calibration
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../reflectometry/reflectometry.html">
   Reflectometry
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" type="checkbox"/>
  <label for="toctree-checkbox-18">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../reflectometry/reference.html">
     Reference
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" type="checkbox"/>
    <label for="toctree-checkbox-19">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../generated/ess.reflectometry.conversions.specular_reflection.html">
       ess.reflectometry.conversions.specular_reflection
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../generated/ess.reflectometry.corrections.footprint_correction.html">
       ess.reflectometry.corrections.footprint_correction
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../generated/ess.reflectometry.corrections.normalize_by_counts.html">
       ess.reflectometry.corrections.normalize_by_counts
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../generated/ess.reflectometry.corrections.beam_on_sample.html">
       ess.reflectometry.corrections.beam_on_sample
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../generated/ess.reflectometry.io.save_ort.html">
       ess.reflectometry.io.save_ort
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../sans/sans.html">
   SANS
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" type="checkbox"/>
  <label for="toctree-checkbox-20">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../sans/sans-beam-center-finder.html">
     Beam center finder
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../sans/reference.html">
     Reference
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" type="checkbox"/>
    <label for="toctree-checkbox-21">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../sans/i_of_q.html">
       I(Q) reduction workflow
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" type="checkbox"/>
      <label for="toctree-checkbox-22">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../../generated/ess.sans.i_of_q.to_I_of_Q.html">
         ess.sans.i_of_q.to_I_of_Q
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../generated/ess.sans.i_of_q.convert_to_q_and_merge_spectra.html">
         ess.sans.i_of_q.convert_to_q_and_merge_spectra
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../generated/ess.sans.i_of_q.preprocess_monitor_data.html">
         ess.sans.i_of_q.preprocess_monitor_data
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../generated/ess.sans.i_of_q.resample_direct_beam.html">
         ess.sans.i_of_q.resample_direct_beam
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../generated/ess.sans.beam_center_finder.beam_center.html">
       ess.sans.beam_center_finder.beam_center
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../generated/ess.sans.beam_center_finder.center_of_mass.html">
       ess.sans.beam_center_finder.center_of_mass
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../generated/ess.sans.beam_center_finder.cost.html">
       ess.sans.beam_center_finder.cost
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../generated/ess.sans.beam_center_finder.iofq_in_quadrants.html">
       ess.sans.beam_center_finder.iofq_in_quadrants
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../generated/ess.sans.beam_center_finder.minimize.html">
       ess.sans.beam_center_finder.minimize
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../generated/ess.sans.conversions.sans_elastic.html">
       ess.sans.conversions.sans_elastic
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../generated/ess.sans.conversions.sans_monitor.html">
       ess.sans.conversions.sans_monitor
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../generated/ess.sans.normalization.solid_angle_of_rectangular_pixels.html">
       ess.sans.normalization.solid_angle_of_rectangular_pixels
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../generated/ess.sans.normalization.transmission_fraction.html">
       ess.sans.normalization.transmission_fraction
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../generated/ess.sans.normalization.iofq_denominator.html">
       ess.sans.normalization.iofq_denominator
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../generated/ess.sans.normalization.normalize.html">
       ess.sans.normalization.normalize
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../generated/ess.sans.common.gravity_vector.html">
       ess.sans.common.gravity_vector
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../generated/ess.sans.common.mask_range.html">
       ess.sans.common.mask_range
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="wfm.html">
   Wavelength frame multiplication
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" type="checkbox"/>
  <label for="toctree-checkbox-23">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Introduction to Wavelength Frame Multiplication
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="reducing-wfm-data.html">
     Reducing WFM data
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Utilities
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../utilities/utilities.html">
   Modules
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-24" name="toctree-checkbox-24" type="checkbox"/>
  <label for="toctree-checkbox-24">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../generated/modules/ess.logging.html">
     ess.logging
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-25" name="toctree-checkbox-25" type="checkbox"/>
    <label for="toctree-checkbox-25">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../generated/modules/ess.logging.configure.html">
       ess.logging.configure
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../generated/modules/ess.logging.configure_workflow.html">
       ess.logging.configure_workflow
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../generated/modules/ess.logging.default_loggers_to_configure.html">
       ess.logging.default_loggers_to_configure
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../generated/modules/ess.logging.get_logger.html">
       ess.logging.get_logger
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../generated/modules/ess.logging.greet.html">
       ess.logging.greet
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../generated/modules/ess.logging.log_call.html">
       ess.logging.log_call
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../generated/modules/ess.logging.Formatter.html">
       ess.logging.Formatter
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../generated/modules/ess.masking.html">
     ess.masking
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-26" name="toctree-checkbox-26" type="checkbox"/>
    <label for="toctree-checkbox-26">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../generated/modules/ess.masking.save_detector_masks.html">
       ess.masking.save_detector_masks
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../generated/modules/ess.uncertainty.html">
     ess.uncertainty
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-27" name="toctree-checkbox-27" type="checkbox"/>
    <label for="toctree-checkbox-27">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../generated/modules/ess.uncertainty.variance_normalized_signal_over_monitor.html">
       ess.uncertainty.variance_normalized_signal_over_monitor
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Developer documentation
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../developer/style-guide.html">
   Style guide
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../developer/getting-started.html">
   Getting Started
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  About
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../about/release-notes.html">
   Release Notes
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        

















<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="None">
<span class="headerbtn__text-container">Related projects</span>
<i class="fa fa-caret-down"></i>
  </button>
<div class="menu-dropdown__content" style="transform:translateX(0%)">
    <ul>
      <li>
        <a href="https://scipp.github.io"
   class="headerbtn"
   
>
  

<span class="headerbtn__text-container">scipp</span>
</a>

      </li>
      
      <li>
        <a href="https://scipp.github.io/plopp"
   class="headerbtn"
   
>
  

<span class="headerbtn__text-container">plopp</span>
</a>

      </li>
      
      <li>
        <a href="https://scipp.github.io/scippnexus"
   class="headerbtn"
   
>
  

<span class="headerbtn__text-container">scippnexus</span>
</a>

      </li>
      
      <li>
        <a href="https://scipp.github.io/scippneutron"
   class="headerbtn"
   
>
  

<span class="headerbtn__text-container">scippneutron</span>
</a>

      </li>
      
      <li>
        <a href="https://scipp.github.io/ess"
   class="headerbtn"
   
>
  

<span class="headerbtn__text-container">ess</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="None">
<span class="headerbtn__text-container">24.1.1.dev5+g8409fb3 (latest)</span>
<i class="fa fa-caret-down"></i>
  </button>
<div class="menu-dropdown__content" style="transform:translateX(0%)">
    <ul>
      <li>
        <a href="https://scipp.github.io/ess"
   class="headerbtn"
   
>
  

<span class="headerbtn__text-container">24.1 (latest)</span>
</a>

      </li>
      
      <li>
        <a href="https://scipp.github.io/ess/release/23.11"
   class="headerbtn"
   
>
  

<span class="headerbtn__text-container">23.11</span>
</a>

      </li>
      
      <li>
        <a href="https://scipp.github.io/ess/release/23.10"
   class="headerbtn"
   
>
  

<span class="headerbtn__text-container">23.10</span>
</a>

      </li>
      
      <li>
        <a href="https://scipp.github.io/ess/release/23.4"
   class="headerbtn"
   
>
  

<span class="headerbtn__text-container">23.4</span>
</a>

      </li>
      
      <li>
        <a href="https://scipp.github.io/ess/release/23.1"
   class="headerbtn"
   
>
  

<span class="headerbtn__text-container">23.1</span>
</a>

      </li>
      
      <li>
        <a href="https://scipp.github.io/ess/release/0.9"
   class="headerbtn"
   
>
  

<span class="headerbtn__text-container">0.9</span>
</a>

      </li>
      
      <li>
        <a href="https://scipp.github.io/ess/release/0.8"
   class="headerbtn"
   
>
  

<span class="headerbtn__text-container">0.8</span>
</a>

      </li>
      
      <li>
        <a href="https://scipp.github.io/ess/release/0.7"
   class="headerbtn"
   
>
  

<span class="headerbtn__text-container">0.7</span>
</a>

      </li>
      
      <li>
        <a href="https://scipp.github.io/ess/release/0.6"
   class="headerbtn"
   
>
  

<span class="headerbtn__text-container">0.6</span>
</a>

      </li>
      
      <li>
        <a href="https://scipp.github.io/ess/release/0.5"
   class="headerbtn"
   
>
  

<span class="headerbtn__text-container">0.5</span>
</a>

      </li>
      
      <li>
        <a href="https://scipp.github.io/ess/release/0.4"
   class="headerbtn"
   
>
  

<span class="headerbtn__text-container">0.4</span>
</a>

      </li>
      
      <li>
        <a href="https://scipp.github.io/ess/release/0.3"
   class="headerbtn"
   
>
  

<span class="headerbtn__text-container">0.3</span>
</a>

      </li>
      
      <li>
        <a href="https://scipp.github.io/ess/release/0.2"
   class="headerbtn"
   
>
  

<span class="headerbtn__text-container">0.2</span>
</a>

      </li>
      
      <li>
        <a href="https://scipp.github.io/ess/release/0.1"
   class="headerbtn"
   
>
  

<span class="headerbtn__text-container">0.1</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">

<i class="fab fa-github"></i>
  </button>
<div class="menu-dropdown__content" >
    <ul>
      <li>
        <a href="https://github.com/scipp/ess"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/scipp/ess/issues/new?title=Issue%20on%20page%20%2Ftechniques/wfm/introduction-to-wfm.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/scipp/ess/edit/main/docs/techniques/wfm/introduction-to-wfm.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">

<i class="fas fa-download"></i>
  </button>
<div class="menu-dropdown__content" >
    <ul>
      <li>
        <a href="../../_sources/techniques/wfm/introduction-to-wfm.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#The-long-ESS-pulse">
   The long ESS pulse
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#So-what-is-WFM-anyway?">
   So what is WFM anyway?
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#A-closer-look">
   A closer look
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#The-ESS-pulse-shape">
     The ESS pulse shape
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Using-a-single-WFM-chopper">
     Using a single WFM chopper
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Using-a-pair-of-optically-blind-choppers">
     Using a pair of optically blind choppers
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#A-short-example">
   A short example
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Create-a-beamline">
     Create a beamline
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Create-some-neutrons">
     Create some neutrons
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Wrap-the-neutron-counts-and-the-beamline-into-a-DataArray">
     Wrap the neutron counts and the beamline into a DataArray
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Stitch-the-frames">
     Stitch the frames
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#References">
   References
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Introduction to Wavelength Frame Multiplication</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#The-long-ESS-pulse">
   The long ESS pulse
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#So-what-is-WFM-anyway?">
   So what is WFM anyway?
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#A-closer-look">
   A closer look
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#The-ESS-pulse-shape">
     The ESS pulse shape
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Using-a-single-WFM-chopper">
     Using a single WFM chopper
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Using-a-pair-of-optically-blind-choppers">
     Using a pair of optically blind choppers
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#A-short-example">
   A short example
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Create-a-beamline">
     Create a beamline
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Create-some-neutrons">
     Create some neutrons
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Wrap-the-neutron-counts-and-the-beamline-into-a-DataArray">
     Wrap the neutron counts and the beamline into a DataArray
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Stitch-the-frames">
     Stitch the frames
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#References">
   References
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section id="Introduction-to-Wavelength-Frame-Multiplication">
<h1>Introduction to Wavelength Frame Multiplication<a class="headerlink" href="#Introduction-to-Wavelength-Frame-Multiplication" title="Permalink to this headline">#</a></h1>
<p>This notebook aims to explain the concept of wavelength frame multiplication (WFM), why is it used, how it works, and what results can be expected from using WFM at a neutron beamline.</p>
<p>Much of the material presented here was inspired by / copied from the paper by Schmakat et al. (2020), which we highly recommend to the reader, for more details on how a WFM chopper system is designed.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">scipp</span> <span class="k">as</span> <span class="nn">sc</span>
<span class="kn">from</span> <span class="nn">scipp</span> <span class="kn">import</span> <span class="n">constants</span>
<span class="kn">import</span> <span class="nn">scippneutron</span> <span class="k">as</span> <span class="nn">scn</span>
<span class="kn">import</span> <span class="nn">ess.wfm</span> <span class="k">as</span> <span class="nn">wfm</span>
<span class="kn">import</span> <span class="nn">ess.choppers</span> <span class="k">as</span> <span class="nn">ch</span>
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title"><strong>Note</strong></p>
<p>The source code used to create the figures below can be viewed by downloading this notebook (this is hidden from the documentation pages for the sake of clarity).</p>
</div>
<section id="The-long-ESS-pulse">
<h2>The long ESS pulse<a class="headerlink" href="#The-long-ESS-pulse" title="Permalink to this headline">#</a></h2>
<p>Instruments at a pulsed neutron source, assuming an idealized rectangular source pulse in time of length <span class="math notranslate nohighlight">\(t_{P}\)</span>, have a resolution given by</p>
<div class="math notranslate nohighlight">
\[\frac{\Delta \lambda}{\lambda} = \frac{t_{P}}{t} = \frac{t_{P}}{\alpha \lambda z_{\rm det}} ~, ~~~~~(1)\]</div>
<p>where <span class="math notranslate nohighlight">\(\lambda\)</span> is the neutron wavelength, <span class="math notranslate nohighlight">\(t\)</span> is time, <span class="math notranslate nohighlight">\(\alpha = m_{\rm n}/h = 2.5278 \times 10^{-4}~{\rm s}\unicode{x212B}^{-1}{\rm m}^{-1}\)</span> is the ratio of the neutron mass and the Planck constant, and <span class="math notranslate nohighlight">\(z_{\rm det}\)</span> is the distance from the source to the detector.</p>
<p>Here, we have assumed that the neutron velocity <span class="math notranslate nohighlight">\(v\)</span> is related to its wavelength via the de Broglie equation</p>
<div class="math notranslate nohighlight">
\[\lambda = \frac{h}{m_{\rm n}v} = \frac{1}{\alpha v} ~.\]</div>
<p>A natural consequence of this is that the wavelength resolution <span class="math notranslate nohighlight">\(\Delta \lambda / \lambda\)</span> becomes finer with increasing wavelength.</p>
<p>This also means that the resolution is poor for a long-pulsed source such as the ESS, compared to that of a short-pulse facility, such as ISIS. A good way to visualize this is using a time-distance diagram, which can represent the paths taken by the neutrons from the source to the detector.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">figure1</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/techniques_wfm_introduction-to-wfm_5_0.png" src="../../_images/techniques_wfm_introduction-to-wfm_5_0.png" />
</div>
</div>
<p>As illustrated in Fig. 1, with a long pulse, two neutrons with very different wavelengths (<span class="math notranslate nohighlight">\(\lambda_{1} &lt; \lambda_{2}\)</span>) can reach the detector at the exact same time, if they originated from a different part of the pulse.</p>
<p>The problem cannot be resolved at the detector. According to the difference between time recorded at the detector and the measured start of the source pulse, both neutrons have the same wavelength. The detector recording system has no way of knowing that this is not the reality or adjusting for this. We instead look at the pulse generation to find ways to better measure the wavelength of our neutrons.</p>
</section>
<section id="So-what-is-WFM-anyway?">
<h2>So what is WFM anyway?<a class="headerlink" href="#So-what-is-WFM-anyway?" title="Permalink to this headline">#</a></h2>
<p>Within the concept of wavelength frame multiplication (WFM), each source pulse is chopped into a number of sub pulses referred to as wavelength frames, where each wavelength frame <span class="math notranslate nohighlight">\(N\)</span> contains a subsequent part of the spectrum of the source pulse.</p>
<p>The main reason for using the WFM concept is to redefine the burst time <span class="math notranslate nohighlight">\(t_{P} = \Delta t\)</span> as implied by Eq. (1), in order to match the required wavelength resolution of the experiment. A secondary objective, or constraint of the first, is to utilize as much of the source pulse as possible.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">figure2</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/techniques_wfm_introduction-to-wfm_8_0.png" src="../../_images/techniques_wfm_introduction-to-wfm_8_0.png" />
</div>
</div>
</section>
<section id="A-closer-look">
<h2>A closer look<a class="headerlink" href="#A-closer-look" title="Permalink to this headline">#</a></h2>
<section id="The-ESS-pulse-shape">
<h3>The ESS pulse shape<a class="headerlink" href="#The-ESS-pulse-shape" title="Permalink to this headline">#</a></h3>
<p>At a real beamline, the pulse shape is not rectangular, but has rising and falling edges, as shown in Fig. 3.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">figure3</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/techniques_wfm_introduction-to-wfm_10_0.png" src="../../_images/techniques_wfm_introduction-to-wfm_10_0.png" />
</div>
</div>
<p>Here we define several important quantities:</p>
<ul class="simple">
<li><p>The pulse <span class="math notranslate nohighlight">\(t_0\)</span> is defined as the point in time at which the pulse is bright enough for the purposes of the experiment.</p></li>
<li><p><span class="math notranslate nohighlight">\(t_{\rm A}\)</span> is the time when the flux has fallen down to a level below the required brightness.</p></li>
<li><p><span class="math notranslate nohighlight">\(t_{\rm P} = t_{\rm A} - t_{0}\)</span> is the portion of the pulse that is used for the measurements, the analog of the pulse length for the ideal rectangular pulse above.</p></li>
<li><p><span class="math notranslate nohighlight">\(t_{\rm B}\)</span> marks the end of the pulse; i.e. the time when the flux is considered to be effectively zero.</p></li>
</ul>
</section>
<section id="Using-a-single-WFM-chopper">
<h3>Using a single WFM chopper<a class="headerlink" href="#Using-a-single-WFM-chopper" title="Permalink to this headline">#</a></h3>
<p>The effective burst time <span class="math notranslate nohighlight">\(\Delta t\)</span> is defined by a WFM chopper (WFMC), as illustrated in Fig. 4, for the two limiting wavelengths <span class="math notranslate nohighlight">\(\lambda_{\rm min}\)</span> and <span class="math notranslate nohighlight">\(\lambda_{\rm max}\)</span> of a single wavelength frame <span class="math notranslate nohighlight">\(N\)</span>.</p>
<p>The wavelength frame is re-limited in a predefined time window by at least one frame overlap chopper (FOC) that inhibits the overlap of neutrons from various frames, as indicated by the dashed lines in Fig. 4. Their wavelength is labeled with <span class="math notranslate nohighlight">\(\lambda_{\rm min}^{'}\)</span> and <span class="math notranslate nohighlight">\(\lambda_{\rm max}^{'}\)</span>. The FOC is also removes undesired neutrons with the wrong wavelength that arise from the rising and falling edges at the beginning and at the end of the source pulse. Although their intensity
is small, neutrons with an undesired wavelength would lead to an increased background.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">figure4</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/techniques_wfm_introduction-to-wfm_12_0.png" src="../../_images/techniques_wfm_introduction-to-wfm_12_0.png" />
</div>
</div>
<p>The relative spectral resolution <span class="math notranslate nohighlight">\(\Delta \lambda / \lambda\)</span> at the detector position <span class="math notranslate nohighlight">\(z_{\rm det}\)</span> is defined by the burst time <span class="math notranslate nohighlight">\(\Delta t\)</span> and the time-of-flight <span class="math notranslate nohighlight">\(t(\lambda)\)</span> of the neutrons (see eq. (1)). Because <span class="math notranslate nohighlight">\(\Delta t\)</span> is independent of the wavelength for the case of a single WFM chopper disc, <span class="math notranslate nohighlight">\(\Delta \lambda / \lambda\)</span> depends on <span class="math notranslate nohighlight">\(\lambda\)</span>, on the distance <span class="math notranslate nohighlight">\(z_{\rm WFM}\)</span> of the WFM chopper from the source, and on the detector position
<span class="math notranslate nohighlight">\(z_{\rm det}\)</span> as depicted in Fig. 4.</p>
<p>The WFM chopper acts as a virtual source, reducing the effective burst time <span class="math notranslate nohighlight">\(\Delta t\)</span>, while at the same time also reducing the effective time-of-flight to the detector from <span class="math notranslate nohighlight">\(t(\lambda) = \alpha \lambda z_{\rm det}\)</span> to <span class="math notranslate nohighlight">\(t(\lambda) = \alpha \lambda (z_{\rm det} - z_{\rm WFM})\)</span>. Note that this assumes a straight line from WFM choppers to the detector. In the case of scattering from a sample, the first branch of the flight path (<span class="math notranslate nohighlight">\(L_{1}\)</span>) would be modified, while the
secondary path (<span class="math notranslate nohighlight">\(L_{2}\)</span>) will remain unchanged.</p>
<p>A resolution that depends on <span class="math notranslate nohighlight">\(\lambda\)</span> is not suited for some applications (such as imaging, reflectometry, …) where a constant <span class="math notranslate nohighlight">\(\Delta \lambda / \lambda\)</span> is much more desirable.</p>
</section>
<section id="Using-a-pair-of-optically-blind-choppers">
<h3>Using a pair of optically blind choppers<a class="headerlink" href="#Using-a-pair-of-optically-blind-choppers" title="Permalink to this headline">#</a></h3>
<p>A constant wavelength resolution <span class="math notranslate nohighlight">\(\Delta \lambda / \lambda\)</span> can be enforced by using a pair of optically blind WFM chopper discs, positioned at the positions <span class="math notranslate nohighlight">\(z_{\rm WFM1}\)</span> and <span class="math notranslate nohighlight">\(z_{\rm WFM2} = z_{\rm WFM1} + \Delta z_{\rm WFM}\)</span>, as shown in Fig. 5.</p>
<p>In this context, ‘optically blind’ indicates that the choppers have the same opening angles, but the phase of the second chopper is shifted such that the second chopper opens exactly at the time when the first chopper closes. Such a setup introduces a wavelength dependence in the effective burst time <span class="math notranslate nohighlight">\(\Delta t(\lambda) = \alpha \lambda \Delta z_{\rm WFM}\)</span>.</p>
<p>The time-of-flight to the detector remains the same as for the single WFM disc setup described above (<span class="math notranslate nohighlight">\(t(\lambda) = \alpha \lambda (z_{\rm det} - z_{\rm WFM})\)</span>) with <span class="math notranslate nohighlight">\(z_{\rm WFM} = \frac{1}{2} (z_{\rm WFM1} + z_{\rm WFM2})\)</span> now representing the center position of the WFM chopper pair from the source.</p>
<p>The resolution for an idealized instrument with infinitesimally small beam cross-section can again be calculated using Eq. (1):</p>
<div class="math notranslate nohighlight">
\[\frac{\Delta \lambda}{\lambda} = \frac{\Delta t(\lambda)}{t(\lambda)} = \frac{\Delta z_{\rm WFM}}{z_{\rm det} - z_{\rm WFM}} ~. ~~~~~(2)\]</div>
<p>Because the term on the right hand side of Eq. (2) is constant, the resolution becomes independent of the wavelength for an optically blind WFM chopper system.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">figure5</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/techniques_wfm_introduction-to-wfm_14_0.png" src="../../_images/techniques_wfm_introduction-to-wfm_14_0.png" />
</div>
</div>
<p>In a real WFM chopper system, more than one frame can be realized by equipping the chopper with additional windows such that the full band width that fits in the time period between two subsequent source pulses at the detector position is used. This is illustrated in Fig. 6.</p>
<p>The frame overlap chopper defines the bandwidth of the frame <span class="math notranslate nohighlight">\(N\)</span> in order to suppress cross-talk from neighboring wavelength frames, as illustrated in Fig. 6 for two subsequent wavelength frames <span class="math notranslate nohighlight">\(N = 1\)</span> and <span class="math notranslate nohighlight">\(N = 2\)</span>. They are designed such that <span class="math notranslate nohighlight">\(\lambda_{N, {\rm max}} = \lambda_{N+1, {\rm min}}\)</span> yield a continuous spectrum at the detector. The concept of wavelength frame multiplication implies that no data can be recorded in the time window between two subsequent
wavelength frames.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">figure6</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/techniques_wfm_introduction-to-wfm_16_0.png" src="../../_images/techniques_wfm_introduction-to-wfm_16_0.png" />
</div>
</div>
<p>An additional feature of the WFM concept is the possibility to adjust the wavelength resolution by simply changing the distance <span class="math notranslate nohighlight">\(\Delta z_{\rm WFM}\)</span> between the WFM chopper discs (e.g. by using a motorized linear stage). According to Eq. (2), reducing <span class="math notranslate nohighlight">\(\Delta z_{\rm WFM}\)</span> leads to a finer wavelength resolution at the cost of intensity by effectively reducing the time window in which the neutrons can pass.</p>
</section>
</section>
<section id="A-short-example">
<h2>A short example<a class="headerlink" href="#A-short-example" title="Permalink to this headline">#</a></h2>
<p>We now proceed to illustrate data processing at a WFM beamline in the form of a short example.</p>
<section id="Create-a-beamline">
<h3>Create a beamline<a class="headerlink" href="#Create-a-beamline" title="Permalink to this headline">#</a></h3>
<p>We first create a beamline with two WFM choppers and 6 wavelength frames, using the <code class="docutils literal notranslate"><span class="pre">wfm.make_fake_beamline</span></code> helper utility. The detector is placed 60 m from the source.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">coords</span> <span class="o">=</span> <span class="n">wfm</span><span class="o">.</span><span class="n">make_fake_beamline</span><span class="p">(</span><span class="n">nframes</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">coords</span><span class="o">=</span><span class="n">coords</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">wfm</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">time_distance_diagram</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/techniques_wfm_introduction-to-wfm_18_0.png" src="../../_images/techniques_wfm_introduction-to-wfm_18_0.png" />
</div>
</div>
<p>The properties of the frames (boundaries in time and wavelength) are computed using the <code class="docutils literal notranslate"><span class="pre">wfm.get_frames</span></code> function</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">frames</span> <span class="o">=</span> <span class="n">wfm</span><span class="o">.</span><span class="n">get_frames</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
<span class="n">frames</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div><style id="scipp-style-sheet">.sc-root{--sc-background-color0:var(--jp-layout-color0,#fff);--sc-background-color1:var(--jp-layout-color1,#fcfcfc);--sc-background-color2:var(--jp-layout-color2,#efefef);--sc-inverse-background-color0:var(--jp-inverse-layout-color4,#111);--sc-font-color0:var(--jp-content-font-color0,#000);--sc-font-color1:var(--jp-content-font-color1,#555);--sc-font-color2:var(--jp-content-font-color2,#888);--sc-font-color3:var(--jp-content-font-color3,#ccc);--sc-table-data-color:#f6d028;--sc-table-coords-color:#c6e590;--sc-table-masks-color:#c8c8c8;--sc-table-attrs-color:#ff5555;--sc-table-header-font-color:#111111;}.sc-wrap{font-size:14px;min-width:300px;max-width:800px;}.sc-var-attrs .sc-wrap{padding-left:3em;}.sc-header{padding-top:6px;padding-bottom:6px;margin-bottom:4px;border-bottom:solid 1px #ddd;}.sc-header > div,.sc-header > ul{display:inline;margin-top:0;margin-bottom:0;}.sc-obj-type,.sc-array-name{margin-left:2px;margin-right:10px;}.sc-obj-type{color:var(--sc-font-color1);}.sc-underlying-size{color:var(--sc-font-color2);}.sc-sections,.reveal .sc-sections{padding-left:0 !important;display:grid;grid-template-columns:150px auto auto auto 1fr 20px 20px;}.sc-section-item{display:contents;}.sc-section-item input{display:none;}.sc-section-item input:enabled + label{cursor:pointer;color:var(--sc-font-color1);}.sc-section-item input:enabled + label:hover{color:var(--sc-font-color0);}.sc-section-summary{grid-column:1;font-weight:500;}.sc-section-summary > span{display:inline-block;padding-left:0.5em;}.sc-section-summary-in:disabled + label{color:var(--sc-font-color1);}.sc-section-summary-in + label:before{display:inline-block;content:'►';font-size:11px;width:15px;text-align:center;}.sc-section-summary-in:disabled + label:before{color:var(--sc-font-color3);}.sc-section-summary-in:checked + label:before{content:'▼';}.sc-section-summary-in:checked + label > span{display:none;}.sc-section-summary,.sc-section-inline-details{padding-top:4px;padding-bottom:4px;}.sc-section-inline-details{grid-column:2 / 6;}.sc-section-details{display:none;grid-column:1 / -1;margin-bottom:5px;}.sc-section-summary-in:checked ~ .sc-section-details{display:contents;}.sc-array-wrap{grid-column:1 / -1;display:grid;grid-template-columns:20px auto;}.sc-array-wrap > label{grid-column:1;vertical-align:top;}.sc-preview{color:var(--sc-font-color2);}.sc-array-preview,.sc-array-data{padding:0 5px !important;grid-column:2;}.sc-array-data,.sc-array-in:checked ~ .sc-array-preview{display:none;}.sc-array-in:checked ~ .sc-array-data,.sc-array-preview{display:inline-block;}.sc-dim-list{display:inline-block !important;list-style:none;padding:0 !important;margin:0;}.sc-dim-list li{display:inline-block;padding:0;margin:0!important;}.sc-dim-list:before{content:'(';}.sc-dim-list:after{content:')';}.sc-dim-list li:not(:last-child):after{content:',';padding-right:5px;}.sc-dim-list li span,.sc-standalone-var-name > span span,.sc-var-name > span span{padding:0 !important;}.sc-aligned{font-weight:bold;}.sc-var-list,.sc-var-item,.reveal .sc-var-list,.reveal .sc-var-item{display:contents;}.sc-var-item > div,.sc-var-item label,.sc-var-item > .sc-var-name span{background-color:var(--sc-background-color1);margin-bottom:0;}.sc-var-item > .sc-var-name:hover span{padding-right:5px;}.sc-var-list > li:nth-child(odd) > div,.sc-var-list > li:nth-child(odd) > label,.sc-var-list > li:nth-child(odd) > .sc-var-name span{background-color:var(--sc-background-color2);}.sc-var-name{grid-column:1;}.sc-var-dims{grid-column:2;}.sc-var-dtype{grid-column:3;text-align:right;color:var(--sc-font-color2);}.sc-var-unit{grid-column:4;text-align:left;color:var(--sc-font-color1);max-width:50pt;text-overflow:ellipsis;}.sc-value-preview{grid-column:5;}.sc-var-preview-variances{text-align:right;}.sc-sections .sc-section-item .sc-section-summary,.sc-sections .sc-section-item .sc-section-inline-details,.sc-section-item .sc-var-list .sc-var-item > div,.sc-section-item .sc-var-list .sc-var-item > label,.sc-section-details .sc-var-list .sc-var-item > div,.sc-section-details .sc-var-list .sc-var-item > label{margin-top:0;margin-bottom:0;}.sc-var-name,.sc-var-dims,.sc-var-dtype,.sc-var-unit,.sc-preview,.sc-attrs dt{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;padding-right:10px;}.sc-var-name:hover,.sc-var-dims:hover,.sc-var-dtype:hover,.sc-var-unit:hover,.sc-attrs dt:hover{overflow:visible;width:auto;z-index:1;}.sc-var-attrs{display:block;}.sc-var-data,.reveal .sc-var-data{display:none;}.sc-var-attrs,.sc-var-data{background-color:var(--sc-background-color0) !important;padding-bottom:5px !important;}.sc-var-attrs-in:checked ~ .sc-var-attrs{display:none;}.sc-var-data-in:checked ~ .sc-var-data{display:block;}.sc-var-data > table{float:right;}.sc-var-name span,.sc-var-data{padding-left:25px !important;}.sc-var-attrs,.sc-var-data{grid-column:1 / -1;}dl.sc-attrs{padding:0;margin:0;display:grid;grid-template-columns:125px auto;}.sc-attrs dt,dd{padding:0;margin:0;float:left;padding-right:10px;width:auto;}.sc-attrs dt{font-weight:normal;grid-column:1;}.sc-attrs dt:hover span{display:inline-block;padding-right:10px;}.sc-attrs dd{grid-column:2;white-space:pre-wrap;word-break:break-all;}.sc-icon-database,.sc-icon-file-text2{display:inline-block;vertical-align:middle;width:1em;height:1.5em !important;stroke-width:0;stroke:currentColor;fill:currentColor;}label.sc-hide-icon svg{opacity:0;}.sc-standalone-var-name{grid-column:1/3;}.sc-standalone-var-name span{padding-left:25px;padding-right:10px;}.sc-table{border-collapse:collapse;}.sc-title{font-weight:bold;font-size:1.5em;}.sc-subtitle{font-weight:normal;font-style:italic;text-align:left;font-size:1.2em;padding:1px;}.sc-table th,.sc-table td{border:1px solid var(--sc-inverse-background-color0);padding:0 5px 0 5px;}.sc-table th{text-align:center;}.sc-table tr{background-color:var(--sc-background-color1);text-align:right;}.sc-table tr:hover{background-color:var(--sc-background-color2);}.sc-table th.sc-data{background-color:var(--sc-table-data-color);color:var(--sc-table-header-font-color);}.sc-table th.sc-coords{background-color:var(--sc-table-coords-color);color:var(--sc-table-header-font-color);}.sc-table th.sc-masks{background-color:var(--sc-table-masks-color);color:var(--sc-table-header-font-color);}.sc-table th.sc-attrs{background-color:var(--sc-table-attrs-color);color:var(--sc-table-header-font-color);}.sc-table th.sc-subheader{background-color:var(--sc-background-color2);}.sc-table td.sc-padding{background-color:var(--sc-background-color1);border:0 solid var(--sc-background-color1);height:1.2em;}.sc-label{fill:var(--sc-font-color0,#444444);text-anchor:middle;}.sc-name{fill:var(--sc-font-color0,#111111);}.sc-inset-line{stroke:var(--sc-font-color1);stroke-width:0.05;stroke-dasharray:0.2,0.2;}.sc-log-wrap{height:25ex;resize:vertical;overflow-y:scroll;display:flex;flex-direction:column-reverse;border:1px solid;border-color:var(--jp-border-color2);background-color:var(--sc-background-color1);}div.sc-log{line-height:2.5ex;}table.sc-log{table-layout:auto;border-collapse:collapse;}tr.sc-log:nth-child(even){background-color:var(--sc-background-color0);}tr.sc-log > td{vertical-align:top;padding-bottom:0.5ex;}.sc-log-time-stamp{min-width:22ch;font-family:var(--jp-code-font-family);color:var(--sc-font-color2);}.sc-log-level{min-width:10ch;}tr.sc-log-debug td.sc-log-level{color:var(--jp-accent-color1);}tr.sc-log-info td.sc-log-level{color:var(--jp-info-color1);}tr.sc-log-warning td.sc-log-level{color:var(--jp-warn-color1);}tr.sc-log-error td.sc-log-level{font-weight:bold;color:var(--jp-error-color2);}tr.sc-log-critical td.sc-log-level{font-weight:bold;color:var(--sc-background-color0);background-color:var(--jp-error-color1);}.sc-log-message{white-space:pre-wrap;width:100%;}.sc-log-html-payload{white-space:normal;}.sc-log-name{padding-right:0.5em;text-align:right;white-space:pre-wrap;color:var(--sc-font-color3);}</style><style id="datagroup-style-sheet">.dg-root{white-space:normal;font-size:14px;min-width:300px;max-width:1200px;}.dg-root *{box-sizing:border-box;}.sc-header > label,.sc-header > label > div,.sc-header > label > div > ul{display:inline;margin-bottom:0;}.dg-header-in{display:none;}.dg-header-in + .sc-header > label:before{display:inline-block;font-size:11px;text-align:left;content:'►';}.dg-header-in:checked + .sc-header > label:before{content:'▼';}.dg-header-in ~ .dg-detail-box{display:none;}.dg-header-in:checked ~ .dg-detail-box{display:grid;}.dg-detail-box{margin-top:5px;margin-bottom:5px;column-gap:0 !important;display:grid;grid-template-columns:max-content max-content max-content max-content max-content max-content max-content;grid-template-areas:"name        parent      object-type shape       dtype       unit        preview";}.dg-detail-box *{margin-top:0;margin-bottom:0;}.dg-detail-list{display:contents;}.dg-detail-item{display:contents;list-style-type:none;}.dg-detail-item-in{display:none;}.dg-detail-item-in + .dg-detail-name > label:before{display:inline-block;font-size:14px;text-align:left;content:'►';}.dg-detail-item-in:checked + .dg-detail-name > label:before{content:'▼';}.dg-detail-item div,.dg-detail-item span,.dg-detail-item label{word-break:break-all;min-width:1em;max-width:20em;width:100%;}.dg-detail-item > div{display:contents;}.dg-detail-item > div > div > div{width:100%;}.dg-detail-item:hover > div > div{background-color:var(--sc-background-color2) !important;}.dg-detail-item > div span{padding-left:10px;padding-right:10px;}.dg-detail-item > div > div:first-of-type{grid-column-start:1;}.dg-detail-item-subsection{display:none;}.dg-detail-item-in{margin:0;}.dg-detail-item-in:checked ~ .dg-detail-item-subsection{display:contents;}.dg-detail-item .dg-detail-name{grid-area:"name";min-width:5em;}.dg-detail-name{padding-left:calc(var(--depth)*2em);}.dg-detail-name > label{padding-left:8px;}.dg-detail-name > label > span{padding-left:0.1em;}.dg-detail-item .dg-detail-parent{grid-area:"parent";text-align:right;}.dg-detail-item .dg-detail-objtype{grid-area:"objtype";text-align:left;}.dg-detail-item .dg-detail-shape{max-width:30em;grid-area:"shape";text-align:left;}.sc-header .dg-detail-shape{margin-left:1em;text-align:left;}.dg-detail-item .dg-detail-dtype{grid-area:"dtype";text-align:left;}.dg-detail-item .dg-detail-unit{grid-area:"unit";text-align:center;}.dg-detail-item .dg-detail-preview{grid-area:"preview";min-width:15em;max-width:100em !important;text-align:left;}.dg-detail-preview .sc-preview span,.dg-detail-shape span{padding:0 !important;}</style><div class='sc-root dg-root'><input class='dg-header-in' id='datagroup-view-6229a11c-9b0c-41ea-9ead-adc5a5cabfed' type='checkbox' checked><div class='sc-header'><label for=datagroup-view-6229a11c-9b0c-41ea-9ead-adc5a5cabfed title='Expand/collapse'><div class='sc-obj-type'>scipp.DataGroup </div><div class='dg-detail-shape'>(frame: 6)</div></label></div><div class='dg-detail-box'><ul class='dg-detail-list'><li class='dg-detail-item'><div><div class='dg-detail-name' style='--depth: 0;'><span>time_correction</span></div><div class='dg-detail-parent'><span style='opacity: 0.5;'>scipp</span></div><div class='dg-detail-objtype'><span>Variable</span></div><div class='dg-detail-shape'>(frame: 6)</div><div class='dg-detail-dtype'><span>float64</span></div><div class='dg-detail-unit'><span>µs</span></div><div class='dg-detail-preview'><span class='sc-preview'>4702.574, 7277.777, ..., 1.408e+04, 1.607e+04</span></div></div></li><li class='dg-detail-item'><div><div class='dg-detail-name' style='--depth: 0;'><span>time_min</span></div><div class='dg-detail-parent'><span style='opacity: 0.5;'>scipp</span></div><div class='dg-detail-objtype'><span>Variable</span></div><div class='dg-detail-shape'>(frame: 6)</div><div class='dg-detail-dtype'><span>float64</span></div><div class='dg-detail-unit'><span>µs</span></div><div class='dg-detail-preview'><span class='sc-preview'>1.804e+04, 4.068e+04, ..., 1.005e+05, 1.180e+05</span></div></div></li><li class='dg-detail-item'><div><div class='dg-detail-name' style='--depth: 0;'><span>delta_time_min</span></div><div class='dg-detail-parent'><span style='opacity: 0.5;'>scipp</span></div><div class='dg-detail-objtype'><span>Variable</span></div><div class='dg-detail-shape'>(frame: 6)</div><div class='dg-detail-dtype'><span>float64</span></div><div class='dg-detail-unit'><span>µs</span></div><div class='dg-detail-preview'><span class='sc-preview'>113.750, 284.797, ..., 736.629, 868.881</span></div></div></li><li class='dg-detail-item'><div><div class='dg-detail-name' style='--depth: 0;'><span>time_max</span></div><div class='dg-detail-parent'><span style='opacity: 0.5;'>scipp</span></div><div class='dg-detail-objtype'><span>Variable</span></div><div class='dg-detail-shape'>(frame: 6)</div><div class='dg-detail-dtype'><span>float64</span></div><div class='dg-detail-unit'><span>µs</span></div><div class='dg-detail-preview'><span class='sc-preview'>3.839e+04, 5.993e+04, ..., 1.168e+05, 1.335e+05</span></div></div></li><li class='dg-detail-item'><div><div class='dg-detail-name' style='--depth: 0;'><span>delta_time_max</span></div><div class='dg-detail-parent'><span style='opacity: 0.5;'>scipp</span></div><div class='dg-detail-objtype'><span>Variable</span></div><div class='dg-detail-shape'>(frame: 6)</div><div class='dg-detail-dtype'><span>float64</span></div><div class='dg-detail-unit'><span>µs</span></div><div class='dg-detail-preview'><span class='sc-preview'>284.797, 445.190, ..., 868.881, 992.895</span></div></div></li><li class='dg-detail-item'><div><div class='dg-detail-name' style='--depth: 0;'><span>wavelength_min</span></div><div class='dg-detail-parent'><span style='opacity: 0.5;'>scipp</span></div><div class='dg-detail-objtype'><span>Variable</span></div><div class='dg-detail-shape'>(frame: 6)</div><div class='dg-detail-dtype'><span>float64</span></div><div class='dg-detail-unit'><span>Å</span></div><div class='dg-detail-preview'><span class='sc-preview'>1.000, 2.504, ..., 6.476, 7.638</span></div></div></li><li class='dg-detail-item'><div><div class='dg-detail-name' style='--depth: 0;'><span>wavelength_max</span></div><div class='dg-detail-parent'><span style='opacity: 0.5;'>scipp</span></div><div class='dg-detail-objtype'><span>Variable</span></div><div class='dg-detail-shape'>(frame: 6)</div><div class='dg-detail-dtype'><span>float64</span></div><div class='dg-detail-unit'><span>Å</span></div><div class='dg-detail-preview'><span class='sc-preview'>2.504, 3.914, ..., 7.638, 8.729</span></div></div></li><li class='dg-detail-item'><div><div class='dg-detail-name' style='--depth: 0;'><span>delta_wavelength_min</span></div><div class='dg-detail-parent'><span style='opacity: 0.5;'>scipp</span></div><div class='dg-detail-objtype'><span>Variable</span></div><div class='dg-detail-shape'>(frame: 6)</div><div class='dg-detail-dtype'><span>float64</span></div><div class='dg-detail-unit'><span>Å</span></div><div class='dg-detail-preview'><span class='sc-preview'>0.008, 0.021, ..., 0.055, 0.065</span></div></div></li><li class='dg-detail-item'><div><div class='dg-detail-name' style='--depth: 0;'><span>delta_wavelength_max</span></div><div class='dg-detail-parent'><span style='opacity: 0.5;'>scipp</span></div><div class='dg-detail-objtype'><span>Variable</span></div><div class='dg-detail-shape'>(frame: 6)</div><div class='dg-detail-dtype'><span>float64</span></div><div class='dg-detail-unit'><span>Å</span></div><div class='dg-detail-preview'><span class='sc-preview'>0.021, 0.033, ..., 0.065, 0.074</span></div></div></li><li class='dg-detail-item'><div><div class='dg-detail-name' style='--depth: 0;'><span>wfm_chopper_mid_point</span></div><div class='dg-detail-parent'><span style='opacity: 0.5;'>scipp</span></div><div class='dg-detail-objtype'><span>Variable</span></div><div class='dg-detail-shape'>()</div><div class='dg-detail-dtype'><span>vector3</span></div><div class='dg-detail-unit'><span>m</span></div><div class='dg-detail-preview'><span class='sc-preview'>[0. 0. 7.]</span></div></div></li></ul></div></div></div></div>
</div>
</section>
<section id="Create-some-neutrons">
<h3>Create some neutrons<a class="headerlink" href="#Create-some-neutrons" title="Permalink to this headline">#</a></h3>
<p>We create 6 neutrons with known wavelengths, one for each frame. We choose the values for the wavelengths based on the limits given in the <code class="docutils literal notranslate"><span class="pre">frames</span></code> information above.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wavelengths</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
    <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">],</span> <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">,</span> <span class="mf">8.25</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;angstrom&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>We assume that all 6 neutrons originated half-way through the source pulse, and we can thus calculate the times at which they hit the detector.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Neutron mass to Planck constant ratio</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">to_unit</span><span class="p">(</span><span class="n">constants</span><span class="o">.</span><span class="n">m_n</span> <span class="o">/</span> <span class="n">constants</span><span class="o">.</span><span class="n">h</span><span class="p">,</span> <span class="s1">&#39;s/m/angstrom&#39;</span><span class="p">)</span>
<span class="c1"># Distance between the detector pixel and the source</span>
<span class="n">dz</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;position&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">coords</span><span class="p">[</span><span class="s1">&#39;source_position&#39;</span><span class="p">])</span>
<span class="c1"># Compute arrival times, in microseconds</span>
<span class="n">arrival_times</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">sc</span><span class="o">.</span><span class="n">to_unit</span><span class="p">(</span><span class="n">alpha</span> <span class="o">*</span> <span class="n">dz</span> <span class="o">*</span> <span class="n">wavelengths</span><span class="p">,</span> <span class="s1">&#39;us&#39;</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">coords</span><span class="p">[</span><span class="s1">&#39;source_pulse_t_0&#39;</span><span class="p">]</span>
    <span class="o">+</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">coords</span><span class="p">[</span><span class="s1">&#39;source_pulse_length&#39;</span><span class="p">])</span>
<span class="p">)</span>
<span class="n">arrival_times</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div><!-- Original source from -->
<!-- https://github.com/jsignell/xarray/blob/1d960933ab252e0f79f7e050e6c9261d55568057/xarray/static/html/icons-svg-inline.html -->
<svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<title>Show/Hide data repr</title>
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<title>Show/Hide attributes</title>
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg><style id="scipp-style-sheet">.sc-root{--sc-background-color0:var(--jp-layout-color0,#fff);--sc-background-color1:var(--jp-layout-color1,#fcfcfc);--sc-background-color2:var(--jp-layout-color2,#efefef);--sc-inverse-background-color0:var(--jp-inverse-layout-color4,#111);--sc-font-color0:var(--jp-content-font-color0,#000);--sc-font-color1:var(--jp-content-font-color1,#555);--sc-font-color2:var(--jp-content-font-color2,#888);--sc-font-color3:var(--jp-content-font-color3,#ccc);--sc-table-data-color:#f6d028;--sc-table-coords-color:#c6e590;--sc-table-masks-color:#c8c8c8;--sc-table-attrs-color:#ff5555;--sc-table-header-font-color:#111111;}.sc-wrap{font-size:14px;min-width:300px;max-width:800px;}.sc-var-attrs .sc-wrap{padding-left:3em;}.sc-header{padding-top:6px;padding-bottom:6px;margin-bottom:4px;border-bottom:solid 1px #ddd;}.sc-header > div,.sc-header > ul{display:inline;margin-top:0;margin-bottom:0;}.sc-obj-type,.sc-array-name{margin-left:2px;margin-right:10px;}.sc-obj-type{color:var(--sc-font-color1);}.sc-underlying-size{color:var(--sc-font-color2);}.sc-sections,.reveal .sc-sections{padding-left:0 !important;display:grid;grid-template-columns:150px auto auto auto 1fr 20px 20px;}.sc-section-item{display:contents;}.sc-section-item input{display:none;}.sc-section-item input:enabled + label{cursor:pointer;color:var(--sc-font-color1);}.sc-section-item input:enabled + label:hover{color:var(--sc-font-color0);}.sc-section-summary{grid-column:1;font-weight:500;}.sc-section-summary > span{display:inline-block;padding-left:0.5em;}.sc-section-summary-in:disabled + label{color:var(--sc-font-color1);}.sc-section-summary-in + label:before{display:inline-block;content:'►';font-size:11px;width:15px;text-align:center;}.sc-section-summary-in:disabled + label:before{color:var(--sc-font-color3);}.sc-section-summary-in:checked + label:before{content:'▼';}.sc-section-summary-in:checked + label > span{display:none;}.sc-section-summary,.sc-section-inline-details{padding-top:4px;padding-bottom:4px;}.sc-section-inline-details{grid-column:2 / 6;}.sc-section-details{display:none;grid-column:1 / -1;margin-bottom:5px;}.sc-section-summary-in:checked ~ .sc-section-details{display:contents;}.sc-array-wrap{grid-column:1 / -1;display:grid;grid-template-columns:20px auto;}.sc-array-wrap > label{grid-column:1;vertical-align:top;}.sc-preview{color:var(--sc-font-color2);}.sc-array-preview,.sc-array-data{padding:0 5px !important;grid-column:2;}.sc-array-data,.sc-array-in:checked ~ .sc-array-preview{display:none;}.sc-array-in:checked ~ .sc-array-data,.sc-array-preview{display:inline-block;}.sc-dim-list{display:inline-block !important;list-style:none;padding:0 !important;margin:0;}.sc-dim-list li{display:inline-block;padding:0;margin:0!important;}.sc-dim-list:before{content:'(';}.sc-dim-list:after{content:')';}.sc-dim-list li:not(:last-child):after{content:',';padding-right:5px;}.sc-dim-list li span,.sc-standalone-var-name > span span,.sc-var-name > span span{padding:0 !important;}.sc-aligned{font-weight:bold;}.sc-var-list,.sc-var-item,.reveal .sc-var-list,.reveal .sc-var-item{display:contents;}.sc-var-item > div,.sc-var-item label,.sc-var-item > .sc-var-name span{background-color:var(--sc-background-color1);margin-bottom:0;}.sc-var-item > .sc-var-name:hover span{padding-right:5px;}.sc-var-list > li:nth-child(odd) > div,.sc-var-list > li:nth-child(odd) > label,.sc-var-list > li:nth-child(odd) > .sc-var-name span{background-color:var(--sc-background-color2);}.sc-var-name{grid-column:1;}.sc-var-dims{grid-column:2;}.sc-var-dtype{grid-column:3;text-align:right;color:var(--sc-font-color2);}.sc-var-unit{grid-column:4;text-align:left;color:var(--sc-font-color1);max-width:50pt;text-overflow:ellipsis;}.sc-value-preview{grid-column:5;}.sc-var-preview-variances{text-align:right;}.sc-sections .sc-section-item .sc-section-summary,.sc-sections .sc-section-item .sc-section-inline-details,.sc-section-item .sc-var-list .sc-var-item > div,.sc-section-item .sc-var-list .sc-var-item > label,.sc-section-details .sc-var-list .sc-var-item > div,.sc-section-details .sc-var-list .sc-var-item > label{margin-top:0;margin-bottom:0;}.sc-var-name,.sc-var-dims,.sc-var-dtype,.sc-var-unit,.sc-preview,.sc-attrs dt{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;padding-right:10px;}.sc-var-name:hover,.sc-var-dims:hover,.sc-var-dtype:hover,.sc-var-unit:hover,.sc-attrs dt:hover{overflow:visible;width:auto;z-index:1;}.sc-var-attrs{display:block;}.sc-var-data,.reveal .sc-var-data{display:none;}.sc-var-attrs,.sc-var-data{background-color:var(--sc-background-color0) !important;padding-bottom:5px !important;}.sc-var-attrs-in:checked ~ .sc-var-attrs{display:none;}.sc-var-data-in:checked ~ .sc-var-data{display:block;}.sc-var-data > table{float:right;}.sc-var-name span,.sc-var-data{padding-left:25px !important;}.sc-var-attrs,.sc-var-data{grid-column:1 / -1;}dl.sc-attrs{padding:0;margin:0;display:grid;grid-template-columns:125px auto;}.sc-attrs dt,dd{padding:0;margin:0;float:left;padding-right:10px;width:auto;}.sc-attrs dt{font-weight:normal;grid-column:1;}.sc-attrs dt:hover span{display:inline-block;padding-right:10px;}.sc-attrs dd{grid-column:2;white-space:pre-wrap;word-break:break-all;}.sc-icon-database,.sc-icon-file-text2{display:inline-block;vertical-align:middle;width:1em;height:1.5em !important;stroke-width:0;stroke:currentColor;fill:currentColor;}label.sc-hide-icon svg{opacity:0;}.sc-standalone-var-name{grid-column:1/3;}.sc-standalone-var-name span{padding-left:25px;padding-right:10px;}.sc-table{border-collapse:collapse;}.sc-title{font-weight:bold;font-size:1.5em;}.sc-subtitle{font-weight:normal;font-style:italic;text-align:left;font-size:1.2em;padding:1px;}.sc-table th,.sc-table td{border:1px solid var(--sc-inverse-background-color0);padding:0 5px 0 5px;}.sc-table th{text-align:center;}.sc-table tr{background-color:var(--sc-background-color1);text-align:right;}.sc-table tr:hover{background-color:var(--sc-background-color2);}.sc-table th.sc-data{background-color:var(--sc-table-data-color);color:var(--sc-table-header-font-color);}.sc-table th.sc-coords{background-color:var(--sc-table-coords-color);color:var(--sc-table-header-font-color);}.sc-table th.sc-masks{background-color:var(--sc-table-masks-color);color:var(--sc-table-header-font-color);}.sc-table th.sc-attrs{background-color:var(--sc-table-attrs-color);color:var(--sc-table-header-font-color);}.sc-table th.sc-subheader{background-color:var(--sc-background-color2);}.sc-table td.sc-padding{background-color:var(--sc-background-color1);border:0 solid var(--sc-background-color1);height:1.2em;}.sc-label{fill:var(--sc-font-color0,#444444);text-anchor:middle;}.sc-name{fill:var(--sc-font-color0,#111111);}.sc-inset-line{stroke:var(--sc-font-color1);stroke-width:0.05;stroke-dasharray:0.2,0.2;}.sc-log-wrap{height:25ex;resize:vertical;overflow-y:scroll;display:flex;flex-direction:column-reverse;border:1px solid;border-color:var(--jp-border-color2);background-color:var(--sc-background-color1);}div.sc-log{line-height:2.5ex;}table.sc-log{table-layout:auto;border-collapse:collapse;}tr.sc-log:nth-child(even){background-color:var(--sc-background-color0);}tr.sc-log > td{vertical-align:top;padding-bottom:0.5ex;}.sc-log-time-stamp{min-width:22ch;font-family:var(--jp-code-font-family);color:var(--sc-font-color2);}.sc-log-level{min-width:10ch;}tr.sc-log-debug td.sc-log-level{color:var(--jp-accent-color1);}tr.sc-log-info td.sc-log-level{color:var(--jp-info-color1);}tr.sc-log-warning td.sc-log-level{color:var(--jp-warn-color1);}tr.sc-log-error td.sc-log-level{font-weight:bold;color:var(--jp-error-color2);}tr.sc-log-critical td.sc-log-level{font-weight:bold;color:var(--sc-background-color0);background-color:var(--jp-error-color1);}.sc-log-message{white-space:pre-wrap;width:100%;}.sc-log-html-payload{white-space:normal;}.sc-log-name{padding-right:0.5em;text-align:right;white-space:pre-wrap;color:var(--sc-font-color3);}</style><div class='sc-wrap sc-root'><div class='sc-header'><div class='sc-obj-type'>scipp.Variable (304 Bytes)</div></div><ul class='sc-sections'><li class='sc-section-item'><ul class='sc-var-list'><li class='sc-var-item'><div class='sc-standalone-var-name'><span>(wavelength: 6)</span></div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>µs</div><div class='sc-value-preview sc-preview'><span><div>2.431e+04, 4.706e+04, ..., 1.077e+05, 1.267e+05</div></span></div><input id='attrs-282be4ef-cc10-409e-9ff8-660ccf7621cb' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-282be4ef-cc10-409e-9ff8-660ccf7621cb' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-17360b5c-780b-42e2-8cac-0e731b408310' class='sc-var-data-in' type='checkbox'><label for='data-17360b5c-780b-42e2-8cac-0e731b408310' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([ 24310.05718489,  47060.11436978,  69810.17155467,  92560.22873956,
       107726.93352949, 126685.3145169 ])</pre></li></ul></li></ul></div></div></div>
</div>
</section>
<section id="Wrap-the-neutron-counts-and-the-beamline-into-a-DataArray">
<h3>Wrap the neutron counts and the beamline into a DataArray<a class="headerlink" href="#Wrap-the-neutron-counts-and-the-beamline-into-a-DataArray" title="Permalink to this headline">#</a></h3>
<p>We make a data array that contains the beamline information and a histogram of the neutrons over the time dimension.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tmin</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">arrival_times</span><span class="p">)</span>
<span class="n">tmax</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">arrival_times</span><span class="p">)</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="p">(</span><span class="n">tmax</span> <span class="o">-</span> <span class="n">tmin</span><span class="p">)</span>
<span class="n">coords</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
    <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="p">(</span><span class="n">tmin</span> <span class="o">-</span> <span class="n">dt</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="p">(</span><span class="n">tmax</span> <span class="o">+</span> <span class="n">dt</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">2001</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">dt</span><span class="o">.</span><span class="n">unit</span>
<span class="p">)</span>
<span class="n">counts</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">arrival_times</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">da</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span>
    <span class="n">coords</span><span class="o">=</span><span class="n">coords</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">sc</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">values</span><span class="o">=</span><span class="n">counts</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;counts&#39;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">da</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div><!-- Original source from -->
<!-- https://github.com/jsignell/xarray/blob/1d960933ab252e0f79f7e050e6c9261d55568057/xarray/static/html/icons-svg-inline.html -->
<svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<title>Show/Hide data repr</title>
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<title>Show/Hide attributes</title>
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg><style id="scipp-style-sheet">.sc-root{--sc-background-color0:var(--jp-layout-color0,#fff);--sc-background-color1:var(--jp-layout-color1,#fcfcfc);--sc-background-color2:var(--jp-layout-color2,#efefef);--sc-inverse-background-color0:var(--jp-inverse-layout-color4,#111);--sc-font-color0:var(--jp-content-font-color0,#000);--sc-font-color1:var(--jp-content-font-color1,#555);--sc-font-color2:var(--jp-content-font-color2,#888);--sc-font-color3:var(--jp-content-font-color3,#ccc);--sc-table-data-color:#f6d028;--sc-table-coords-color:#c6e590;--sc-table-masks-color:#c8c8c8;--sc-table-attrs-color:#ff5555;--sc-table-header-font-color:#111111;}.sc-wrap{font-size:14px;min-width:300px;max-width:800px;}.sc-var-attrs .sc-wrap{padding-left:3em;}.sc-header{padding-top:6px;padding-bottom:6px;margin-bottom:4px;border-bottom:solid 1px #ddd;}.sc-header > div,.sc-header > ul{display:inline;margin-top:0;margin-bottom:0;}.sc-obj-type,.sc-array-name{margin-left:2px;margin-right:10px;}.sc-obj-type{color:var(--sc-font-color1);}.sc-underlying-size{color:var(--sc-font-color2);}.sc-sections,.reveal .sc-sections{padding-left:0 !important;display:grid;grid-template-columns:150px auto auto auto 1fr 20px 20px;}.sc-section-item{display:contents;}.sc-section-item input{display:none;}.sc-section-item input:enabled + label{cursor:pointer;color:var(--sc-font-color1);}.sc-section-item input:enabled + label:hover{color:var(--sc-font-color0);}.sc-section-summary{grid-column:1;font-weight:500;}.sc-section-summary > span{display:inline-block;padding-left:0.5em;}.sc-section-summary-in:disabled + label{color:var(--sc-font-color1);}.sc-section-summary-in + label:before{display:inline-block;content:'►';font-size:11px;width:15px;text-align:center;}.sc-section-summary-in:disabled + label:before{color:var(--sc-font-color3);}.sc-section-summary-in:checked + label:before{content:'▼';}.sc-section-summary-in:checked + label > span{display:none;}.sc-section-summary,.sc-section-inline-details{padding-top:4px;padding-bottom:4px;}.sc-section-inline-details{grid-column:2 / 6;}.sc-section-details{display:none;grid-column:1 / -1;margin-bottom:5px;}.sc-section-summary-in:checked ~ .sc-section-details{display:contents;}.sc-array-wrap{grid-column:1 / -1;display:grid;grid-template-columns:20px auto;}.sc-array-wrap > label{grid-column:1;vertical-align:top;}.sc-preview{color:var(--sc-font-color2);}.sc-array-preview,.sc-array-data{padding:0 5px !important;grid-column:2;}.sc-array-data,.sc-array-in:checked ~ .sc-array-preview{display:none;}.sc-array-in:checked ~ .sc-array-data,.sc-array-preview{display:inline-block;}.sc-dim-list{display:inline-block !important;list-style:none;padding:0 !important;margin:0;}.sc-dim-list li{display:inline-block;padding:0;margin:0!important;}.sc-dim-list:before{content:'(';}.sc-dim-list:after{content:')';}.sc-dim-list li:not(:last-child):after{content:',';padding-right:5px;}.sc-dim-list li span,.sc-standalone-var-name > span span,.sc-var-name > span span{padding:0 !important;}.sc-aligned{font-weight:bold;}.sc-var-list,.sc-var-item,.reveal .sc-var-list,.reveal .sc-var-item{display:contents;}.sc-var-item > div,.sc-var-item label,.sc-var-item > .sc-var-name span{background-color:var(--sc-background-color1);margin-bottom:0;}.sc-var-item > .sc-var-name:hover span{padding-right:5px;}.sc-var-list > li:nth-child(odd) > div,.sc-var-list > li:nth-child(odd) > label,.sc-var-list > li:nth-child(odd) > .sc-var-name span{background-color:var(--sc-background-color2);}.sc-var-name{grid-column:1;}.sc-var-dims{grid-column:2;}.sc-var-dtype{grid-column:3;text-align:right;color:var(--sc-font-color2);}.sc-var-unit{grid-column:4;text-align:left;color:var(--sc-font-color1);max-width:50pt;text-overflow:ellipsis;}.sc-value-preview{grid-column:5;}.sc-var-preview-variances{text-align:right;}.sc-sections .sc-section-item .sc-section-summary,.sc-sections .sc-section-item .sc-section-inline-details,.sc-section-item .sc-var-list .sc-var-item > div,.sc-section-item .sc-var-list .sc-var-item > label,.sc-section-details .sc-var-list .sc-var-item > div,.sc-section-details .sc-var-list .sc-var-item > label{margin-top:0;margin-bottom:0;}.sc-var-name,.sc-var-dims,.sc-var-dtype,.sc-var-unit,.sc-preview,.sc-attrs dt{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;padding-right:10px;}.sc-var-name:hover,.sc-var-dims:hover,.sc-var-dtype:hover,.sc-var-unit:hover,.sc-attrs dt:hover{overflow:visible;width:auto;z-index:1;}.sc-var-attrs{display:block;}.sc-var-data,.reveal .sc-var-data{display:none;}.sc-var-attrs,.sc-var-data{background-color:var(--sc-background-color0) !important;padding-bottom:5px !important;}.sc-var-attrs-in:checked ~ .sc-var-attrs{display:none;}.sc-var-data-in:checked ~ .sc-var-data{display:block;}.sc-var-data > table{float:right;}.sc-var-name span,.sc-var-data{padding-left:25px !important;}.sc-var-attrs,.sc-var-data{grid-column:1 / -1;}dl.sc-attrs{padding:0;margin:0;display:grid;grid-template-columns:125px auto;}.sc-attrs dt,dd{padding:0;margin:0;float:left;padding-right:10px;width:auto;}.sc-attrs dt{font-weight:normal;grid-column:1;}.sc-attrs dt:hover span{display:inline-block;padding-right:10px;}.sc-attrs dd{grid-column:2;white-space:pre-wrap;word-break:break-all;}.sc-icon-database,.sc-icon-file-text2{display:inline-block;vertical-align:middle;width:1em;height:1.5em !important;stroke-width:0;stroke:currentColor;fill:currentColor;}label.sc-hide-icon svg{opacity:0;}.sc-standalone-var-name{grid-column:1/3;}.sc-standalone-var-name span{padding-left:25px;padding-right:10px;}.sc-table{border-collapse:collapse;}.sc-title{font-weight:bold;font-size:1.5em;}.sc-subtitle{font-weight:normal;font-style:italic;text-align:left;font-size:1.2em;padding:1px;}.sc-table th,.sc-table td{border:1px solid var(--sc-inverse-background-color0);padding:0 5px 0 5px;}.sc-table th{text-align:center;}.sc-table tr{background-color:var(--sc-background-color1);text-align:right;}.sc-table tr:hover{background-color:var(--sc-background-color2);}.sc-table th.sc-data{background-color:var(--sc-table-data-color);color:var(--sc-table-header-font-color);}.sc-table th.sc-coords{background-color:var(--sc-table-coords-color);color:var(--sc-table-header-font-color);}.sc-table th.sc-masks{background-color:var(--sc-table-masks-color);color:var(--sc-table-header-font-color);}.sc-table th.sc-attrs{background-color:var(--sc-table-attrs-color);color:var(--sc-table-header-font-color);}.sc-table th.sc-subheader{background-color:var(--sc-background-color2);}.sc-table td.sc-padding{background-color:var(--sc-background-color1);border:0 solid var(--sc-background-color1);height:1.2em;}.sc-label{fill:var(--sc-font-color0,#444444);text-anchor:middle;}.sc-name{fill:var(--sc-font-color0,#111111);}.sc-inset-line{stroke:var(--sc-font-color1);stroke-width:0.05;stroke-dasharray:0.2,0.2;}.sc-log-wrap{height:25ex;resize:vertical;overflow-y:scroll;display:flex;flex-direction:column-reverse;border:1px solid;border-color:var(--jp-border-color2);background-color:var(--sc-background-color1);}div.sc-log{line-height:2.5ex;}table.sc-log{table-layout:auto;border-collapse:collapse;}tr.sc-log:nth-child(even){background-color:var(--sc-background-color0);}tr.sc-log > td{vertical-align:top;padding-bottom:0.5ex;}.sc-log-time-stamp{min-width:22ch;font-family:var(--jp-code-font-family);color:var(--sc-font-color2);}.sc-log-level{min-width:10ch;}tr.sc-log-debug td.sc-log-level{color:var(--jp-accent-color1);}tr.sc-log-info td.sc-log-level{color:var(--jp-info-color1);}tr.sc-log-warning td.sc-log-level{color:var(--jp-warn-color1);}tr.sc-log-error td.sc-log-level{font-weight:bold;color:var(--jp-error-color2);}tr.sc-log-critical td.sc-log-level{font-weight:bold;color:var(--sc-background-color0);background-color:var(--jp-error-color1);}.sc-log-message{white-space:pre-wrap;width:100%;}.sc-log-html-payload{white-space:normal;}.sc-log-name{padding-right:0.5em;text-align:right;white-space:pre-wrap;color:var(--sc-font-color3);}</style><div class='sc-wrap sc-root'><div class='sc-header'><div class='sc-obj-type'>scipp.DataArray (33.98 KB)</div></div><ul class='sc-sections'><li class='sc-section-item'><input id='section-269a7bad-f627-40d0-9bd1-42496d5fa15c' class='sc-section-summary-in' type='checkbox' disabled ><label for='section-269a7bad-f627-40d0-9bd1-42496d5fa15c' class='sc-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='sc-section-inline-details'><ul class='sc-dim-list'><li><span class='sc-has-index'>time</span>: 2000</li></ul></div><div class='sc-section-details'></div></li><li class='sc-section-item'><input id='section-bcac846d-9704-4c38-9ed5-431c9976cba1' class='sc-section-summary-in' type='checkbox'  checked><label for='section-bcac846d-9704-4c38-9ed5-431c9976cba1' class='sc-section-summary' >Coordinates: <span>(7)</span></label><div class='sc-section-inline-details'></div><div class='sc-section-details'><ul class='sc-var-list'><li class='sc-var-item'><div class='sc-var-name'><span class='sc-aligned'>chopper_wfm_1</span></div><div class='sc-var-dims'>()</div><div class='sc-var-dtype'>PyObject</div><div class='sc-var-unit'></div><div class='sc-value-preview sc-preview'><span><div>DataGroup(sizes={&#x27;frame&#x27;: 6}, keys=[&#x27;frequency&#x27;, &#x27;position&#x27;, &#x27;phase&#x27;, &#x27;cutout...</div></span></div><input id='attrs-55ce93a1-2230-46ab-b504-d4003c6f1de9' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-55ce93a1-2230-46ab-b504-d4003c6f1de9' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-9577ca81-f0c2-47a3-80cc-1989cf2a9088' class='sc-var-data-in' type='checkbox'><label for='data-9577ca81-f0c2-47a3-80cc-1989cf2a9088' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>DataGroup(sizes={&#x27;frame&#x27;: 6}, keys=[
    frequency: Variable({}),
    position: Variable({}),
    phase: Variable({}),
    cutout_angles_center: Variable({&#x27;frame&#x27;: 6}),
    cutout_angles_width: Variable({&#x27;frame&#x27;: 6}),
    kind: Variable({}),
])</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span class='sc-aligned'>chopper_wfm_2</span></div><div class='sc-var-dims'>()</div><div class='sc-var-dtype'>PyObject</div><div class='sc-var-unit'></div><div class='sc-value-preview sc-preview'><span><div>DataGroup(sizes={&#x27;frame&#x27;: 6}, keys=[&#x27;frequency&#x27;, &#x27;position&#x27;, &#x27;phase&#x27;, &#x27;cutout...</div></span></div><input id='attrs-2ff29f0e-d4e6-4004-9f4b-c8dcf5ae9355' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-2ff29f0e-d4e6-4004-9f4b-c8dcf5ae9355' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-b06b8794-33b1-4400-90e1-1461f8330ba7' class='sc-var-data-in' type='checkbox'><label for='data-b06b8794-33b1-4400-90e1-1461f8330ba7' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>DataGroup(sizes={&#x27;frame&#x27;: 6}, keys=[
    frequency: Variable({}),
    position: Variable({}),
    phase: Variable({}),
    cutout_angles_center: Variable({&#x27;frame&#x27;: 6}),
    cutout_angles_width: Variable({&#x27;frame&#x27;: 6}),
    kind: Variable({}),
])</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span class='sc-aligned'>position</span></div><div class='sc-var-dims'>()</div><div class='sc-var-dtype'>vector3</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>[ 0.  0. 60.]</div></span></div><input id='attrs-24b111fb-e3e0-4965-85ef-1d7477971dd7' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-24b111fb-e3e0-4965-85ef-1d7477971dd7' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-b07252f8-bd2e-4ae4-9486-0cb6ae007eae' class='sc-var-data-in' type='checkbox'><label for='data-b07252f8-bd2e-4ae4-9486-0cb6ae007eae' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([ 0.,  0., 60.])</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span class='sc-aligned'>source_position</span></div><div class='sc-var-dims'>()</div><div class='sc-var-dtype'>vector3</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>[0. 0. 0.]</div></span></div><input id='attrs-afaf30e1-6df4-44e0-8c41-8200d32c7b43' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-afaf30e1-6df4-44e0-8c41-8200d32c7b43' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-f021806b-5a64-48de-97a0-abbe52ccd2b9' class='sc-var-data-in' type='checkbox'><label for='data-f021806b-5a64-48de-97a0-abbe52ccd2b9' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([0., 0., 0.])</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span class='sc-aligned'>source_pulse_length</span></div><div class='sc-var-dims'>()</div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>µs</div><div class='sc-value-preview sc-preview'><span><div>2860.0</div></span></div><input id='attrs-dc504fda-b51a-40d1-bb0a-115dd79ee627' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-dc504fda-b51a-40d1-bb0a-115dd79ee627' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-f106ec3e-0821-42ac-b208-30db57c9e3ea' class='sc-var-data-in' type='checkbox'><label for='data-f106ec3e-0821-42ac-b208-30db57c9e3ea' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array(2860.)</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span class='sc-aligned'>source_pulse_t_0</span></div><div class='sc-var-dims'>()</div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>µs</div><div class='sc-value-preview sc-preview'><span><div>130.0</div></span></div><input id='attrs-091e5818-594d-4d74-a05f-1cadf11a3945' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-091e5818-594d-4d74-a05f-1cadf11a3945' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-e97ed000-d4f9-43d4-a405-e2a247706daa' class='sc-var-data-in' type='checkbox'><label for='data-e97ed000-d4f9-43d4-a405-e2a247706daa' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array(130.)</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span class='sc-aligned'>time</span></div><div class='sc-var-dims'>(time [bin-edge])</div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>µs</div><div class='sc-value-preview sc-preview'><span><div>1.407e+04, 1.413e+04, ..., 1.369e+05, 1.369e+05</div></span></div><input id='attrs-f20bd35f-a67c-4602-b2b8-0e9c95616981' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-f20bd35f-a67c-4602-b2b8-0e9c95616981' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-64ff688d-28e9-4690-8dd6-a1d4f9a9dfbf' class='sc-var-data-in' type='checkbox'><label for='data-64ff688d-28e9-4690-8dd6-a1d4f9a9dfbf' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([ 14072.53145169,  14133.95660609,  14195.38176049, ...,
       136799.9899413 , 136861.4150957 , 136922.8402501 ])</pre></span></li></ul></div></li><li class='sc-section-item'><input id='section-6d6b3afe-d884-4ee4-87c6-b8be15f1ec2e' class='sc-section-summary-in' type='checkbox'  checked><label for='section-6d6b3afe-d884-4ee4-87c6-b8be15f1ec2e' class='sc-section-summary' >Data: <span>(1)</span></label><div class='sc-section-inline-details'></div><div class='sc-section-details'><ul class='sc-var-list'><li class='sc-var-item'><div class='sc-var-name'><span></span></div><div class='sc-var-dims'>(time)</div><div class='sc-var-dtype'>int64</div><div class='sc-var-unit'>counts</div><div class='sc-value-preview sc-preview'><span><div>0, 0, ..., 0, 0</div></span></div><input id='attrs-2a5389da-5885-4270-b02b-5a05aa389e28' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-2a5389da-5885-4270-b02b-5a05aa389e28' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-95e6d758-14dd-4b7a-b82d-cc54b03f69c6' class='sc-var-data-in' type='checkbox'><label for='data-95e6d758-14dd-4b7a-b82d-cc54b03f69c6' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([0, 0, 0, ..., 0, 0, 0])</pre></li></ul></div></li></ul></div></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">da</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/techniques_wfm_introduction-to-wfm_27_0.svg" src="../../_images/techniques_wfm_introduction-to-wfm_27_0.svg" /></div>
</div>
</section>
<section id="Stitch-the-frames">
<h3>Stitch the frames<a class="headerlink" href="#Stitch-the-frames" title="Permalink to this headline">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">time</span></code> coordinate in our data represents the time between the source <span class="math notranslate nohighlight">\(t_{0}\)</span> and the time when the neutron hits the detector. However, the WFM choppers are now acting as the new source choppers. This means that the neutron time-of-flight, which will be used to compute the neutron wavelengths, is now defined as the time between when the neutron crossed the WFM choppers and when it hit the detector (see Fig. 5).</p>
<p>Because we only know the time at which the neutron arrived at the detector, not when it left the source, the most sensible value to use as time the neutron passed through the WFM choppers is the mid-point (in time) between the WFM chopper openings, in each frame. This is represented by <span class="math notranslate nohighlight">\(t_{\rm WFM}(N)\)</span> in Fig. 5.</p>
<p>By using the start and end detector arrival time for each frame contained in the <code class="docutils literal notranslate"><span class="pre">frames</span></code> Dataset, we extract all the neutrons in a given frame <span class="math notranslate nohighlight">\(N\)</span> and subtract <span class="math notranslate nohighlight">\(t_{\rm WFM}(N)\)</span> (also found in <code class="docutils literal notranslate"><span class="pre">frames</span></code>) from the time coordinate in that frame.</p>
<p>Finally, we then merge (or rebin) the neutrons from all the frames onto a common time-of-flight axis.</p>
<p>All this is performed in a single operation using the <code class="docutils literal notranslate"><span class="pre">wfm.stitch</span></code> function:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stitched</span> <span class="o">=</span> <span class="n">wfm</span><span class="o">.</span><span class="n">stitch</span><span class="p">(</span><span class="n">frames</span><span class="o">=</span><span class="n">frames</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">da</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">2001</span><span class="p">)</span>
<span class="n">stitched</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/techniques_wfm_introduction-to-wfm_29_0.svg" src="../../_images/techniques_wfm_introduction-to-wfm_29_0.svg" /></div>
</div>
<p>The resulting coordinate is now time-of-flight (<code class="docutils literal notranslate"><span class="pre">tof</span></code>), and we can use <code class="docutils literal notranslate"><span class="pre">scippneutron</span></code> to convert the time-of-flight to wavelength.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scippneutron.conversion.graph</span> <span class="kn">import</span> <span class="n">beamline</span><span class="p">,</span> <span class="n">tof</span>

<span class="n">graph</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">beamline</span><span class="o">.</span><span class="n">beamline</span><span class="p">(</span><span class="n">scatter</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span> <span class="o">**</span><span class="n">tof</span><span class="o">.</span><span class="n">elastic</span><span class="p">(</span><span class="s2">&quot;tof&quot;</span><span class="p">)}</span>
<span class="n">wav</span> <span class="o">=</span> <span class="n">stitched</span><span class="o">.</span><span class="n">transform_coords</span><span class="p">(</span><span class="s2">&quot;wavelength&quot;</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="n">graph</span><span class="p">)</span>
<span class="n">wav</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div><!-- Original source from -->
<!-- https://github.com/jsignell/xarray/blob/1d960933ab252e0f79f7e050e6c9261d55568057/xarray/static/html/icons-svg-inline.html -->
<svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<title>Show/Hide data repr</title>
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<title>Show/Hide attributes</title>
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg><style id="scipp-style-sheet">.sc-root{--sc-background-color0:var(--jp-layout-color0,#fff);--sc-background-color1:var(--jp-layout-color1,#fcfcfc);--sc-background-color2:var(--jp-layout-color2,#efefef);--sc-inverse-background-color0:var(--jp-inverse-layout-color4,#111);--sc-font-color0:var(--jp-content-font-color0,#000);--sc-font-color1:var(--jp-content-font-color1,#555);--sc-font-color2:var(--jp-content-font-color2,#888);--sc-font-color3:var(--jp-content-font-color3,#ccc);--sc-table-data-color:#f6d028;--sc-table-coords-color:#c6e590;--sc-table-masks-color:#c8c8c8;--sc-table-attrs-color:#ff5555;--sc-table-header-font-color:#111111;}.sc-wrap{font-size:14px;min-width:300px;max-width:800px;}.sc-var-attrs .sc-wrap{padding-left:3em;}.sc-header{padding-top:6px;padding-bottom:6px;margin-bottom:4px;border-bottom:solid 1px #ddd;}.sc-header > div,.sc-header > ul{display:inline;margin-top:0;margin-bottom:0;}.sc-obj-type,.sc-array-name{margin-left:2px;margin-right:10px;}.sc-obj-type{color:var(--sc-font-color1);}.sc-underlying-size{color:var(--sc-font-color2);}.sc-sections,.reveal .sc-sections{padding-left:0 !important;display:grid;grid-template-columns:150px auto auto auto 1fr 20px 20px;}.sc-section-item{display:contents;}.sc-section-item input{display:none;}.sc-section-item input:enabled + label{cursor:pointer;color:var(--sc-font-color1);}.sc-section-item input:enabled + label:hover{color:var(--sc-font-color0);}.sc-section-summary{grid-column:1;font-weight:500;}.sc-section-summary > span{display:inline-block;padding-left:0.5em;}.sc-section-summary-in:disabled + label{color:var(--sc-font-color1);}.sc-section-summary-in + label:before{display:inline-block;content:'►';font-size:11px;width:15px;text-align:center;}.sc-section-summary-in:disabled + label:before{color:var(--sc-font-color3);}.sc-section-summary-in:checked + label:before{content:'▼';}.sc-section-summary-in:checked + label > span{display:none;}.sc-section-summary,.sc-section-inline-details{padding-top:4px;padding-bottom:4px;}.sc-section-inline-details{grid-column:2 / 6;}.sc-section-details{display:none;grid-column:1 / -1;margin-bottom:5px;}.sc-section-summary-in:checked ~ .sc-section-details{display:contents;}.sc-array-wrap{grid-column:1 / -1;display:grid;grid-template-columns:20px auto;}.sc-array-wrap > label{grid-column:1;vertical-align:top;}.sc-preview{color:var(--sc-font-color2);}.sc-array-preview,.sc-array-data{padding:0 5px !important;grid-column:2;}.sc-array-data,.sc-array-in:checked ~ .sc-array-preview{display:none;}.sc-array-in:checked ~ .sc-array-data,.sc-array-preview{display:inline-block;}.sc-dim-list{display:inline-block !important;list-style:none;padding:0 !important;margin:0;}.sc-dim-list li{display:inline-block;padding:0;margin:0!important;}.sc-dim-list:before{content:'(';}.sc-dim-list:after{content:')';}.sc-dim-list li:not(:last-child):after{content:',';padding-right:5px;}.sc-dim-list li span,.sc-standalone-var-name > span span,.sc-var-name > span span{padding:0 !important;}.sc-aligned{font-weight:bold;}.sc-var-list,.sc-var-item,.reveal .sc-var-list,.reveal .sc-var-item{display:contents;}.sc-var-item > div,.sc-var-item label,.sc-var-item > .sc-var-name span{background-color:var(--sc-background-color1);margin-bottom:0;}.sc-var-item > .sc-var-name:hover span{padding-right:5px;}.sc-var-list > li:nth-child(odd) > div,.sc-var-list > li:nth-child(odd) > label,.sc-var-list > li:nth-child(odd) > .sc-var-name span{background-color:var(--sc-background-color2);}.sc-var-name{grid-column:1;}.sc-var-dims{grid-column:2;}.sc-var-dtype{grid-column:3;text-align:right;color:var(--sc-font-color2);}.sc-var-unit{grid-column:4;text-align:left;color:var(--sc-font-color1);max-width:50pt;text-overflow:ellipsis;}.sc-value-preview{grid-column:5;}.sc-var-preview-variances{text-align:right;}.sc-sections .sc-section-item .sc-section-summary,.sc-sections .sc-section-item .sc-section-inline-details,.sc-section-item .sc-var-list .sc-var-item > div,.sc-section-item .sc-var-list .sc-var-item > label,.sc-section-details .sc-var-list .sc-var-item > div,.sc-section-details .sc-var-list .sc-var-item > label{margin-top:0;margin-bottom:0;}.sc-var-name,.sc-var-dims,.sc-var-dtype,.sc-var-unit,.sc-preview,.sc-attrs dt{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;padding-right:10px;}.sc-var-name:hover,.sc-var-dims:hover,.sc-var-dtype:hover,.sc-var-unit:hover,.sc-attrs dt:hover{overflow:visible;width:auto;z-index:1;}.sc-var-attrs{display:block;}.sc-var-data,.reveal .sc-var-data{display:none;}.sc-var-attrs,.sc-var-data{background-color:var(--sc-background-color0) !important;padding-bottom:5px !important;}.sc-var-attrs-in:checked ~ .sc-var-attrs{display:none;}.sc-var-data-in:checked ~ .sc-var-data{display:block;}.sc-var-data > table{float:right;}.sc-var-name span,.sc-var-data{padding-left:25px !important;}.sc-var-attrs,.sc-var-data{grid-column:1 / -1;}dl.sc-attrs{padding:0;margin:0;display:grid;grid-template-columns:125px auto;}.sc-attrs dt,dd{padding:0;margin:0;float:left;padding-right:10px;width:auto;}.sc-attrs dt{font-weight:normal;grid-column:1;}.sc-attrs dt:hover span{display:inline-block;padding-right:10px;}.sc-attrs dd{grid-column:2;white-space:pre-wrap;word-break:break-all;}.sc-icon-database,.sc-icon-file-text2{display:inline-block;vertical-align:middle;width:1em;height:1.5em !important;stroke-width:0;stroke:currentColor;fill:currentColor;}label.sc-hide-icon svg{opacity:0;}.sc-standalone-var-name{grid-column:1/3;}.sc-standalone-var-name span{padding-left:25px;padding-right:10px;}.sc-table{border-collapse:collapse;}.sc-title{font-weight:bold;font-size:1.5em;}.sc-subtitle{font-weight:normal;font-style:italic;text-align:left;font-size:1.2em;padding:1px;}.sc-table th,.sc-table td{border:1px solid var(--sc-inverse-background-color0);padding:0 5px 0 5px;}.sc-table th{text-align:center;}.sc-table tr{background-color:var(--sc-background-color1);text-align:right;}.sc-table tr:hover{background-color:var(--sc-background-color2);}.sc-table th.sc-data{background-color:var(--sc-table-data-color);color:var(--sc-table-header-font-color);}.sc-table th.sc-coords{background-color:var(--sc-table-coords-color);color:var(--sc-table-header-font-color);}.sc-table th.sc-masks{background-color:var(--sc-table-masks-color);color:var(--sc-table-header-font-color);}.sc-table th.sc-attrs{background-color:var(--sc-table-attrs-color);color:var(--sc-table-header-font-color);}.sc-table th.sc-subheader{background-color:var(--sc-background-color2);}.sc-table td.sc-padding{background-color:var(--sc-background-color1);border:0 solid var(--sc-background-color1);height:1.2em;}.sc-label{fill:var(--sc-font-color0,#444444);text-anchor:middle;}.sc-name{fill:var(--sc-font-color0,#111111);}.sc-inset-line{stroke:var(--sc-font-color1);stroke-width:0.05;stroke-dasharray:0.2,0.2;}.sc-log-wrap{height:25ex;resize:vertical;overflow-y:scroll;display:flex;flex-direction:column-reverse;border:1px solid;border-color:var(--jp-border-color2);background-color:var(--sc-background-color1);}div.sc-log{line-height:2.5ex;}table.sc-log{table-layout:auto;border-collapse:collapse;}tr.sc-log:nth-child(even){background-color:var(--sc-background-color0);}tr.sc-log > td{vertical-align:top;padding-bottom:0.5ex;}.sc-log-time-stamp{min-width:22ch;font-family:var(--jp-code-font-family);color:var(--sc-font-color2);}.sc-log-level{min-width:10ch;}tr.sc-log-debug td.sc-log-level{color:var(--jp-accent-color1);}tr.sc-log-info td.sc-log-level{color:var(--jp-info-color1);}tr.sc-log-warning td.sc-log-level{color:var(--jp-warn-color1);}tr.sc-log-error td.sc-log-level{font-weight:bold;color:var(--jp-error-color2);}tr.sc-log-critical td.sc-log-level{font-weight:bold;color:var(--sc-background-color0);background-color:var(--jp-error-color1);}.sc-log-message{white-space:pre-wrap;width:100%;}.sc-log-html-payload{white-space:normal;}.sc-log-name{padding-right:0.5em;text-align:right;white-space:pre-wrap;color:var(--sc-font-color3);}</style><div class='sc-wrap sc-root'><div class='sc-header'><div class='sc-obj-type'>scipp.DataArray (50.15 KB)</div></div><ul class='sc-sections'><li class='sc-section-item'><input id='section-c562a736-1aae-4a62-9fc8-9937999b1d45' class='sc-section-summary-in' type='checkbox' disabled ><label for='section-c562a736-1aae-4a62-9fc8-9937999b1d45' class='sc-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='sc-section-inline-details'><ul class='sc-dim-list'><li><span class='sc-has-index'>wavelength</span>: 2001</li></ul></div><div class='sc-section-details'></div></li><li class='sc-section-item'><input id='section-28377e2e-6a51-4826-b9cd-75ac80d7da5d' class='sc-section-summary-in' type='checkbox'  checked><label for='section-28377e2e-6a51-4826-b9cd-75ac80d7da5d' class='sc-section-summary' >Coordinates: <span>(9)</span></label><div class='sc-section-inline-details'></div><div class='sc-section-details'><ul class='sc-var-list'><li class='sc-var-item'><div class='sc-var-name'><span>Ltotal</span></div><div class='sc-var-dims'>()</div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>53.0</div></span></div><input id='attrs-4bc049e6-3d8d-44e5-ac19-157cbc247448' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-4bc049e6-3d8d-44e5-ac19-157cbc247448' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-bd1c5d82-c1e3-4dbe-96da-ab2ce78cf804' class='sc-var-data-in' type='checkbox'><label for='data-bd1c5d82-c1e3-4dbe-96da-ab2ce78cf804' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array(53.)</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span class='sc-aligned'>chopper_wfm_1</span></div><div class='sc-var-dims'>()</div><div class='sc-var-dtype'>PyObject</div><div class='sc-var-unit'></div><div class='sc-value-preview sc-preview'><span><div>DataGroup(sizes={&#x27;frame&#x27;: 6}, keys=[&#x27;frequency&#x27;, &#x27;position&#x27;, &#x27;phase&#x27;, &#x27;cutout...</div></span></div><input id='attrs-857559aa-4417-4faf-881d-c7ab1792d405' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-857559aa-4417-4faf-881d-c7ab1792d405' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-a713ad2a-cbc3-42eb-b2a3-296c60abe3ba' class='sc-var-data-in' type='checkbox'><label for='data-a713ad2a-cbc3-42eb-b2a3-296c60abe3ba' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>DataGroup(sizes={&#x27;frame&#x27;: 6}, keys=[
    frequency: Variable({}),
    position: Variable({}),
    phase: Variable({}),
    cutout_angles_center: Variable({&#x27;frame&#x27;: 6}),
    cutout_angles_width: Variable({&#x27;frame&#x27;: 6}),
    kind: Variable({}),
])</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span class='sc-aligned'>chopper_wfm_2</span></div><div class='sc-var-dims'>()</div><div class='sc-var-dtype'>PyObject</div><div class='sc-var-unit'></div><div class='sc-value-preview sc-preview'><span><div>DataGroup(sizes={&#x27;frame&#x27;: 6}, keys=[&#x27;frequency&#x27;, &#x27;position&#x27;, &#x27;phase&#x27;, &#x27;cutout...</div></span></div><input id='attrs-4f38fcca-cbc1-4522-bad8-36adae8022c5' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-4f38fcca-cbc1-4522-bad8-36adae8022c5' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-fc0200b9-ca07-4f0d-ac5c-dd20282b5b95' class='sc-var-data-in' type='checkbox'><label for='data-fc0200b9-ca07-4f0d-ac5c-dd20282b5b95' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>DataGroup(sizes={&#x27;frame&#x27;: 6}, keys=[
    frequency: Variable({}),
    position: Variable({}),
    phase: Variable({}),
    cutout_angles_center: Variable({&#x27;frame&#x27;: 6}),
    cutout_angles_width: Variable({&#x27;frame&#x27;: 6}),
    kind: Variable({}),
])</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span>position</span></div><div class='sc-var-dims'>()</div><div class='sc-var-dtype'>vector3</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>[ 0.  0. 60.]</div></span></div><input id='attrs-8dea37bc-b820-439e-b48d-bcd454485e71' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-8dea37bc-b820-439e-b48d-bcd454485e71' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-2cd30b8b-bd99-4fbd-ac1a-a5a687f05061' class='sc-var-data-in' type='checkbox'><label for='data-2cd30b8b-bd99-4fbd-ac1a-a5a687f05061' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([ 0.,  0., 60.])</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span>source_position</span></div><div class='sc-var-dims'>()</div><div class='sc-var-dtype'>vector3</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>[0. 0. 7.]</div></span></div><input id='attrs-1ad1b59e-ae7d-48d1-a3b0-e30acd2ceeb6' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-1ad1b59e-ae7d-48d1-a3b0-e30acd2ceeb6' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-3d557944-e1cb-4234-8ec1-9e9420c65842' class='sc-var-data-in' type='checkbox'><label for='data-3d557944-e1cb-4234-8ec1-9e9420c65842' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([0., 0., 7.])</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span class='sc-aligned'>source_pulse_length</span></div><div class='sc-var-dims'>()</div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>µs</div><div class='sc-value-preview sc-preview'><span><div>2860.0</div></span></div><input id='attrs-072dc284-20be-46bb-8290-dbd2ae611f98' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-072dc284-20be-46bb-8290-dbd2ae611f98' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-8b4aa027-9e97-47c2-8092-8e98e4e25b62' class='sc-var-data-in' type='checkbox'><label for='data-8b4aa027-9e97-47c2-8092-8e98e4e25b62' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array(2860.)</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span class='sc-aligned'>source_pulse_t_0</span></div><div class='sc-var-dims'>()</div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>µs</div><div class='sc-value-preview sc-preview'><span><div>130.0</div></span></div><input id='attrs-9e1341e4-2d3d-4757-a881-726a48b64f80' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-9e1341e4-2d3d-4757-a881-726a48b64f80' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-23c01ef7-9532-4e02-8c79-057d28231e7a' class='sc-var-data-in' type='checkbox'><label for='data-23c01ef7-9532-4e02-8c79-057d28231e7a' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array(130.)</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span>tof</span></div><div class='sc-var-dims'>(wavelength [bin-edge])</div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>µs</div><div class='sc-value-preview sc-preview'><span><div>1.334e+04, 1.339e+04, ..., 1.174e+05, 1.174e+05</div></span></div><input id='attrs-129568f0-24dc-4e1c-ada0-220fa816e1cb' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-129568f0-24dc-4e1c-ada0-220fa816e1cb' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-016c341c-7946-4cce-985f-439b58e654e3' class='sc-var-data-in' type='checkbox'><label for='data-016c341c-7946-4cce-985f-439b58e654e3' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([ 13340.38075481,  13392.40326751,  13444.42578022, ...,
       117333.38365677, 117385.40616948, 117437.42868218])</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span class='sc-aligned'>wavelength</span></div><div class='sc-var-dims'>(wavelength [bin-edge])</div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>Å</div><div class='sc-value-preview sc-preview'><span><div>0.996, 1.000, ..., 8.762, 8.766</div></span></div><input id='attrs-a9cbf211-b1a8-4c87-add4-b35011115c91' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-a9cbf211-b1a8-4c87-add4-b35011115c91' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-34b55f1f-06c8-481f-a996-7b86ac128665' class='sc-var-data-in' type='checkbox'><label for='data-34b55f1f-06c8-481f-a996-7b86ac128665' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([0.99575472, 0.99963779, 1.00352086, ..., 8.75801616, 8.76189923,
       8.7657823 ])</pre></span></li></ul></div></li><li class='sc-section-item'><input id='section-4fdb6df9-d033-490c-a67f-d689d8e1cae2' class='sc-section-summary-in' type='checkbox'  checked><label for='section-4fdb6df9-d033-490c-a67f-d689d8e1cae2' class='sc-section-summary' >Data: <span>(1)</span></label><div class='sc-section-inline-details'></div><div class='sc-section-details'><ul class='sc-var-list'><li class='sc-var-item'><div class='sc-var-name'><span></span></div><div class='sc-var-dims'>(wavelength)</div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>counts</div><div class='sc-value-preview sc-preview'><span><div>0.0, 0.0, ..., 0.0, 0.0</div></span></div><input id='attrs-118c6346-eedf-47cb-9555-e9cb58fb6595' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-118c6346-eedf-47cb-9555-e9cb58fb6595' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-b46dfcdf-976d-43c4-80ba-c836762fdb87' class='sc-var-data-in' type='checkbox'><label for='data-b46dfcdf-976d-43c4-80ba-c836762fdb87' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([0., 0., 0., ..., 0., 0., 0.])</pre></li></ul></div></li></ul></div></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wav</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/techniques_wfm_introduction-to-wfm_32_0.svg" src="../../_images/techniques_wfm_introduction-to-wfm_32_0.svg" /></div>
</div>
<p>Zooming in on the first spike, we notice that something is not quite right: the original wavelength was 1.5 Å but on the figure below is closer to 1.46 Å.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wav</span><span class="p">[</span><span class="s2">&quot;wavelength&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mf">1.2</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">angstrom</span><span class="p">)</span> <span class="p">:</span> <span class="p">(</span><span class="mf">1.7</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">angstrom</span><span class="p">)]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/techniques_wfm_introduction-to-wfm_34_0.svg" src="../../_images/techniques_wfm_introduction-to-wfm_34_0.svg" /></div>
</div>
<p>Now the WFM method guarantees a constant <span class="math notranslate nohighlight">\(\Delta\lambda / \lambda\)</span>, and so it is not surprising to see the final reduced wavelength not exactly matching the original. The question is: is the error within <span class="math notranslate nohighlight">\(\Delta\lambda / \lambda\)</span>?</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Distance between WFM choppers</span>
<span class="n">dz_wfm</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s2">&quot;chopper_wfm_2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s2">&quot;position&quot;</span><span class="p">]</span>
    <span class="o">-</span> <span class="n">ds</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s2">&quot;chopper_wfm_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s2">&quot;position&quot;</span><span class="p">]</span>
<span class="p">)</span>
<span class="c1"># Delta_lambda  / lambda</span>
<span class="n">dlambda_over_lambda</span> <span class="o">=</span> <span class="n">dz_wfm</span> <span class="o">/</span> <span class="n">sc</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span>
    <span class="n">coords</span><span class="p">[</span><span class="s1">&#39;position&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">frames</span><span class="p">[</span><span class="s1">&#39;wfm_chopper_mid_point&#39;</span><span class="p">]</span>
<span class="p">)</span>
<span class="p">(</span><span class="mf">1.5</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">angstrom</span><span class="p">)</span> <span class="o">*</span> <span class="n">dlambda_over_lambda</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div><!-- Original source from -->
<!-- https://github.com/jsignell/xarray/blob/1d960933ab252e0f79f7e050e6c9261d55568057/xarray/static/html/icons-svg-inline.html -->
<svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<title>Show/Hide data repr</title>
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<title>Show/Hide attributes</title>
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg><style id="scipp-style-sheet">.sc-root{--sc-background-color0:var(--jp-layout-color0,#fff);--sc-background-color1:var(--jp-layout-color1,#fcfcfc);--sc-background-color2:var(--jp-layout-color2,#efefef);--sc-inverse-background-color0:var(--jp-inverse-layout-color4,#111);--sc-font-color0:var(--jp-content-font-color0,#000);--sc-font-color1:var(--jp-content-font-color1,#555);--sc-font-color2:var(--jp-content-font-color2,#888);--sc-font-color3:var(--jp-content-font-color3,#ccc);--sc-table-data-color:#f6d028;--sc-table-coords-color:#c6e590;--sc-table-masks-color:#c8c8c8;--sc-table-attrs-color:#ff5555;--sc-table-header-font-color:#111111;}.sc-wrap{font-size:14px;min-width:300px;max-width:800px;}.sc-var-attrs .sc-wrap{padding-left:3em;}.sc-header{padding-top:6px;padding-bottom:6px;margin-bottom:4px;border-bottom:solid 1px #ddd;}.sc-header > div,.sc-header > ul{display:inline;margin-top:0;margin-bottom:0;}.sc-obj-type,.sc-array-name{margin-left:2px;margin-right:10px;}.sc-obj-type{color:var(--sc-font-color1);}.sc-underlying-size{color:var(--sc-font-color2);}.sc-sections,.reveal .sc-sections{padding-left:0 !important;display:grid;grid-template-columns:150px auto auto auto 1fr 20px 20px;}.sc-section-item{display:contents;}.sc-section-item input{display:none;}.sc-section-item input:enabled + label{cursor:pointer;color:var(--sc-font-color1);}.sc-section-item input:enabled + label:hover{color:var(--sc-font-color0);}.sc-section-summary{grid-column:1;font-weight:500;}.sc-section-summary > span{display:inline-block;padding-left:0.5em;}.sc-section-summary-in:disabled + label{color:var(--sc-font-color1);}.sc-section-summary-in + label:before{display:inline-block;content:'►';font-size:11px;width:15px;text-align:center;}.sc-section-summary-in:disabled + label:before{color:var(--sc-font-color3);}.sc-section-summary-in:checked + label:before{content:'▼';}.sc-section-summary-in:checked + label > span{display:none;}.sc-section-summary,.sc-section-inline-details{padding-top:4px;padding-bottom:4px;}.sc-section-inline-details{grid-column:2 / 6;}.sc-section-details{display:none;grid-column:1 / -1;margin-bottom:5px;}.sc-section-summary-in:checked ~ .sc-section-details{display:contents;}.sc-array-wrap{grid-column:1 / -1;display:grid;grid-template-columns:20px auto;}.sc-array-wrap > label{grid-column:1;vertical-align:top;}.sc-preview{color:var(--sc-font-color2);}.sc-array-preview,.sc-array-data{padding:0 5px !important;grid-column:2;}.sc-array-data,.sc-array-in:checked ~ .sc-array-preview{display:none;}.sc-array-in:checked ~ .sc-array-data,.sc-array-preview{display:inline-block;}.sc-dim-list{display:inline-block !important;list-style:none;padding:0 !important;margin:0;}.sc-dim-list li{display:inline-block;padding:0;margin:0!important;}.sc-dim-list:before{content:'(';}.sc-dim-list:after{content:')';}.sc-dim-list li:not(:last-child):after{content:',';padding-right:5px;}.sc-dim-list li span,.sc-standalone-var-name > span span,.sc-var-name > span span{padding:0 !important;}.sc-aligned{font-weight:bold;}.sc-var-list,.sc-var-item,.reveal .sc-var-list,.reveal .sc-var-item{display:contents;}.sc-var-item > div,.sc-var-item label,.sc-var-item > .sc-var-name span{background-color:var(--sc-background-color1);margin-bottom:0;}.sc-var-item > .sc-var-name:hover span{padding-right:5px;}.sc-var-list > li:nth-child(odd) > div,.sc-var-list > li:nth-child(odd) > label,.sc-var-list > li:nth-child(odd) > .sc-var-name span{background-color:var(--sc-background-color2);}.sc-var-name{grid-column:1;}.sc-var-dims{grid-column:2;}.sc-var-dtype{grid-column:3;text-align:right;color:var(--sc-font-color2);}.sc-var-unit{grid-column:4;text-align:left;color:var(--sc-font-color1);max-width:50pt;text-overflow:ellipsis;}.sc-value-preview{grid-column:5;}.sc-var-preview-variances{text-align:right;}.sc-sections .sc-section-item .sc-section-summary,.sc-sections .sc-section-item .sc-section-inline-details,.sc-section-item .sc-var-list .sc-var-item > div,.sc-section-item .sc-var-list .sc-var-item > label,.sc-section-details .sc-var-list .sc-var-item > div,.sc-section-details .sc-var-list .sc-var-item > label{margin-top:0;margin-bottom:0;}.sc-var-name,.sc-var-dims,.sc-var-dtype,.sc-var-unit,.sc-preview,.sc-attrs dt{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;padding-right:10px;}.sc-var-name:hover,.sc-var-dims:hover,.sc-var-dtype:hover,.sc-var-unit:hover,.sc-attrs dt:hover{overflow:visible;width:auto;z-index:1;}.sc-var-attrs{display:block;}.sc-var-data,.reveal .sc-var-data{display:none;}.sc-var-attrs,.sc-var-data{background-color:var(--sc-background-color0) !important;padding-bottom:5px !important;}.sc-var-attrs-in:checked ~ .sc-var-attrs{display:none;}.sc-var-data-in:checked ~ .sc-var-data{display:block;}.sc-var-data > table{float:right;}.sc-var-name span,.sc-var-data{padding-left:25px !important;}.sc-var-attrs,.sc-var-data{grid-column:1 / -1;}dl.sc-attrs{padding:0;margin:0;display:grid;grid-template-columns:125px auto;}.sc-attrs dt,dd{padding:0;margin:0;float:left;padding-right:10px;width:auto;}.sc-attrs dt{font-weight:normal;grid-column:1;}.sc-attrs dt:hover span{display:inline-block;padding-right:10px;}.sc-attrs dd{grid-column:2;white-space:pre-wrap;word-break:break-all;}.sc-icon-database,.sc-icon-file-text2{display:inline-block;vertical-align:middle;width:1em;height:1.5em !important;stroke-width:0;stroke:currentColor;fill:currentColor;}label.sc-hide-icon svg{opacity:0;}.sc-standalone-var-name{grid-column:1/3;}.sc-standalone-var-name span{padding-left:25px;padding-right:10px;}.sc-table{border-collapse:collapse;}.sc-title{font-weight:bold;font-size:1.5em;}.sc-subtitle{font-weight:normal;font-style:italic;text-align:left;font-size:1.2em;padding:1px;}.sc-table th,.sc-table td{border:1px solid var(--sc-inverse-background-color0);padding:0 5px 0 5px;}.sc-table th{text-align:center;}.sc-table tr{background-color:var(--sc-background-color1);text-align:right;}.sc-table tr:hover{background-color:var(--sc-background-color2);}.sc-table th.sc-data{background-color:var(--sc-table-data-color);color:var(--sc-table-header-font-color);}.sc-table th.sc-coords{background-color:var(--sc-table-coords-color);color:var(--sc-table-header-font-color);}.sc-table th.sc-masks{background-color:var(--sc-table-masks-color);color:var(--sc-table-header-font-color);}.sc-table th.sc-attrs{background-color:var(--sc-table-attrs-color);color:var(--sc-table-header-font-color);}.sc-table th.sc-subheader{background-color:var(--sc-background-color2);}.sc-table td.sc-padding{background-color:var(--sc-background-color1);border:0 solid var(--sc-background-color1);height:1.2em;}.sc-label{fill:var(--sc-font-color0,#444444);text-anchor:middle;}.sc-name{fill:var(--sc-font-color0,#111111);}.sc-inset-line{stroke:var(--sc-font-color1);stroke-width:0.05;stroke-dasharray:0.2,0.2;}.sc-log-wrap{height:25ex;resize:vertical;overflow-y:scroll;display:flex;flex-direction:column-reverse;border:1px solid;border-color:var(--jp-border-color2);background-color:var(--sc-background-color1);}div.sc-log{line-height:2.5ex;}table.sc-log{table-layout:auto;border-collapse:collapse;}tr.sc-log:nth-child(even){background-color:var(--sc-background-color0);}tr.sc-log > td{vertical-align:top;padding-bottom:0.5ex;}.sc-log-time-stamp{min-width:22ch;font-family:var(--jp-code-font-family);color:var(--sc-font-color2);}.sc-log-level{min-width:10ch;}tr.sc-log-debug td.sc-log-level{color:var(--jp-accent-color1);}tr.sc-log-info td.sc-log-level{color:var(--jp-info-color1);}tr.sc-log-warning td.sc-log-level{color:var(--jp-warn-color1);}tr.sc-log-error td.sc-log-level{font-weight:bold;color:var(--jp-error-color2);}tr.sc-log-critical td.sc-log-level{font-weight:bold;color:var(--sc-background-color0);background-color:var(--jp-error-color1);}.sc-log-message{white-space:pre-wrap;width:100%;}.sc-log-html-payload{white-space:normal;}.sc-log-name{padding-right:0.5em;text-align:right;white-space:pre-wrap;color:var(--sc-font-color3);}</style><div class='sc-wrap sc-root'><div class='sc-header'><div class='sc-obj-type'>scipp.Variable (264 Bytes)</div></div><ul class='sc-sections'><li class='sc-section-item'><ul class='sc-var-list'><li class='sc-var-item'><div class='sc-standalone-var-name'><span>()</span></div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>Å</div><div class='sc-value-preview sc-preview'><span><div>0.012735849056603753</div></span></div><input id='attrs-0f1b5c6e-2d41-49a4-b2f0-792f9d616c43' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-0f1b5c6e-2d41-49a4-b2f0-792f9d616c43' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-64d0e323-850f-41af-845c-ce85f442e4db' class='sc-var-data-in' type='checkbox'><label for='data-64d0e323-850f-41af-845c-ce85f442e4db' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array(0.01273585)</pre></li></ul></li></ul></div></div></div>
</div>
<p>At 1.5 Å, the resolution is 0.0127 Å, which is smaller than the offset we observe above. In fact, we can perform a quick check using Scipp’s label-based slicing, to verify that the sum of the counts in a region <span class="math notranslate nohighlight">\(\Delta\lambda\)</span> wide around the original wavelength should be equal to 1:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">)):</span>
    <span class="n">lam</span> <span class="o">=</span> <span class="n">wavelengths</span><span class="p">[</span><span class="s2">&quot;wavelength&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span>
    <span class="n">half_dlam</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">dlambda_over_lambda</span> <span class="o">*</span> <span class="n">lam</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="s2">&quot;Lambda:&quot;</span><span class="p">,</span>
        <span class="n">lam</span><span class="p">,</span>
        <span class="s2">&quot;, count in range:&quot;</span><span class="p">,</span>
        <span class="n">sc</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">wav</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">,</span> <span class="n">lam</span> <span class="o">-</span> <span class="n">half_dlam</span> <span class="p">:</span> <span class="n">lam</span> <span class="o">+</span> <span class="n">half_dlam</span><span class="p">])</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Lambda: &lt;scipp.Variable&gt; ()    float64             [Å]  1.5 , count in range: 0.0
Lambda: &lt;scipp.Variable&gt; ()    float64             [Å]  3 , count in range: 0.0
Lambda: &lt;scipp.Variable&gt; ()    float64             [Å]  4.5 , count in range: 1.0
Lambda: &lt;scipp.Variable&gt; ()    float64             [Å]  6 , count in range: 1.0
Lambda: &lt;scipp.Variable&gt; ()    float64             [Å]  7 , count in range: 1.0
Lambda: &lt;scipp.Variable&gt; ()    float64             [Å]  8.25 , count in range: 1.0
</pre></div></div>
</div>
<p>This reveals that the reduced wavelengths for the first two neutrons do not agree within the required precision. We go back to our time-distance diagram and look at the paths taken by our 6 neutrons (plotted in red).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig6</span> <span class="o">=</span> <span class="n">wfm</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">time_distance_diagram</span><span class="p">(</span><span class="n">da</span><span class="p">)</span>
<span class="n">ax6</span> <span class="o">=</span> <span class="n">fig6</span><span class="o">.</span><span class="n">get_axes</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">)):</span>
    <span class="n">ax6</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;source_pulse_t_0&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">coords</span><span class="p">[</span><span class="s1">&#39;source_pulse_length&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="n">arrival_times</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">sc</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;position&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">value</span><span class="p">],</span>
        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/techniques_wfm_introduction-to-wfm_40_0.png" src="../../_images/techniques_wfm_introduction-to-wfm_40_0.png" />
</div>
</div>
<p>Taking a closer look at the WFM choppers, we observe that the numbers we picked for the first two neutrons actually lead to unphysical paths: they do not make it through the chopper openings!</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">ax6</span><span class="o">.</span><span class="n">texts</span><span class="p">[</span><span class="mi">3</span><span class="p">:]:</span>
    <span class="n">t</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
<span class="n">ax6</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0e3</span><span class="p">,</span> <span class="mf">2.0e4</span><span class="p">)</span>
<span class="n">ax6</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">)</span>
<span class="n">fig6</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span>
<span class="n">fig6</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/techniques_wfm_introduction-to-wfm_42_0.png" src="../../_images/techniques_wfm_introduction-to-wfm_42_0.png" />
</div>
</div>
<p>So we modify our values so that neutrons 1 and 2 make it through:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wavelengths</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
    <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">],</span> <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="mf">1.75</span><span class="p">,</span> <span class="mf">3.2</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">,</span> <span class="mf">8.25</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;angstrom&#39;</span>
<span class="p">)</span>
<span class="n">arrival_times</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">sc</span><span class="o">.</span><span class="n">to_unit</span><span class="p">(</span><span class="n">alpha</span> <span class="o">*</span> <span class="n">dz</span> <span class="o">*</span> <span class="n">wavelengths</span><span class="p">,</span> <span class="s1">&#39;us&#39;</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">coords</span><span class="p">[</span><span class="s1">&#39;source_pulse_t_0&#39;</span><span class="p">]</span>
    <span class="o">+</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">coords</span><span class="p">[</span><span class="s1">&#39;source_pulse_length&#39;</span><span class="p">])</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig7</span> <span class="o">=</span> <span class="n">wfm</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">time_distance_diagram</span><span class="p">(</span><span class="n">da</span><span class="p">)</span>
<span class="n">ax7</span> <span class="o">=</span> <span class="n">fig7</span><span class="o">.</span><span class="n">get_axes</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">)):</span>
    <span class="n">ax7</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;source_pulse_t_0&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">coords</span><span class="p">[</span><span class="s1">&#39;source_pulse_length&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="n">arrival_times</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">sc</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;position&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">value</span><span class="p">],</span>
        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span>
    <span class="p">)</span>
<span class="n">ax7</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0e3</span><span class="p">,</span> <span class="mf">2.0e4</span><span class="p">)</span>
<span class="n">ax7</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">)</span>
<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">ax7</span><span class="o">.</span><span class="n">texts</span><span class="p">[</span><span class="mi">3</span><span class="p">:]:</span>
    <span class="n">t</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/techniques_wfm_introduction-to-wfm_45_0.png" src="../../_images/techniques_wfm_introduction-to-wfm_45_0.png" />
</div>
</div>
<p>And repeat the stitching process:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tmin</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">arrival_times</span><span class="p">)</span>
<span class="n">tmax</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">arrival_times</span><span class="p">)</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="p">(</span><span class="n">tmax</span> <span class="o">-</span> <span class="n">tmin</span><span class="p">)</span>
<span class="n">coords</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
    <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="p">(</span><span class="n">tmin</span> <span class="o">-</span> <span class="n">dt</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="p">(</span><span class="n">tmax</span> <span class="o">+</span> <span class="n">dt</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">2001</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">dt</span><span class="o">.</span><span class="n">unit</span>
<span class="p">)</span>
<span class="n">counts</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">arrival_times</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">da</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span>
    <span class="n">coords</span><span class="o">=</span><span class="n">coords</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">sc</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">values</span><span class="o">=</span><span class="n">counts</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;counts&#39;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">stitched</span> <span class="o">=</span> <span class="n">wfm</span><span class="o">.</span><span class="n">stitch</span><span class="p">(</span><span class="n">frames</span><span class="o">=</span><span class="n">frames</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">da</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">2001</span><span class="p">)</span>
<span class="n">wav</span> <span class="o">=</span> <span class="n">stitched</span><span class="o">.</span><span class="n">transform_coords</span><span class="p">(</span><span class="s2">&quot;wavelength&quot;</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="n">graph</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wav</span><span class="p">[</span><span class="s2">&quot;wavelength&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mf">1.55</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">angstrom</span><span class="p">)</span> <span class="p">:</span> <span class="p">(</span><span class="mf">1.95</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">angstrom</span><span class="p">)]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/techniques_wfm_introduction-to-wfm_48_0.svg" src="../../_images/techniques_wfm_introduction-to-wfm_48_0.svg" /></div>
</div>
<p>This time, the peak is much closer to 1.75 Å, and we can make sure the sum within the <span class="math notranslate nohighlight">\(\Delta\lambda\)</span> range is 1 for all 6 neutrons:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">)):</span>
    <span class="n">lam</span> <span class="o">=</span> <span class="n">wavelengths</span><span class="p">[</span><span class="s2">&quot;wavelength&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span>
    <span class="n">half_dlam</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">dlambda_over_lambda</span> <span class="o">*</span> <span class="n">lam</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="s2">&quot;Lambda:&quot;</span><span class="p">,</span>
        <span class="n">lam</span><span class="p">,</span>
        <span class="s2">&quot;, count in range:&quot;</span><span class="p">,</span>
        <span class="n">sc</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">wav</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">,</span> <span class="n">lam</span> <span class="o">-</span> <span class="n">half_dlam</span> <span class="p">:</span> <span class="n">lam</span> <span class="o">+</span> <span class="n">half_dlam</span><span class="p">])</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Lambda: &lt;scipp.Variable&gt; ()    float64             [Å]  1.75 , count in range: 1.0
Lambda: &lt;scipp.Variable&gt; ()    float64             [Å]  3.2 , count in range: 1.0
Lambda: &lt;scipp.Variable&gt; ()    float64             [Å]  4.5 , count in range: 1.0
Lambda: &lt;scipp.Variable&gt; ()    float64             [Å]  6 , count in range: 1.0
Lambda: &lt;scipp.Variable&gt; ()    float64             [Å]  7 , count in range: 1.0
Lambda: &lt;scipp.Variable&gt; ()    float64             [Å]  8.25 , count in range: 1.0
</pre></div></div>
</div>
</section>
</section>
<section id="References">
<h2>References<a class="headerlink" href="#References" title="Permalink to this headline">#</a></h2>
<div id="schmakat2020"></div><p>Schmakat P., Seifert M., Schulz M., Tartaglione A., Lerche M., Morgano M., Böni P., Strobl M., <strong>2020</strong>, <em>Wavelength frame multiplication chopper system for the multi-purpose neutron-imaging instrument ODIN at the European Spallation Source</em>, <a class="reference external" href="https://doi.org/10.1016/j.nima.2020.164467">Nuclear Instruments and Methods in Physics Research Section A: Accelerators, Spectrometers, Detectors and Associated Equipment, 979, 164467</a></p>
</section>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="wfm.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Wavelength frame multiplication</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="reducing-wfm-data.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Reducing WFM data</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Scipp contributors<br/>
  
      &copy; Copyright 2023 Scipp contributors.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>