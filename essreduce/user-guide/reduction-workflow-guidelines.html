
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Reduction Workflow Guidelines &#8212; ESSreduce</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/autodoc_pydantic.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=d3717ebb"></script>
    <script src="../_static/doctools.js?v=fd6eb6e6"></script>
    <script src="../_static/sphinx_highlight.js?v=6ffebe34"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'user-guide/reduction-workflow-guidelines';</script>
    <script src="../_static/anaconda-icon.js?v=461bdc62"></script>
    <link rel="icon" href="../_static/favicon.svg"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="API Reference" href="../api-reference/index.html" />
    <link rel="prev" title="Workflow Widget in Jupyter Notebook" href="widget.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="0.1.dev1610+gc2e452b13" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.svg" class="logo__image only-light" alt="ESSreduce - Home"/>
    <img src="../_static/logo-dark.svg" class="logo__image only-dark pst-js-only" alt="ESSreduce - Home"/>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../api-reference/index.html">
    API Reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../developer/index.html">
    Development
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../about/index.html">
    About
  </a>
</li>

            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button"
                data-bs-toggle="dropdown" aria-expanded="false"
                aria-controls="pst-nav-more-links">
                    More
                </button>
                <ul id="pst-nav-more-links" class="dropdown-menu">
                    
<li class=" ">
  <a class="nav-link dropdown-item nav-external" href="https://scipp.github.io/essdiffraction">
    ESSdiffraction
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-external" href="https://scipp.github.io/essimaging">
    ESSimaging
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-external" href="https://scipp.github.io/essnmx">
    ESSnmx
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-external" href="https://scipp.github.io/esspolarization">
    ESSpolarization
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-external" href="https://scipp.github.io/essreflectometry">
    ESSreflectometry
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-external" href="https://scipp.github.io/esssans">
    ESSsans
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-external" href="https://scipp.github.io/essspectroscopy">
    ESSspectroscopy
  </a>
</li>

                </ul>
            </li>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/scipp/essreduce" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/essreduce/" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-python fa-lg" aria-hidden="true"></i>
            <span class="sr-only">PyPI</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://anaconda.org/conda-forge/essreduce" title="Conda" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-custom fa-anaconda fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Conda</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
    </div>
  

  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../api-reference/index.html">
    API Reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../developer/index.html">
    Development
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../about/index.html">
    About
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://scipp.github.io/essdiffraction">
    ESSdiffraction
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://scipp.github.io/essimaging">
    ESSimaging
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://scipp.github.io/essnmx">
    ESSnmx
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://scipp.github.io/esspolarization">
    ESSpolarization
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://scipp.github.io/essreflectometry">
    ESSreflectometry
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://scipp.github.io/esssans">
    ESSsans
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://scipp.github.io/essspectroscopy">
    ESSspectroscopy
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/scipp/essreduce" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/essreduce/" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-python fa-lg" aria-hidden="true"></i>
            <span class="sr-only">PyPI</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://anaconda.org/conda-forge/essreduce" title="Conda" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-custom fa-anaconda fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Conda</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="tof/index.html">Time-of-flight</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="tof/frame-unwrapping.html">Frame Unwrapping</a></li>
<li class="toctree-l2"><a class="reference internal" href="tof/wfm.html">Wavelength frame multiplication</a></li>
<li class="toctree-l2"><a class="reference internal" href="tof/dream.html">The DREAM chopper cascade</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="widget.html">Workflow Widget in Jupyter Notebook</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Reduction Workflow Guidelines</a></li>
</ul>
</div>
</nav></div>
        <div class="sidebar-primary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#about">About</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#to-be-included-in-future-version">To be included in future version</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#nomenclature">Nomenclature</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#c-convention">C: Convention</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#c-1-use-common-names-and-types">C.1: Use common names and types</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#c-2-use-common-names-for-generics">C.2: Use common names for generics</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#c-3-removed-rule-on-naming-typevars">C.3: (Removed rule on naming TypeVars)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#c-4-use-flexible-types">C.4: Use flexible types</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#c-5-use-a-fixed-pattern-for-creating-manipulating-and-running-workflows">C.5: Use a fixed pattern for creating, manipulating, and running workflows</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#c-6-domain-types-for-data-products">C.6: Domain types for data products</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#d-documentation">D: Documentation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#d-1-document-math-and-references-in-docstrings">D.1: Document math and references in docstrings</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#p-performance">P: Performance</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#p-1-runtime-and-memory-use-of-workflows-shall-be-tested-with-large-data">P.1: Runtime and memory use of workflows shall be tested with large data</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#s-structure">S: Structure</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#s-1-workflows-shall-be-able-to-return-final-results-as-event-data">S.1: Workflows shall be able to return final results as event data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#s-2-load-each-required-nxmonitor-separately">S.2: Load each required NXmonitor separately</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#s-3-load-each-required-nxdetector-separately">S.3: Load each required NXdetector separately</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#s-4-load-auxiliary-data-and-metadata-separately-from-monitors-and-detectors">S.4: Load auxiliary data and metadata separately from monitors and detectors</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#s-5-avoid-dependencies-of-output-metadata-on-large-data">S.5: Avoid dependencies of output metadata on large data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#s-6-preserve-floating-point-precision-of-input-data-and-coordinates">S.6: Preserve floating-point precision of input data and coordinates</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#s-7-switches-to-double-precision-shall-be-deliberate-explicit-and-documented">S.7: Switches to double-precision shall be deliberate, explicit, and documented</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#s-8-propagation-of-uncertainties-in-broadcast-operations-should-support-drop-and-upper-bound-strategies-upper-bound-shall-be-the-default">S.8: Propagation of uncertainties in broadcast operations should support “drop” and “upper-bound” strategies, “upper-bound” shall be the default</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#s-9-do-not-write-files-or-make-write-requests-to-services-such-as-scicat-in-providers">S.9: Do not write files or make write requests to services such as SciCat in providers</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#s-10-detector-banks-shall-be-loaded-with-their-logical-dimensions-if-possible">S.10: Detector banks shall be loaded with their logical dimensions, if possible</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#t-testing">T: Testing</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#t-1-adherence-to-the-guidelines-shall-be-tested-and-the-guideline-id-shall-be-referenced-in-the-test-name">T.1: Adherence to the guidelines shall be tested, and the guideline ID shall be referenced in the test name</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#t-2-write-unit-tests-for-providers">T.2: Write unit tests for providers</a></li>
</ul>
</li>
</ul>
  </nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/user-guide/reduction-workflow-guidelines.md"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">User Guide</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Reduction Workflow Guidelines</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="reduction-workflow-guidelines">
<h1>Reduction Workflow Guidelines<a class="headerlink" href="#reduction-workflow-guidelines" title="Link to this heading">#</a></h1>
<section id="about">
<h2>About<a class="headerlink" href="#about" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Version: 1</p></li>
<li><p>Last update: 2024-05</p></li>
</ul>
</section>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">#</a></h2>
<p>This document contains guidelines for writing reduction workflows for ESS based on Scipp and Sciline.
The guidelines are intended to ensure that the workflows are consistent (both for developers and users, across instruments and techniques), maintainable, and efficient.</p>
</section>
<section id="to-be-included-in-future-version">
<h2>To be included in future version<a class="headerlink" href="#to-be-included-in-future-version" title="Link to this heading">#</a></h2>
<p>We plan to include the following in future versions of the guidelines:</p>
<ul class="simple">
<li><p>Package and module structure:</p>
<ul>
<li><p>Where to place types?
What goes where?</p></li>
</ul>
</li>
<li><p>Loading from SciCat vs. local files</p>
<ul>
<li><p>Example: Define run ID, choose provider that either converts to local path, or uses service to get file and return path</p></li>
</ul>
</li>
<li><p>Should we have default params set in workflows?</p>
<ul>
<li><p>Avoid unless good reason.</p></li>
<li><p>Can have widgets that generate dict of params and values, widgets can have defaults</p></li>
</ul>
</li>
<li><p>How to define parameters, such that we can, e.g., auto generate widgets for user input (names, description, limits, default values, …)</p>
<ul>
<li><p>Range checks / validators</p></li>
<li><p>If part of pipeline then UX and writing providers is more cumbersome</p></li>
<li><p>Default values?</p></li>
</ul>
</li>
<li><p>Requires experimentation with how Sciline handles param tables, and transformations of task graphs:</p>
<ul>
<li><p>Multiple banks, multiple files, chunking (file-based + stream-based)</p></li>
<li><p>How to handle optional steps</p></li>
<li><p>Structure for masking any dim or transformed dim, in various steps</p>
<ul>
<li><p>Could be handled as a task-graph transform?</p></li>
</ul>
</li>
</ul>
</li>
<li><p>How to handle optional inputs?</p>
<ul>
<li><p>Can we find a way to minimize the occasions where we need this?</p></li>
<li><p>Can we avoid mutually exclusive parameters?</p></li>
</ul>
</li>
</ul>
</section>
<section id="nomenclature">
<h2>Nomenclature<a class="headerlink" href="#nomenclature" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><em>Provider</em>: A callable step in a workflow writing with Sciline.</p></li>
</ul>
</section>
<section id="c-convention">
<h2>C: Convention<a class="headerlink" href="#c-convention" title="Link to this heading">#</a></h2>
<section id="c-1-use-common-names-and-types">
<h3>C.1: Use common names and types<a class="headerlink" href="#c-1-use-common-names-and-types" title="Link to this heading">#</a></h3>
<p><strong>Reason</strong>
Helps with sticking to established practices and working across packages.</p>
<p><strong>Table</strong>
Names use glob syntax, i.e., ‘*Filename’ is any string that ends in ‘Filename’.</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>— <strong>Files</strong> —</p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p>Filename | *Filename</p></td>
<td><p>str</p></td>
<td><p>Name or path to a file</p></td>
</tr>
<tr class="row-even"><td><p>— <strong>Flags</strong> —</p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p>UncertaintyBroadcastMode</p></td>
<td><p>enum</p></td>
<td><p>E.g., <code class="docutils literal notranslate"><span class="pre">Enum('UncertaintyBroadcastMode',</span> <span class="pre">['drop',</span> <span class="pre">'upper_bound',</span> <span class="pre">'fail'])</span></code></p></td>
</tr>
<tr class="row-even"><td><p>ReturnEvents</p></td>
<td><p>bool</p></td>
<td><p>Select whether to return events or histograms from the workflow</p></td>
</tr>
<tr class="row-odd"><td><p>CorrectForGravity</p></td>
<td><p>bool</p></td>
<td><p>Toggle gravity correction</p></td>
</tr>
<tr class="row-even"><td><p>— <strong>Misc</strong> —</p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p>NeXus*</p></td>
<td><p>Any</p></td>
<td><p>Spelling of all NeXus-related keys</p></td>
</tr>
<tr class="row-even"><td><p>WavelengthBins | *Bins</p></td>
<td><p>sc.Variable</p></td>
<td><p>Bin-edges</p></td>
</tr>
<tr class="row-odd"><td><p>RunTitle</p></td>
<td><p>str</p></td>
<td><p>Extracted from NeXus or provided by user, can be used to find files</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="c-2-use-common-names-for-generics">
<h3>C.2: Use common names for generics<a class="headerlink" href="#c-2-use-common-names-for-generics" title="Link to this heading">#</a></h3>
<p><strong>Reason</strong>
Helps with sticking to established practices and working across packages.</p>
<p><strong>Note</strong>
If a workflow uses generics to parametrize its types, e.g., <code class="docutils literal notranslate"><span class="pre">Filename</span></code>,
it should define new types used as tags and type vars constrained to those tags.</p>
<p><strong>Table</strong></p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>— <strong>Run IDs</strong> —</p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p>SampleRun, BackgroundRun, …</p></td>
<td><p>Any</p></td>
<td><p>Identifier for a run, only used as a type tag</p></td>
</tr>
<tr class="row-even"><td><p>RunType</p></td>
<td><p>TypeVar</p></td>
<td><p>Constrained to the run types used by the package, see above</p></td>
</tr>
<tr class="row-odd"><td><p>— <strong>Monitors</strong> —</p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p>IncidentMonitor, TransmissionMonitor, …</p></td>
<td><p>Any</p></td>
<td><p>Identifier for a monitor, only used as a type tag</p></td>
</tr>
<tr class="row-odd"><td><p>MonitorType</p></td>
<td><p>TypeVar</p></td>
<td><p>Constrained to the monitor types used by the package, see above</p></td>
</tr>
</tbody>
</table>
</div>
<p><strong>Example</strong>
The choice of using <code class="docutils literal notranslate"><span class="pre">int</span></code> is arbitrary.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">SampleRun</span> <span class="o">=</span> <span class="n">NewType</span><span class="p">(</span><span class="s1">&#39;SampleRun&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
<span class="n">BackgroundRun</span> <span class="o">=</span> <span class="n">NewType</span><span class="p">(</span><span class="s1">&#39;BackgroundRun&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
<span class="n">RunType</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;RunType&#39;</span><span class="p">,</span> <span class="n">SampleRun</span><span class="p">,</span> <span class="n">BackgroundRun</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Filename</span><span class="p">(</span><span class="n">sciline</span><span class="o">.</span><span class="n">Scope</span><span class="p">[</span><span class="n">RunType</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span> <span class="o">...</span>
</pre></div>
</div>
</section>
<section id="c-3-removed-rule-on-naming-typevars">
<h3>C.3: (Removed rule on naming TypeVars)<a class="headerlink" href="#c-3-removed-rule-on-naming-typevars" title="Link to this heading">#</a></h3>
<p>This guideline was too restrictive as not all TypeVars represent a “type”, conceptually.
Instead, authors should apply good judgment when naming TypeVars.</p>
</section>
<section id="c-4-use-flexible-types">
<h3>C.4: Use flexible types<a class="headerlink" href="#c-4-use-flexible-types" title="Link to this heading">#</a></h3>
<p><strong>Reason</strong>
Users should not have to worry about the concrete type of parameters.</p>
<p><strong>Example</strong></p>
<ul>
<li><p>Numbers should use the appropriate abstract type from <a class="reference external" href="https://docs.python.org/3/library/numbers.html#module-numbers" title="(in Python v3.14)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">numbers</span></code></a>.
E.g.,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">P</span> <span class="o">=</span> <span class="n">NewType</span><span class="p">(</span><span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Real</span><span class="p">)</span>
<span class="n">pipeline</span><span class="p">[</span><span class="n">P</span><span class="p">]</span> <span class="o">=</span> <span class="mf">3.0</span>  <span class="c1"># works</span>
<span class="n">pipeline</span><span class="p">[</span><span class="n">P</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>    <span class="c1"># works, too, but not if `P` were `float`</span>
</pre></div>
</div>
</li>
<li><p>Use <a class="reference external" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Sequence" title="(in Python v3.14)"><code class="xref py py-class docutils literal notranslate"><span class="pre">collections.abc.Sequence</span></code></a> instead of <code class="docutils literal notranslate"><span class="pre">list</span></code> or <code class="docutils literal notranslate"><span class="pre">tuple</span></code>.</p>
<ul class="simple">
<li><p>But do <em>not</em> use <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Iterable" title="(in Python v3.14)"><code class="xref py py-class docutils literal notranslate"><span class="pre">typing.Iterable</span></code></a>!
Parameters may be consumed multiple times and iterables are not guaranteed to support that.</p></li>
</ul>
</li>
<li><p>Gracefully promote dtypes for small parameters.
E.g., <code class="docutils literal notranslate"><span class="pre">sc.scalar(2,</span> <span class="pre">unit='m')</span></code> and <code class="docutils literal notranslate"><span class="pre">sc.scalar(2.0,</span> <span class="pre">unit='m')</span></code> should be usable interchangeably.
This can also apply to arrays, for instance, <code class="docutils literal notranslate"><span class="pre">sc.linspace</span></code> and <code class="docutils literal notranslate"><span class="pre">sc.arange</span></code> should be interchangeable but the latter may result in integers while the former typically produces floats.</p></li>
</ul>
</section>
<section id="c-5-use-a-fixed-pattern-for-creating-manipulating-and-running-workflows">
<h3>C.5: Use a fixed pattern for creating, manipulating, and running workflows<a class="headerlink" href="#c-5-use-a-fixed-pattern-for-creating-manipulating-and-running-workflows" title="Link to this heading">#</a></h3>
<p><strong>Reason</strong></p>
<ul class="simple">
<li><p>Using terms such as provider or pipeline increases cognitive load for scientific users.
The reason is that those terms are unfamiliar to users based on the scientific domain language they are used to.</p></li>
<li><p>Manipulating multiple concepts such as (1) a dict of parameters, (2) a <code class="docutils literal notranslate"><span class="pre">sciline.Pipeline</span></code>, and (3) a <code class="docutils literal notranslate"><span class="pre">sciline.TaskGraph</span></code> is confusing, especially for non-programmers.</p></li>
</ul>
<p><strong>Notes</strong></p>
<ul class="simple">
<li><p>Add one or more <code class="docutils literal notranslate"><span class="pre">*Workflow</span></code> function(s) that returns a <code class="docutils literal notranslate"><span class="pre">sciline.Pipeline</span></code> object, configured with default providers and parameters.</p>
<ul>
<li><p>Prefix with the instrument name and suffix with <code class="docutils literal notranslate"><span class="pre">Workflow</span></code>, qualifiers can be added in between, for example <code class="docutils literal notranslate"><span class="pre">LokiWorkflow</span></code> and <code class="docutils literal notranslate"><span class="pre">LokiAtLarmorWorkflow</span></code>.</p></li>
<li><p>Despite being a function we choose camel-case naming, to minimize future refactoring in user code if we decide to wrap/inherit <code class="docutils literal notranslate"><span class="pre">Pipeline</span></code> instead of returning an instance.
Furthermore, non-expert Python users will be more familiar with classes than with factory functions.</p></li>
</ul>
</li>
<li><p>Avoid creating parameter dicts in notebooks, set parameters on the workflow object directly.</p></li>
<li><p>Avoid calling <code class="docutils literal notranslate"><span class="pre">workflow.get</span></code> (which would return a <code class="docutils literal notranslate"><span class="pre">sciline.TaskGraph</span></code>), instead call <code class="docutils literal notranslate"><span class="pre">workflow.compute</span></code> and <code class="docutils literal notranslate"><span class="pre">workflow.visualize</span></code>, even if it means listing the result and building the task graph multiple times.</p></li>
</ul>
<p><strong>Example</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">ess</span><span class="w"> </span><span class="kn">import</span> <span class="n">loki</span>

<span class="n">workflow</span> <span class="o">=</span> <span class="n">loki</span><span class="o">.</span><span class="n">LokiWorkflow</span><span class="p">()</span>
<span class="n">workflow</span><span class="p">[</span><span class="n">Param1</span><span class="p">]</span> <span class="o">=</span> <span class="n">param1</span>
<span class="n">workflow</span><span class="p">[</span><span class="n">Param2</span><span class="p">]</span> <span class="o">=</span> <span class="n">param2</span>
<span class="n">workflow</span><span class="o">.</span><span class="n">visualize</span><span class="p">(</span><span class="n">Result</span><span class="p">)</span>
<span class="n">workflow</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">Result</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="c-6-domain-types-for-data-products">
<h3>C.6: Domain types for data products<a class="headerlink" href="#c-6-domain-types-for-data-products" title="Link to this heading">#</a></h3>
<p>Data types that flow through the reduction workflow should follow a systematic naming convention that reflects their processing stage and coordinate space. This ensures consistency across instruments and techniques, making workflows more transferable and easier to understand.</p>
<p><strong>Type structure</strong></p>
<p>Domain types use a <strong>prefix-suffix</strong> pattern:</p>
<ul class="simple">
<li><p><strong>Prefix</strong>: Describes the processing stage (e.g., <code class="docutils literal notranslate"><span class="pre">Raw</span></code>, <code class="docutils literal notranslate"><span class="pre">Tof</span></code>, <code class="docutils literal notranslate"><span class="pre">Corrected</span></code>, <code class="docutils literal notranslate"><span class="pre">Normalized</span></code>)</p></li>
<li><p><strong>Suffix</strong>: Describes the coordinate space or component (e.g., <code class="docutils literal notranslate"><span class="pre">Monitor</span></code>, <code class="docutils literal notranslate"><span class="pre">Detector</span></code>, <code class="docutils literal notranslate"><span class="pre">Q</span></code>, <code class="docutils literal notranslate"><span class="pre">Dspacing</span></code>, <code class="docutils literal notranslate"><span class="pre">Energy</span></code>)</p></li>
</ul>
<p><strong>Monitor types</strong></p>
<p>Monitors follow a linear progression through processing stages:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">EmptyMonitor</span>      <span class="c1"># Geometry only, calibrated</span>
<span class="n">RawMonitor</span>        <span class="c1"># With counts</span>
<span class="n">TofMonitor</span>        <span class="c1"># Time-of-flight domain</span>
<span class="n">WavelengthMonitor</span> <span class="c1"># Wavelength domain (end of monitor chain)</span>
</pre></div>
</div>
<p><strong>Detector types</strong></p>
<p>Detectors progress through both processing stages and move from “detector space” (pixel space) to, e.g., Q-space:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">EmptyDetector</span>      <span class="c1"># Geometry only, calibrated, pixel-masked</span>
<span class="n">RawDetector</span>        <span class="c1"># With counts</span>
<span class="n">TofDetector</span>        <span class="c1"># With added time-of-flight coord</span>
<span class="n">WavelengthDetector</span> <span class="c1"># With added wavelength coord</span>
<span class="n">CorrectedDetector</span>  <span class="c1"># Corrections applied (masking, filtering, efficiency, Lorentz, absorption)</span>
<span class="n">CorrectedQ</span>         <span class="c1"># Transformed to Q-space, pixels reduced</span>
<span class="n">NormalizedQ</span>        <span class="c1"># Normalized (to monitor, proton charge)</span>
<span class="n">IntensityQ</span>         <span class="c1"># Absolute intensity, e.g., normalized to vanadium</span>
</pre></div>
</div>
<p>Alternative domain-specific names to, e.g., <code class="docutils literal notranslate"><span class="pre">IntensityQ</span></code> such as <code class="docutils literal notranslate"><span class="pre">ReflectivityQ</span></code> are also valid.</p>
<p><strong>Coordinate space variants</strong></p>
<p>The final coordinate space (<code class="docutils literal notranslate"><span class="pre">Q</span></code> in the example above) should be replaced with the appropriate space for the technique:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Dspacing</span></code> for d-spacing coordinates</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">EnergyTransfer</span></code> for energy transfer</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TwoTheta</span></code> for scattering angle</p></li>
<li><p>Multiple dimensions can be combined: <code class="docutils literal notranslate"><span class="pre">DspacingTwoTheta</span></code></p></li>
</ul>
<p>For example, a powder diffraction workflow might use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>CorrectedDetector → CorrectedDspacing → NormalizedDspacing → IntensityDspacing
</pre></div>
</div>
<p><strong>Guidelines</strong></p>
<ol class="arabic simple">
<li><p><strong>Maintain the standard progression</strong>: Keep processing stages separate unless there’s a scientific reason to combine them (e.g., computational efficiency for a specific technique).</p></li>
<li><p><strong>Prefix carries forward</strong>: When transforming coordinate spaces without additional processing, the prefix carries forward (e.g., <code class="docutils literal notranslate"><span class="pre">CorrectedDetector</span></code> → <code class="docutils literal notranslate"><span class="pre">CorrectedQ</span></code>).</p></li>
<li><p><strong>Skip only when appropriate</strong>: Stages can be skipped if they don’t exist for a particular technique, but avoid skipping for convenience alone.</p></li>
<li><p><strong>Be explicit about the space</strong>: Always include the coordinate space or component in the suffix to make the data’s nature clear.</p></li>
<li><p><strong>Consistency across instruments</strong>: Use the same type names for equivalent processing stages across different instruments and techniques to facilitate knowledge transfer.</p></li>
</ol>
</section>
</section>
<section id="d-documentation">
<h2>D: Documentation<a class="headerlink" href="#d-documentation" title="Link to this heading">#</a></h2>
<section id="d-1-document-math-and-references-in-docstrings">
<h3>D.1: Document math and references in docstrings<a class="headerlink" href="#d-1-document-math-and-references-in-docstrings" title="Link to this heading">#</a></h3>
<p><strong>Reason</strong>
Documentation should be as close to the code as possible, to decrease the chance that it runs out of sync.
This includes mathematical formulas and references to literature.</p>
<p><strong>Note</strong>
We have previously documented math and references in Jupyter notebooks.
This is not sufficient, as the documentation is not close to the code.</p>
</section>
</section>
<section id="p-performance">
<h2>P: Performance<a class="headerlink" href="#p-performance" title="Link to this heading">#</a></h2>
<section id="p-1-runtime-and-memory-use-of-workflows-shall-be-tested-with-large-data">
<h3>P.1: Runtime and memory use of workflows shall be tested with large data<a class="headerlink" href="#p-1-runtime-and-memory-use-of-workflows-shall-be-tested-with-large-data" title="Link to this heading">#</a></h3>
<p><strong>Reason</strong>
We want to ensure that the workflows are efficient and do not consume excessive memory.</p>
<p><strong>Note</strong>
This is often not apparent from small test data, as the location of performance bottlenecks may depend on the size of the data.</p>
</section>
</section>
<section id="s-structure">
<h2>S: Structure<a class="headerlink" href="#s-structure" title="Link to this heading">#</a></h2>
<section id="s-1-workflows-shall-be-able-to-return-final-results-as-event-data">
<h3>S.1: Workflows shall be able to return final results as event data<a class="headerlink" href="#s-1-workflows-shall-be-able-to-return-final-results-as-event-data" title="Link to this heading">#</a></h3>
<p><strong>Reason</strong></p>
<ul class="simple">
<li><p>Required for polarization analysis, which wraps a base workflow.</p></li>
<li><p>Required for subsequent filtering, unless part of the workflow.</p></li>
</ul>
<p><strong>Note</strong>
There should be a workflow parameter (flag) to select whether to return event data or not.</p>
</section>
<section id="s-2-load-each-required-nxmonitor-separately">
<h3>S.2: Load each required NXmonitor separately<a class="headerlink" href="#s-2-load-each-required-nxmonitor-separately" title="Link to this heading">#</a></h3>
<p><strong>Reason</strong>
Monitor data can be extremely large when operating in event mode.
Loading only individual monitors avoids loading unnecessary data and allows for more efficient parallelism and reduction in memory use.</p>
</section>
<section id="s-3-load-each-required-nxdetector-separately">
<h3>S.3: Load each required NXdetector separately<a class="headerlink" href="#s-3-load-each-required-nxdetector-separately" title="Link to this heading">#</a></h3>
<p><strong>Reason</strong>
Detector data can be extremely large when operating in event mode.
Loading only individual detectors avoids loading unnecessary data and allows for more efficient parallelism and reduction in memory use.</p>
</section>
<section id="s-4-load-auxiliary-data-and-metadata-separately-from-monitors-and-detectors">
<h3>S.4: Load auxiliary data and metadata separately from monitors and detectors<a class="headerlink" href="#s-4-load-auxiliary-data-and-metadata-separately-from-monitors-and-detectors" title="Link to this heading">#</a></h3>
<p><strong>Reason</strong>
Event-mode monitor- and detector-data can be extremely large.
Auxiliary data such as sample-environment data, or chopper-metadata should be accessible without loading the large data.
Loading auxiliary data and metadata separately avoids keeping large data alive in memory if output metadata extraction depends on auxiliary input data or input metadata.</p>
</section>
<section id="s-5-avoid-dependencies-of-output-metadata-on-large-data">
<h3>S.5: Avoid dependencies of output metadata on large data<a class="headerlink" href="#s-5-avoid-dependencies-of-output-metadata-on-large-data" title="Link to this heading">#</a></h3>
<p><strong>Reason</strong>
Adding dependencies on large data to the output metadata extraction may lead to large data being kept alive in memory.</p>
<p><strong>Note</strong>
Most of this is avoided by following S.2, S.3, and S.4.
A bad example would be writing the total raw counts to the output metadata, as this would require keeping the large data alive in memory, unless it is ensured that the task runs early.</p>
</section>
<section id="s-6-preserve-floating-point-precision-of-input-data-and-coordinates">
<h3>S.6: Preserve floating-point precision of input data and coordinates<a class="headerlink" href="#s-6-preserve-floating-point-precision-of-input-data-and-coordinates" title="Link to this heading">#</a></h3>
<p><strong>Reason</strong>
Single-precision may be sufficient for most data.
By writing workflows transparently for single- and double-precision, we avoid future changes if we either want to use single-precision for performance reasons or double-precision for accuracy reasons.</p>
<p><strong>Note</strong>
This affects coordinates and data values independently.</p>
<ul class="simple">
<li><p>If input counts are single-precision, the reduced intensity should be single-precision, and equivalently for double-precision.</p></li>
<li><p>If input coordinates are single-precision, derived coordinates should be single-precision, and equivalently for double-precision.</p></li>
</ul>
<p><strong>Note</strong>
This will allow for changing the precision of the entire workflow by choosing a precision when loading the input data.</p>
<p><strong>Example</strong></p>
<ul class="simple">
<li><p>If time-of-flight is single-precision, wavelength and momentum transfer should be single-precision.</p></li>
<li><p>If counts are single-precision, reduced intensity should be single-precision.</p></li>
</ul>
</section>
<section id="s-7-switches-to-double-precision-shall-be-deliberate-explicit-and-documented">
<h3>S.7: Switches to double-precision shall be deliberate, explicit, and documented<a class="headerlink" href="#s-7-switches-to-double-precision-shall-be-deliberate-explicit-and-documented" title="Link to this heading">#</a></h3>
<p><strong>Reason</strong>
Some workflows may require switching to double-precision at a certain point in the workflow.
This should be a deliberate choice, and the reason for the switch should be documented.</p>
</section>
<section id="s-8-propagation-of-uncertainties-in-broadcast-operations-should-support-drop-and-upper-bound-strategies-upper-bound-shall-be-the-default">
<h3>S.8: Propagation of uncertainties in broadcast operations should support “drop” and “upper-bound” strategies, “upper-bound” shall be the default<a class="headerlink" href="#s-8-propagation-of-uncertainties-in-broadcast-operations-should-support-drop-and-upper-bound-strategies-upper-bound-shall-be-the-default" title="Link to this heading">#</a></h3>
<p><strong>Reason</strong>
Unless explicitly computed, the exact propagation of uncertainties in broadcast operations is not tractable.
Dropping uncertainties is not desirable in general, as it may lead to underestimation of the uncertainties, but we realize that the upper-bound approach may not be suitable in all cases.
We should therefore support two strategies, “drop” and “upper-bound”, and “upper-bound” should be the default.</p>
<p><strong>Note</strong>
See <a class="reference external" href="http://dx.doi.org/10.3233/JNR-220049">Systematic underestimation of uncertainties by widespread neutron-scattering data-reduction software</a> for a discussion of the topic.
TODO Add reference to upper-bound approach.</p>
</section>
<section id="s-9-do-not-write-files-or-make-write-requests-to-services-such-as-scicat-in-providers">
<h3>S.9: Do not write files or make write requests to services such as SciCat in providers<a class="headerlink" href="#s-9-do-not-write-files-or-make-write-requests-to-services-such-as-scicat-in-providers" title="Link to this heading">#</a></h3>
<p><strong>Reason</strong>
Providers should be side-effect free, and should not write files or make write requests to services.</p>
<p><strong>Note</strong>
Workflows may run many times, or in parallel, or tasks may be retried after failure, and we want to avoid side-effects in these cases.
This will, e.g., avoid unintentional overwriting of a user’s files.</p>
</section>
<section id="s-10-detector-banks-shall-be-loaded-with-their-logical-dimensions-if-possible">
<h3>S.10: Detector banks shall be loaded with their logical dimensions, if possible<a class="headerlink" href="#s-10-detector-banks-shall-be-loaded-with-their-logical-dimensions-if-possible" title="Link to this heading">#</a></h3>
<p><strong>Reason</strong>
Using logical dims (instead of a flat list of pixels) allows for simpler indexing and slicing of the data, reductions over a subset of dimensions, and masking of physical components.</p>
<p><strong>Note</strong>
This is not always possible, as some detectors have an irregular structure and cannot be reshaped to a (multi-dimensional) array.</p>
</section>
</section>
<section id="t-testing">
<h2>T: Testing<a class="headerlink" href="#t-testing" title="Link to this heading">#</a></h2>
<section id="t-1-adherence-to-the-guidelines-shall-be-tested-and-the-guideline-id-shall-be-referenced-in-the-test-name">
<h3>T.1: Adherence to the guidelines shall be tested, and the guideline ID shall be referenced in the test name<a class="headerlink" href="#t-1-adherence-to-the-guidelines-shall-be-tested-and-the-guideline-id-shall-be-referenced-in-the-test-name" title="Link to this heading">#</a></h3>
<p><strong>Reason</strong>
We want to ensure that the guidelines are followed, and that this remains the case as the code base evolves.
Referencing the guideline ID in the test name makes it easier to find the relevant guideline (or vice-versa), or remove the test if the guideline is removed.</p>
<p><strong>Note</strong>
Not all guidelines are testable.</p>
</section>
<section id="t-2-write-unit-tests-for-providers">
<h3>T.2: Write unit tests for providers<a class="headerlink" href="#t-2-write-unit-tests-for-providers" title="Link to this heading">#</a></h3>
<p><strong>Reason</strong> Unit tests for providers are easier to write and maintain than for entire workflows.</p>
<p><strong>Note</strong> This does not mean that we should not write tests for entire workflows, but that we should also write tests for providers.</p>
</section>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="widget.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Workflow Widget in Jupyter Notebook</p>
      </div>
    </a>
    <a class="right-next"
       href="../api-reference/index.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">API Reference</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2024 Scipp contributors.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 9.0.4.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><!-- This will display the version of the docs -->
Current ESSreduce version: 0.1.dev1610+gc2e452b13 (<a href="https://github.com/scipp/essreduce/releases">older versions</a>).</div>
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>